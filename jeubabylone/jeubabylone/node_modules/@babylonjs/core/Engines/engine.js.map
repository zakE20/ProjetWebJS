{"version":3,"file":"engine.js","sourceRoot":"","sources":["../../../sourceES6/core/Engines/engine.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observer, Observable } from \"../Misc/observable\";\r\nimport { PerformanceMonitor } from \"../Misc/performanceMonitor\";\r\nimport { StringDictionary } from \"../Misc/stringDictionary\";\r\nimport { PromisePolyfill } from \"../Misc/promise\";\r\nimport { Tools, ICustomAnimationFrameRequester, PerfCounter, IFileRequest } from \"../Misc/tools\";\r\nimport { Nullable, FloatArray, DataArray, IndicesArray } from \"../types\";\r\nimport { Camera } from \"../Cameras/camera\";\r\nimport { Scene } from \"../scene\";\r\nimport { Matrix, Color3, Color4, Viewport, Vector4 } from \"../Maths/math\";\r\nimport { Scalar } from \"../Maths/math.scalar\";\r\nimport { IDisplayChangedEventArgs } from \"../Engines/engine\";\r\nimport { VertexBuffer } from \"../Meshes/buffer\";\r\nimport { UniformBuffer } from \"../Materials/uniformBuffer\";\r\nimport { Effect, EffectCreationOptions, EffectFallbacks } from \"../Materials/effect\";\r\nimport { Material } from \"../Materials/material\";\r\nimport { IInternalTextureLoader } from \"../Materials/Textures/internalTextureLoader\";\r\nimport { InternalTexture } from \"../Materials/Textures/internalTexture\";\r\nimport { BaseTexture } from \"../Materials/Textures/baseTexture\";\r\nimport { _TimeToken } from \"../Instrumentation/timeToken\";\r\nimport { IAudioEngine } from \"../Audio/audioEngine\";\r\nimport { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport { ILoadingScreen } from \"../Loading/loadingScreen\";\r\nimport { _DepthCullingState, _StencilState, _AlphaState } from \"../States/index\";\r\nimport { Constants } from \"./constants\";\r\nimport { DomManagement } from \"../Misc/domManagement\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport { EngineStore } from \"./engineStore\";\r\nimport { RenderTargetCreationOptions } from \"../Materials/Textures/renderTargetCreationOptions\";\r\nimport { _DevTools } from '../Misc/devTools';\r\nimport { WebRequest } from '../Misc/webRequest';\r\nimport { WebGLPipelineContext } from './WebGL/webGLPipelineContext';\r\nimport { IPipelineContext } from './IPipelineContext';\r\nimport { DataBuffer } from '../Meshes/dataBuffer';\r\nimport { WebGLDataBuffer } from '../Meshes/WebGL/webGLDataBuffer';\r\n\r\ndeclare type PostProcess = import(\"../PostProcesses/postProcess\").PostProcess;\r\ndeclare type Texture = import(\"../Materials/Textures/texture\").Texture;\r\ndeclare type VideoTexture = import(\"../Materials/Textures/videoTexture\").VideoTexture;\r\ndeclare type RenderTargetTexture = import(\"../Materials/Textures/renderTargetTexture\").RenderTargetTexture;\r\n\r\n/**\r\n * Keeps track of all the buffer info used in engine.\r\n */\r\nclass BufferPointer {\r\n    public active: boolean;\r\n    public index: number;\r\n    public size: number;\r\n    public type: number;\r\n    public normalized: boolean;\r\n    public stride: number;\r\n    public offset: number;\r\n    public buffer: WebGLBuffer;\r\n}\r\n\r\n/**\r\n * Interface for attribute information associated with buffer instanciation\r\n */\r\nexport class InstancingAttributeInfo {\r\n    /**\r\n     * Index/offset of the attribute in the vertex shader\r\n     */\r\n    index: number;\r\n\r\n    /**\r\n     * size of the attribute, 1, 2, 3 or 4\r\n     */\r\n    attributeSize: number;\r\n\r\n    /**\r\n     * type of the attribute, gl.BYTE, gl.UNSIGNED_BYTE, gl.SHORT, gl.UNSIGNED_SHORT, gl.FIXED, gl.FLOAT.\r\n     * default is FLOAT\r\n     */\r\n    attribyteType: number;\r\n\r\n    /**\r\n     * normalization of fixed-point data. behavior unclear, use FALSE, default is FALSE\r\n     */\r\n    normalized: boolean;\r\n\r\n    /**\r\n     * Offset of the data in the Vertex Buffer acting as the instancing buffer\r\n     */\r\n    offset: number;\r\n\r\n    /**\r\n     * Name of the GLSL attribute, for debugging purpose only\r\n     */\r\n    attributeName: string;\r\n}\r\n\r\n/**\r\n * Define options used to create a depth texture\r\n */\r\nexport class DepthTextureCreationOptions {\r\n    /** Specifies whether or not a stencil should be allocated in the texture */\r\n    generateStencil?: boolean;\r\n    /** Specifies whether or not bilinear filtering is enable on the texture */\r\n    bilinearFiltering?: boolean;\r\n    /** Specifies the comparison function to set on the texture. If 0 or undefined, the texture is not in comparison mode */\r\n    comparisonFunction?: number;\r\n    /** Specifies if the created texture is a cube texture */\r\n    isCube?: boolean;\r\n}\r\n\r\n/**\r\n * Class used to describe the capabilities of the engine relatively to the current browser\r\n */\r\nexport class EngineCapabilities {\r\n    /** Maximum textures units per fragment shader */\r\n    public maxTexturesImageUnits: number;\r\n    /** Maximum texture units per vertex shader */\r\n    public maxVertexTextureImageUnits: number;\r\n    /** Maximum textures units in the entire pipeline */\r\n    public maxCombinedTexturesImageUnits: number;\r\n    /** Maximum texture size */\r\n    public maxTextureSize: number;\r\n    /** Maximum cube texture size */\r\n    public maxCubemapTextureSize: number;\r\n    /** Maximum render texture size */\r\n    public maxRenderTextureSize: number;\r\n    /** Maximum number of vertex attributes */\r\n    public maxVertexAttribs: number;\r\n    /** Maximum number of varyings */\r\n    public maxVaryingVectors: number;\r\n    /** Maximum number of uniforms per vertex shader */\r\n    public maxVertexUniformVectors: number;\r\n    /** Maximum number of uniforms per fragment shader */\r\n    public maxFragmentUniformVectors: number;\r\n    /** Defines if standard derivates (dx/dy) are supported */\r\n    public standardDerivatives: boolean;\r\n    /** Defines if s3tc texture compression is supported */\r\n    public s3tc: Nullable<WEBGL_compressed_texture_s3tc>;\r\n    /** Defines if pvrtc texture compression is supported */\r\n    public pvrtc: any; //WEBGL_compressed_texture_pvrtc;\r\n    /** Defines if etc1 texture compression is supported */\r\n    public etc1: any; //WEBGL_compressed_texture_etc1;\r\n    /** Defines if etc2 texture compression is supported */\r\n    public etc2: any; //WEBGL_compressed_texture_etc;\r\n    /** Defines if astc texture compression is supported */\r\n    public astc: any; //WEBGL_compressed_texture_astc;\r\n    /** Defines if float textures are supported */\r\n    public textureFloat: boolean;\r\n    /** Defines if vertex array objects are supported */\r\n    public vertexArrayObject: boolean;\r\n    /** Gets the webgl extension for anisotropic filtering (null if not supported) */\r\n    public textureAnisotropicFilterExtension: Nullable<EXT_texture_filter_anisotropic>;\r\n    /** Gets the maximum level of anisotropy supported */\r\n    public maxAnisotropy: number;\r\n    /** Defines if instancing is supported */\r\n    public instancedArrays: boolean;\r\n    /** Defines if 32 bits indices are supported */\r\n    public uintIndices: boolean;\r\n    /** Defines if high precision shaders are supported */\r\n    public highPrecisionShaderSupported: boolean;\r\n    /** Defines if depth reading in the fragment shader is supported */\r\n    public fragmentDepthSupported: boolean;\r\n    /** Defines if float texture linear filtering is supported*/\r\n    public textureFloatLinearFiltering: boolean;\r\n    /** Defines if rendering to float textures is supported */\r\n    public textureFloatRender: boolean;\r\n    /** Defines if half float textures are supported*/\r\n    public textureHalfFloat: boolean;\r\n    /** Defines if half float texture linear filtering is supported*/\r\n    public textureHalfFloatLinearFiltering: boolean;\r\n    /** Defines if rendering to half float textures is supported */\r\n    public textureHalfFloatRender: boolean;\r\n    /** Defines if textureLOD shader command is supported */\r\n    public textureLOD: boolean;\r\n    /** Defines if draw buffers extension is supported */\r\n    public drawBuffersExtension: boolean;\r\n    /** Defines if depth textures are supported */\r\n    public depthTextureExtension: boolean;\r\n    /** Defines if float color buffer are supported */\r\n    public colorBufferFloat: boolean;\r\n    /** Gets disjoint timer query extension (null if not supported) */\r\n    public timerQuery: EXT_disjoint_timer_query;\r\n    /** Defines if timestamp can be used with timer query */\r\n    public canUseTimestampForTimerQuery: boolean;\r\n    /** Defines if multiview is supported (https://www.khronos.org/registry/webgl/extensions/WEBGL_multiview/) */\r\n    public multiview: any;\r\n    /** Function used to let the system compiles shaders in background */\r\n    public parallelShaderCompile: {\r\n        COMPLETION_STATUS_KHR: number;\r\n    };\r\n}\r\n\r\n/** Interface defining initialization parameters for Engine class */\r\nexport interface EngineOptions extends WebGLContextAttributes {\r\n    /**\r\n     * Defines if the engine should no exceed a specified device ratio\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\r\n     */\r\n    limitDeviceRatio?: number;\r\n    /**\r\n     * Defines if webvr should be enabled automatically\r\n     * @see http://doc.babylonjs.com/how_to/webvr_camera\r\n     */\r\n    autoEnableWebVR?: boolean;\r\n    /**\r\n     * Defines if webgl2 should be turned off even if supported\r\n     * @see http://doc.babylonjs.com/features/webgl2\r\n     */\r\n    disableWebGL2Support?: boolean;\r\n    /**\r\n     * Defines if webaudio should be initialized as well\r\n     * @see http://doc.babylonjs.com/how_to/playing_sounds_and_music\r\n     */\r\n    audioEngine?: boolean;\r\n    /**\r\n     * Defines if animations should run using a deterministic lock step\r\n     * @see http://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\r\n     */\r\n    deterministicLockstep?: boolean;\r\n    /** Defines the maximum steps to use with deterministic lock step mode */\r\n    lockstepMaxSteps?: number;\r\n    /**\r\n     * Defines that engine should ignore context lost events\r\n     * If this event happens when this parameter is true, you will have to reload the page to restore rendering\r\n     */\r\n    doNotHandleContextLost?: boolean;\r\n    /**\r\n     * Defines that engine should ignore modifying touch action attribute and style\r\n     * If not handle, you might need to set it up on your side for expected touch devices behavior.\r\n     */\r\n    doNotHandleTouchAction?: boolean;\r\n    /**\r\n     * Defines that engine should compile shaders with high precision floats (if supported). True by default\r\n     */\r\n    useHighPrecisionFloats?: boolean;\r\n}\r\n\r\n/**\r\n * The engine class is responsible for interfacing with all lower-level APIs such as WebGL and Audio\r\n */\r\nexport class Engine {\r\n    /** Use this array to turn off some WebGL2 features on known buggy browsers version */\r\n    public static ExceptionList = [\r\n        { key: \"Chrome\\/63\\.0\", capture: \"63\\\\.0\\\\.3239\\\\.(\\\\d+)\", captureConstraint: 108, targets: [\"uniformBuffer\"] },\r\n        { key: \"Firefox\\/58\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Firefox\\/59\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Chrome\\/72.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Chrome\\/73.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Chrome\\/74.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome\\/71\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome\\/72\", capture: null, captureConstraint: null, targets: [\"vao\"] }\r\n    ];\r\n\r\n    /** Gets the list of created engines */\r\n    public static get Instances(): Engine[] {\r\n        return EngineStore.Instances;\r\n    }\r\n\r\n    /**\r\n     * Gets the latest created engine\r\n     */\r\n    public static get LastCreatedEngine(): Nullable<Engine> {\r\n        return EngineStore.LastCreatedEngine;\r\n    }\r\n\r\n    /**\r\n     * Gets the latest created scene\r\n     */\r\n    public static get LastCreatedScene(): Nullable<Scene> {\r\n        return EngineStore.LastCreatedScene;\r\n    }\r\n\r\n    /**\r\n     * Will flag all materials in all scenes in all engines as dirty to trigger new shader compilation\r\n     * @param flag defines which part of the materials must be marked as dirty\r\n     * @param predicate defines a predicate used to filter which materials should be affected\r\n     */\r\n    public static MarkAllMaterialsAsDirty(flag: number, predicate?: (mat: Material) => boolean): void {\r\n        for (var engineIndex = 0; engineIndex < Engine.Instances.length; engineIndex++) {\r\n            var engine = Engine.Instances[engineIndex];\r\n\r\n            for (var sceneIndex = 0; sceneIndex < engine.scenes.length; sceneIndex++) {\r\n                engine.scenes[sceneIndex].markAllMaterialsAsDirty(flag, predicate);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hidden\r\n     */\r\n    public static _TextureLoaders: IInternalTextureLoader[] = [];\r\n\r\n    // Const statics\r\n    /** Defines that alpha blending is disabled */\r\n    public static readonly ALPHA_DISABLE = Constants.ALPHA_DISABLE;\r\n    /** Defines that alpha blending to SRC ALPHA * SRC + DEST */\r\n    public static readonly ALPHA_ADD = Constants.ALPHA_ADD;\r\n    /** Defines that alpha blending to SRC ALPHA * SRC + (1 - SRC ALPHA) * DEST */\r\n    public static readonly ALPHA_COMBINE = Constants.ALPHA_COMBINE;\r\n    /** Defines that alpha blending to DEST - SRC * DEST */\r\n    public static readonly ALPHA_SUBTRACT = Constants.ALPHA_SUBTRACT;\r\n    /** Defines that alpha blending to SRC * DEST */\r\n    public static readonly ALPHA_MULTIPLY = Constants.ALPHA_MULTIPLY;\r\n    /** Defines that alpha blending to SRC ALPHA * SRC + (1 - SRC) * DEST */\r\n    public static readonly ALPHA_MAXIMIZED = Constants.ALPHA_MAXIMIZED;\r\n    /** Defines that alpha blending to SRC + DEST */\r\n    public static readonly ALPHA_ONEONE = Constants.ALPHA_ONEONE;\r\n    /** Defines that alpha blending to SRC + (1 - SRC ALPHA) * DEST */\r\n    public static readonly ALPHA_PREMULTIPLIED = Constants.ALPHA_PREMULTIPLIED;\r\n    /**\r\n     * Defines that alpha blending to SRC + (1 - SRC ALPHA) * DEST\r\n     * Alpha will be set to (1 - SRC ALPHA) * DEST ALPHA\r\n     */\r\n    public static readonly ALPHA_PREMULTIPLIED_PORTERDUFF = Constants.ALPHA_PREMULTIPLIED_PORTERDUFF;\r\n    /** Defines that alpha blending to CST * SRC + (1 - CST) * DEST */\r\n    public static readonly ALPHA_INTERPOLATE = Constants.ALPHA_INTERPOLATE;\r\n    /**\r\n     * Defines that alpha blending to SRC + (1 - SRC) * DEST\r\n     * Alpha will be set to SRC ALPHA + (1 - SRC ALPHA) * DEST ALPHA\r\n     */\r\n    public static readonly ALPHA_SCREENMODE = Constants.ALPHA_SCREENMODE;\r\n\r\n    /** Defines that the ressource is not delayed*/\r\n    public static readonly DELAYLOADSTATE_NONE = Constants.DELAYLOADSTATE_NONE;\r\n    /** Defines that the ressource was successfully delay loaded */\r\n    public static readonly DELAYLOADSTATE_LOADED = Constants.DELAYLOADSTATE_LOADED;\r\n    /** Defines that the ressource is currently delay loading */\r\n    public static readonly DELAYLOADSTATE_LOADING = Constants.DELAYLOADSTATE_LOADING;\r\n    /** Defines that the ressource is delayed and has not started loading */\r\n    public static readonly DELAYLOADSTATE_NOTLOADED = Constants.DELAYLOADSTATE_NOTLOADED;\r\n\r\n    // Depht or Stencil test Constants.\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will never pass. i.e. Nothing will be drawn */\r\n    public static readonly NEVER = Constants.NEVER;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will always pass. i.e. Pixels will be drawn in the order they are drawn */\r\n    public static readonly ALWAYS = Constants.ALWAYS;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will pass if the new depth value is less than the stored value */\r\n    public static readonly LESS = Constants.LESS;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will pass if the new depth value is equals to the stored value */\r\n    public static readonly EQUAL = Constants.EQUAL;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will pass if the new depth value is less than or equal to the stored value */\r\n    public static readonly LEQUAL = Constants.LEQUAL;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will pass if the new depth value is greater than the stored value */\r\n    public static readonly GREATER = Constants.GREATER;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will pass if the new depth value is greater than or equal to the stored value */\r\n    public static readonly GEQUAL = Constants.GEQUAL;\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will pass if the new depth value is not equal to the stored value */\r\n    public static readonly NOTEQUAL = Constants.NOTEQUAL;\r\n\r\n    // Stencil Actions Constants.\r\n    /** Passed to stencilOperation to specify that stencil value must be kept */\r\n    public static readonly KEEP = Constants.KEEP;\r\n    /** Passed to stencilOperation to specify that stencil value must be replaced */\r\n    public static readonly REPLACE = Constants.REPLACE;\r\n    /** Passed to stencilOperation to specify that stencil value must be incremented */\r\n    public static readonly INCR = Constants.INCR;\r\n    /** Passed to stencilOperation to specify that stencil value must be decremented */\r\n    public static readonly DECR = Constants.DECR;\r\n    /** Passed to stencilOperation to specify that stencil value must be inverted */\r\n    public static readonly INVERT = Constants.INVERT;\r\n    /** Passed to stencilOperation to specify that stencil value must be incremented with wrapping */\r\n    public static readonly INCR_WRAP = Constants.INCR_WRAP;\r\n    /** Passed to stencilOperation to specify that stencil value must be decremented with wrapping */\r\n    public static readonly DECR_WRAP = Constants.DECR_WRAP;\r\n\r\n    /** Texture is not repeating outside of 0..1 UVs */\r\n    public static readonly TEXTURE_CLAMP_ADDRESSMODE = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n    /** Texture is repeating outside of 0..1 UVs */\r\n    public static readonly TEXTURE_WRAP_ADDRESSMODE = Constants.TEXTURE_WRAP_ADDRESSMODE;\r\n    /** Texture is repeating and mirrored */\r\n    public static readonly TEXTURE_MIRROR_ADDRESSMODE = Constants.TEXTURE_MIRROR_ADDRESSMODE;\r\n\r\n    /** ALPHA */\r\n    public static readonly TEXTUREFORMAT_ALPHA = Constants.TEXTUREFORMAT_ALPHA;\r\n    /** LUMINANCE */\r\n    public static readonly TEXTUREFORMAT_LUMINANCE = Constants.TEXTUREFORMAT_LUMINANCE;\r\n    /** LUMINANCE_ALPHA */\r\n    public static readonly TEXTUREFORMAT_LUMINANCE_ALPHA = Constants.TEXTUREFORMAT_LUMINANCE_ALPHA;\r\n    /** RGB */\r\n    public static readonly TEXTUREFORMAT_RGB = Constants.TEXTUREFORMAT_RGB;\r\n    /** RGBA */\r\n    public static readonly TEXTUREFORMAT_RGBA = Constants.TEXTUREFORMAT_RGBA;\r\n    /** RED */\r\n    public static readonly TEXTUREFORMAT_RED = Constants.TEXTUREFORMAT_RED;\r\n    /** RED (2nd reference) */\r\n    public static readonly TEXTUREFORMAT_R = Constants.TEXTUREFORMAT_R;\r\n    /** RG */\r\n    public static readonly TEXTUREFORMAT_RG = Constants.TEXTUREFORMAT_RG;\r\n    /** RED_INTEGER */\r\n    public static readonly TEXTUREFORMAT_RED_INTEGER = Constants.TEXTUREFORMAT_RED_INTEGER;\r\n    /** RED_INTEGER (2nd reference) */\r\n    public static readonly TEXTUREFORMAT_R_INTEGER = Constants.TEXTUREFORMAT_R_INTEGER;\r\n    /** RG_INTEGER */\r\n    public static readonly TEXTUREFORMAT_RG_INTEGER = Constants.TEXTUREFORMAT_RG_INTEGER;\r\n    /** RGB_INTEGER */\r\n    public static readonly TEXTUREFORMAT_RGB_INTEGER = Constants.TEXTUREFORMAT_RGB_INTEGER;\r\n    /** RGBA_INTEGER */\r\n    public static readonly TEXTUREFORMAT_RGBA_INTEGER = Constants.TEXTUREFORMAT_RGBA_INTEGER;\r\n\r\n    /** UNSIGNED_BYTE */\r\n    public static readonly TEXTURETYPE_UNSIGNED_BYTE = Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n    /** UNSIGNED_BYTE (2nd reference) */\r\n    public static readonly TEXTURETYPE_UNSIGNED_INT = Constants.TEXTURETYPE_UNSIGNED_INT;\r\n    /** FLOAT */\r\n    public static readonly TEXTURETYPE_FLOAT = Constants.TEXTURETYPE_FLOAT;\r\n    /** HALF_FLOAT */\r\n    public static readonly TEXTURETYPE_HALF_FLOAT = Constants.TEXTURETYPE_HALF_FLOAT;\r\n    /** BYTE */\r\n    public static readonly TEXTURETYPE_BYTE = Constants.TEXTURETYPE_BYTE;\r\n    /** SHORT */\r\n    public static readonly TEXTURETYPE_SHORT = Constants.TEXTURETYPE_SHORT;\r\n    /** UNSIGNED_SHORT */\r\n    public static readonly TEXTURETYPE_UNSIGNED_SHORT = Constants.TEXTURETYPE_UNSIGNED_SHORT;\r\n    /** INT */\r\n    public static readonly TEXTURETYPE_INT = Constants.TEXTURETYPE_INT;\r\n    /** UNSIGNED_INT */\r\n    public static readonly TEXTURETYPE_UNSIGNED_INTEGER = Constants.TEXTURETYPE_UNSIGNED_INTEGER;\r\n    /** UNSIGNED_SHORT_4_4_4_4 */\r\n    public static readonly TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 = Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4;\r\n    /** UNSIGNED_SHORT_5_5_5_1 */\r\n    public static readonly TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 = Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1;\r\n    /** UNSIGNED_SHORT_5_6_5 */\r\n    public static readonly TEXTURETYPE_UNSIGNED_SHORT_5_6_5 = Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5;\r\n    /** UNSIGNED_INT_2_10_10_10_REV */\r\n    public static readonly TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV = Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV;\r\n    /** UNSIGNED_INT_24_8 */\r\n    public static readonly TEXTURETYPE_UNSIGNED_INT_24_8 = Constants.TEXTURETYPE_UNSIGNED_INT_24_8;\r\n    /** UNSIGNED_INT_10F_11F_11F_REV */\r\n    public static readonly TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV = Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV;\r\n    /** UNSIGNED_INT_5_9_9_9_REV */\r\n    public static readonly TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV = Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV;\r\n    /** FLOAT_32_UNSIGNED_INT_24_8_REV */\r\n    public static readonly TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV = Constants.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV;\r\n\r\n    /** nearest is mag = nearest and min = nearest and mip = linear */\r\n    public static readonly TEXTURE_NEAREST_SAMPLINGMODE = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n    /** Bilinear is mag = linear and min = linear and mip = nearest */\r\n    public static readonly TEXTURE_BILINEAR_SAMPLINGMODE = Constants.TEXTURE_BILINEAR_SAMPLINGMODE;\r\n    /** Trilinear is mag = linear and min = linear and mip = linear */\r\n    public static readonly TEXTURE_TRILINEAR_SAMPLINGMODE = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE;\r\n    /** nearest is mag = nearest and min = nearest and mip = linear */\r\n    public static readonly TEXTURE_NEAREST_NEAREST_MIPLINEAR = Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR;\r\n    /** Bilinear is mag = linear and min = linear and mip = nearest */\r\n    public static readonly TEXTURE_LINEAR_LINEAR_MIPNEAREST = Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST;\r\n    /** Trilinear is mag = linear and min = linear and mip = linear */\r\n    public static readonly TEXTURE_LINEAR_LINEAR_MIPLINEAR = Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR;\r\n    /** mag = nearest and min = nearest and mip = nearest */\r\n    public static readonly TEXTURE_NEAREST_NEAREST_MIPNEAREST = Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST;\r\n    /** mag = nearest and min = linear and mip = nearest */\r\n    public static readonly TEXTURE_NEAREST_LINEAR_MIPNEAREST = Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST;\r\n    /** mag = nearest and min = linear and mip = linear */\r\n    public static readonly TEXTURE_NEAREST_LINEAR_MIPLINEAR = Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR;\r\n    /** mag = nearest and min = linear and mip = none */\r\n    public static readonly TEXTURE_NEAREST_LINEAR = Constants.TEXTURE_NEAREST_LINEAR;\r\n    /** mag = nearest and min = nearest and mip = none */\r\n    public static readonly TEXTURE_NEAREST_NEAREST = Constants.TEXTURE_NEAREST_NEAREST;\r\n    /** mag = linear and min = nearest and mip = nearest */\r\n    public static readonly TEXTURE_LINEAR_NEAREST_MIPNEAREST = Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST;\r\n    /** mag = linear and min = nearest and mip = linear */\r\n    public static readonly TEXTURE_LINEAR_NEAREST_MIPLINEAR = Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR;\r\n    /** mag = linear and min = linear and mip = none */\r\n    public static readonly TEXTURE_LINEAR_LINEAR = Constants.TEXTURE_LINEAR_LINEAR;\r\n    /** mag = linear and min = nearest and mip = none */\r\n    public static readonly TEXTURE_LINEAR_NEAREST = Constants.TEXTURE_LINEAR_NEAREST;\r\n\r\n    /** Explicit coordinates mode */\r\n    public static readonly TEXTURE_EXPLICIT_MODE = Constants.TEXTURE_EXPLICIT_MODE;\r\n    /** Spherical coordinates mode */\r\n    public static readonly TEXTURE_SPHERICAL_MODE = Constants.TEXTURE_SPHERICAL_MODE;\r\n    /** Planar coordinates mode */\r\n    public static readonly TEXTURE_PLANAR_MODE = Constants.TEXTURE_PLANAR_MODE;\r\n    /** Cubic coordinates mode */\r\n    public static readonly TEXTURE_CUBIC_MODE = Constants.TEXTURE_CUBIC_MODE;\r\n    /** Projection coordinates mode */\r\n    public static readonly TEXTURE_PROJECTION_MODE = Constants.TEXTURE_PROJECTION_MODE;\r\n    /** Skybox coordinates mode */\r\n    public static readonly TEXTURE_SKYBOX_MODE = Constants.TEXTURE_SKYBOX_MODE;\r\n    /** Inverse Cubic coordinates mode */\r\n    public static readonly TEXTURE_INVCUBIC_MODE = Constants.TEXTURE_INVCUBIC_MODE;\r\n    /** Equirectangular coordinates mode */\r\n    public static readonly TEXTURE_EQUIRECTANGULAR_MODE = Constants.TEXTURE_EQUIRECTANGULAR_MODE;\r\n    /** Equirectangular Fixed coordinates mode */\r\n    public static readonly TEXTURE_FIXED_EQUIRECTANGULAR_MODE = Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MODE;\r\n    /** Equirectangular Fixed Mirrored coordinates mode */\r\n    public static readonly TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE = Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE;\r\n\r\n    // Texture rescaling mode\r\n    /** Defines that texture rescaling will use a floor to find the closer power of 2 size */\r\n    public static readonly SCALEMODE_FLOOR = Constants.SCALEMODE_FLOOR;\r\n    /** Defines that texture rescaling will look for the nearest power of 2 size */\r\n    public static readonly SCALEMODE_NEAREST = Constants.SCALEMODE_NEAREST;\r\n    /** Defines that texture rescaling will use a ceil to find the closer power of 2 size */\r\n    public static readonly SCALEMODE_CEILING = Constants.SCALEMODE_CEILING;\r\n\r\n    /**\r\n     * Returns the current npm package of the sdk\r\n     */\r\n    // Not mixed with Version for tooling purpose.\r\n    public static get NpmPackage(): string {\r\n        return \"babylonjs@4.0.3\";\r\n    }\r\n\r\n    /**\r\n     * Returns the current version of the framework\r\n     */\r\n    public static get Version(): string {\r\n        return \"4.0.3\";\r\n    }\r\n\r\n    /**\r\n     * Returns a string describing the current engine\r\n     */\r\n    public get description(): string {\r\n        let description = \"WebGL\" + this.webGLVersion;\r\n\r\n        if (this._caps.parallelShaderCompile) {\r\n            description += \" - Parallel shader compilation\";\r\n        }\r\n\r\n        return description;\r\n    }\r\n\r\n    // Updatable statics so stick with vars here\r\n\r\n    /**\r\n     * Gets or sets the epsilon value used by collision engine\r\n     */\r\n    public static CollisionsEpsilon = 0.001;\r\n\r\n    /**\r\n     * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\r\n     */\r\n    public static get ShadersRepository(): string {\r\n        return Effect.ShadersRepository;\r\n    }\r\n    public static set ShadersRepository(value: string) {\r\n        Effect.ShadersRepository = value;\r\n    }\r\n\r\n    /**\r\n     * Method called to create the default loading screen.\r\n     * This can be overriden in your own app.\r\n     * @param canvas The rendering canvas element\r\n     * @returns The loading screen\r\n     */\r\n    public static DefaultLoadingScreenFactory(canvas: HTMLCanvasElement): ILoadingScreen {\r\n        throw _DevTools.WarnImport(\"LoadingScreen\");\r\n    }\r\n\r\n    /**\r\n     * Method called to create the default rescale post process on each engine.\r\n     */\r\n    public static _RescalePostProcessFactory: Nullable<(engine: Engine) => PostProcess> = null;\r\n\r\n    // Public members\r\n\r\n    /**\r\n     * Gets or sets a boolean that indicates if textures must be forced to power of 2 size even if not required\r\n     */\r\n    public forcePOTTextures = false;\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine is currently rendering in fullscreen mode\r\n     */\r\n    public isFullscreen = false;\r\n\r\n    /**\r\n     * Gets a boolean indicating if the pointer is currently locked\r\n     */\r\n    public isPointerLock = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if back faces must be culled (true by default)\r\n     */\r\n    public cullBackFaces = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if the engine must keep rendering even if the window is not in foregroun\r\n     */\r\n    public renderEvenInBackground = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that cache can be kept between frames\r\n     */\r\n    public preventCacheWipeBetweenFrames = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean to enable/disable IndexedDB support and avoid XHR on .manifest\r\n     **/\r\n    public enableOfflineSupport = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean to enable/disable checking manifest if IndexedDB support is enabled (js will always consider the database is up to date)\r\n     **/\r\n    public disableManifestCheck = false;\r\n\r\n    /**\r\n     * Gets the list of created scenes\r\n     */\r\n    public scenes = new Array<Scene>();\r\n\r\n    /**\r\n     * Event raised when a new scene is created\r\n     */\r\n    public onNewSceneAddedObservable = new Observable<Scene>();\r\n\r\n    /**\r\n     * Gets the list of created postprocesses\r\n     */\r\n    public postProcesses = new Array<PostProcess>();\r\n\r\n    /** Gets or sets a boolean indicating if the engine should validate programs after compilation */\r\n    public validateShaderPrograms = false;\r\n\r\n    // Observables\r\n\r\n    /**\r\n     * Observable event triggered each time the rendering canvas is resized\r\n     */\r\n    public onResizeObservable = new Observable<Engine>();\r\n\r\n    /**\r\n     * Observable event triggered each time the canvas loses focus\r\n     */\r\n    public onCanvasBlurObservable = new Observable<Engine>();\r\n\r\n    /**\r\n     * Observable event triggered each time the canvas gains focus\r\n     */\r\n    public onCanvasFocusObservable = new Observable<Engine>();\r\n\r\n    /**\r\n     * Observable event triggered each time the canvas receives pointerout event\r\n     */\r\n    public onCanvasPointerOutObservable = new Observable<PointerEvent>();\r\n\r\n    /**\r\n     * Observable event triggered before each texture is initialized\r\n     */\r\n    public onBeforeTextureInitObservable = new Observable<Texture>();\r\n\r\n    // Uniform buffers list\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that uniform buffers must be disabled even if they are supported\r\n     */\r\n    public disableUniformBuffers = false;\r\n\r\n    /** @hidden */\r\n    public _uniformBuffers = new Array<UniformBuffer>();\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine supports uniform buffers\r\n     * @see http://doc.babylonjs.com/features/webgl2#uniform-buffer-objets\r\n     */\r\n    public get supportsUniformBuffers(): boolean {\r\n        return this.webGLVersion > 1 && !this.disableUniformBuffers;\r\n    }\r\n\r\n    // Observables\r\n\r\n    /**\r\n     * Observable raised when the engine begins a new frame\r\n     */\r\n    public onBeginFrameObservable = new Observable<Engine>();\r\n\r\n    /**\r\n     * If set, will be used to request the next animation frame for the render loop\r\n     */\r\n    public customAnimationFrameRequester: Nullable<ICustomAnimationFrameRequester> = null;\r\n\r\n    /**\r\n     * Observable raised when the engine ends the current frame\r\n     */\r\n    public onEndFrameObservable = new Observable<Engine>();\r\n\r\n    /**\r\n     * Observable raised when the engine is about to compile a shader\r\n     */\r\n    public onBeforeShaderCompilationObservable = new Observable<Engine>();\r\n\r\n    /**\r\n     * Observable raised when the engine has jsut compiled a shader\r\n     */\r\n    public onAfterShaderCompilationObservable = new Observable<Engine>();\r\n\r\n    // Private Members\r\n\r\n    /** @hidden */\r\n    public _gl: WebGLRenderingContext;\r\n    private _renderingCanvas: Nullable<HTMLCanvasElement>;\r\n    private _windowIsBackground = false;\r\n    private _webGLVersion = 1.0;\r\n\r\n    protected _highPrecisionShadersAllowed = true;\r\n    /** @hidden */\r\n    public get _shouldUseHighPrecisionShader(): boolean {\r\n        return this._caps.highPrecisionShaderSupported && this._highPrecisionShadersAllowed;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that only power of 2 textures are supported\r\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\r\n     */\r\n    public get needPOTTextures(): boolean {\r\n        return this._webGLVersion < 2 || this.forcePOTTextures;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _badOS = false;\r\n\r\n    /** @hidden */\r\n    public _badDesktopOS = false;\r\n\r\n    /**\r\n     * Gets the audio engine\r\n     * @see http://doc.babylonjs.com/how_to/playing_sounds_and_music\r\n     * @ignorenaming\r\n     */\r\n    public static audioEngine: IAudioEngine;\r\n\r\n    /**\r\n     * Default AudioEngine factory responsible of creating the Audio Engine.\r\n     * By default, this will create a BabylonJS Audio Engine if the workload has been embedded.\r\n     */\r\n    public static AudioEngineFactory: (hostElement: Nullable<HTMLElement>) => IAudioEngine;\r\n\r\n    /**\r\n     * Default offline support factory responsible of creating a tool used to store data locally.\r\n     * By default, this will create a Database object if the workload has been embedded.\r\n     */\r\n    public static OfflineProviderFactory: (urlToScene: string, callbackManifestChecked: (checked: boolean) => any, disableManifestCheck: boolean) => IOfflineProvider;\r\n\r\n    // Focus\r\n    private _onFocus: () => void;\r\n    private _onBlur: () => void;\r\n    private _onCanvasPointerOut: (event: PointerEvent) => void;\r\n    private _onCanvasBlur: () => void;\r\n    private _onCanvasFocus: () => void;\r\n\r\n    private _onFullscreenChange: () => void;\r\n    private _onPointerLockChange: () => void;\r\n\r\n    private _hardwareScalingLevel: number;\r\n    /** @hidden */\r\n    public _caps: EngineCapabilities;\r\n    private _pointerLockRequested: boolean;\r\n    private _isStencilEnable: boolean;\r\n    private _colorWrite = true;\r\n\r\n    private _loadingScreen: ILoadingScreen;\r\n\r\n    /** @hidden */\r\n    public _drawCalls = new PerfCounter();\r\n\r\n    private _glVersion: string;\r\n    private _glRenderer: string;\r\n    private _glVendor: string;\r\n\r\n    private _videoTextureSupported: boolean;\r\n\r\n    private _renderingQueueLaunched = false;\r\n    private _activeRenderLoops = new Array<() => void>();\r\n\r\n    // Deterministic lockstepMaxSteps\r\n    private _deterministicLockstep: boolean = false;\r\n    private _lockstepMaxSteps: number = 4;\r\n\r\n    // Lost context\r\n    /**\r\n     * Observable signaled when a context lost event is raised\r\n     */\r\n    public onContextLostObservable = new Observable<Engine>();\r\n    /**\r\n     * Observable signaled when a context restored event is raised\r\n     */\r\n    public onContextRestoredObservable = new Observable<Engine>();\r\n    private _onContextLost: (evt: Event) => void;\r\n    private _onContextRestored: (evt: Event) => void;\r\n    private _contextWasLost = false;\r\n\r\n    /** @hidden */\r\n    public _doNotHandleContextLost = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if resources should be retained to be able to handle context lost events\r\n     * @see http://doc.babylonjs.com/how_to/optimizing_your_scene#handling-webgl-context-lost\r\n     */\r\n    public get doNotHandleContextLost(): boolean {\r\n        return this._doNotHandleContextLost;\r\n    }\r\n\r\n    public set doNotHandleContextLost(value: boolean) {\r\n        this._doNotHandleContextLost = value;\r\n    }\r\n\r\n    // FPS\r\n    private _performanceMonitor = new PerformanceMonitor();\r\n    private _fps = 60;\r\n    private _deltaTime = 0;\r\n    /**\r\n     * Turn this value on if you want to pause FPS computation when in background\r\n     */\r\n    public disablePerformanceMonitorInBackground = false;\r\n\r\n    /**\r\n     * Gets the performance monitor attached to this engine\r\n     * @see http://doc.babylonjs.com/how_to/optimizing_your_scene#engineinstrumentation\r\n     */\r\n    public get performanceMonitor(): PerformanceMonitor {\r\n        return this._performanceMonitor;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that vertex array object must be disabled even if they are supported\r\n     */\r\n    public disableVertexArrayObjects = false;\r\n\r\n    // States\r\n    /** @hidden */\r\n    protected _depthCullingState = new _DepthCullingState();\r\n    /** @hidden */\r\n    protected _stencilState = new _StencilState();\r\n    /** @hidden */\r\n    protected _alphaState = new _AlphaState();\r\n    /** @hidden */\r\n    protected _alphaMode = Engine.ALPHA_DISABLE;\r\n\r\n    // Cache\r\n    /** @hidden */\r\n    public _internalTexturesCache = new Array<InternalTexture>();\r\n    /** @hidden */\r\n    protected _activeChannel = 0;\r\n    private _currentTextureChannel = -1;\r\n    /** @hidden */\r\n    protected _boundTexturesCache: { [key: string]: Nullable<InternalTexture> } = {};\r\n    /** @hidden */\r\n    protected _currentEffect: Nullable<Effect>;\r\n    /** @hidden */\r\n    protected _currentProgram: Nullable<WebGLProgram>;\r\n    private _compiledEffects: { [key: string]: Effect } = {};\r\n    private _vertexAttribArraysEnabled: boolean[] = [];\r\n    /** @hidden */\r\n    protected _cachedViewport: Nullable<Viewport>;\r\n    private _cachedVertexArrayObject: Nullable<WebGLVertexArrayObject>;\r\n    /** @hidden */\r\n    protected _cachedVertexBuffers: any;\r\n    /** @hidden */\r\n    protected _cachedIndexBuffer: Nullable<DataBuffer>;\r\n    /** @hidden */\r\n    protected _cachedEffectForVertexBuffers: Nullable<Effect>;\r\n    /** @hidden */\r\n    public _currentRenderTarget: Nullable<InternalTexture>;\r\n    private _uintIndicesCurrentlySet = false;\r\n    private _currentBoundBuffer = new Array<Nullable<WebGLBuffer>>();\r\n    /** @hidden */\r\n    protected _currentFramebuffer: Nullable<WebGLFramebuffer> = null;\r\n    private _currentBufferPointers = new Array<BufferPointer>();\r\n    private _currentInstanceLocations = new Array<number>();\r\n    private _currentInstanceBuffers = new Array<DataBuffer>();\r\n    private _textureUnits: Int32Array;\r\n\r\n    /** @hidden */\r\n    public _workingCanvas: Nullable<HTMLCanvasElement>;\r\n    /** @hidden */\r\n    public _workingContext: Nullable<CanvasRenderingContext2D>;\r\n    private _rescalePostProcess: PostProcess;\r\n\r\n    private _dummyFramebuffer: WebGLFramebuffer;\r\n\r\n    private _externalData: StringDictionary<Object>;\r\n    /** @hidden */\r\n    public _bindedRenderFunction: any;\r\n\r\n    private _vaoRecordInProgress = false;\r\n    private _mustWipeVertexAttributes = false;\r\n\r\n    private _emptyTexture: Nullable<InternalTexture>;\r\n    private _emptyCubeTexture: Nullable<InternalTexture>;\r\n    private _emptyTexture3D: Nullable<InternalTexture>;\r\n\r\n    /** @hidden */\r\n    public _frameHandler: number;\r\n\r\n    private _nextFreeTextureSlots = new Array<number>();\r\n    private _maxSimultaneousTextures = 0;\r\n\r\n    private _activeRequests = new Array<IFileRequest>();\r\n\r\n    // Hardware supported Compressed Textures\r\n    private _texturesSupported = new Array<string>();\r\n    /** @hidden */\r\n    public _textureFormatInUse: Nullable<string>;\r\n\r\n    /**\r\n     * Gets the list of texture formats supported\r\n     */\r\n    public get texturesSupported(): Array<string> {\r\n        return this._texturesSupported;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of texture formats in use\r\n     */\r\n    public get textureFormatInUse(): Nullable<string> {\r\n        return this._textureFormatInUse;\r\n    }\r\n\r\n    /**\r\n     * Gets the current viewport\r\n     */\r\n    public get currentViewport(): Nullable<Viewport> {\r\n        return this._cachedViewport;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty texture\r\n     */\r\n    public get emptyTexture(): InternalTexture {\r\n        if (!this._emptyTexture) {\r\n            this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, Engine.TEXTUREFORMAT_RGBA, false, false, Engine.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyTexture;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty 3D texture\r\n     */\r\n    public get emptyTexture3D(): InternalTexture {\r\n        if (!this._emptyTexture3D) {\r\n            this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, Engine.TEXTUREFORMAT_RGBA, false, false, Engine.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyTexture3D;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty cube texture\r\n     */\r\n    public get emptyCubeTexture(): InternalTexture {\r\n        if (!this._emptyCubeTexture) {\r\n            var faceData = new Uint8Array(4);\r\n            var cubeData = [faceData, faceData, faceData, faceData, faceData, faceData];\r\n            this._emptyCubeTexture = this.createRawCubeTexture(cubeData, 1, Engine.TEXTUREFORMAT_RGBA, Engine.TEXTURETYPE_UNSIGNED_INT, false, false, Engine.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyCubeTexture;\r\n    }\r\n\r\n    /**\r\n     * Defines whether the engine has been created with the premultipliedAlpha option on or not.\r\n     */\r\n    public readonly premultipliedAlpha: boolean = true;\r\n\r\n    /**\r\n     * Creates a new engine\r\n     * @param canvasOrContext defines the canvas or WebGL context to use for rendering. If you provide a WebGL context, Babylon.js will not hook events on the canvas (like pointers, keyboards, etc...) so no event observables will be available. This is mostly used when Babylon.js is used as a plugin on a system which alreay used the WebGL context\r\n     * @param antialias defines enable antialiasing (default: false)\r\n     * @param options defines further options to be sent to the getContext() function\r\n     * @param adaptToDeviceRatio defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    constructor(canvasOrContext: Nullable<HTMLCanvasElement | WebGLRenderingContext>, antialias?: boolean, options?: EngineOptions, adaptToDeviceRatio: boolean = false) {\r\n\r\n        // Register promises\r\n        PromisePolyfill.Apply();\r\n\r\n        let canvas: Nullable<HTMLCanvasElement> = null;\r\n        Engine.Instances.push(this);\r\n\r\n        if (!canvasOrContext) {\r\n            return;\r\n        }\r\n\r\n        options = options || {};\r\n\r\n        if ((<HTMLCanvasElement>canvasOrContext).getContext) {\r\n            canvas = <HTMLCanvasElement>canvasOrContext;\r\n            this._renderingCanvas = canvas;\r\n\r\n            if (antialias != null) {\r\n                options.antialias = antialias;\r\n            }\r\n\r\n            if (options.deterministicLockstep === undefined) {\r\n                options.deterministicLockstep = false;\r\n            }\r\n\r\n            if (options.lockstepMaxSteps === undefined) {\r\n                options.lockstepMaxSteps = 4;\r\n            }\r\n\r\n            if (options.preserveDrawingBuffer === undefined) {\r\n                options.preserveDrawingBuffer = false;\r\n            }\r\n\r\n            if (options.audioEngine === undefined) {\r\n                options.audioEngine = true;\r\n            }\r\n\r\n            if (options.stencil === undefined) {\r\n                options.stencil = true;\r\n            }\r\n\r\n            if (options.premultipliedAlpha === false) {\r\n                this.premultipliedAlpha = false;\r\n            }\r\n\r\n            this._deterministicLockstep = options.deterministicLockstep;\r\n            this._lockstepMaxSteps = options.lockstepMaxSteps;\r\n            this._doNotHandleContextLost = options.doNotHandleContextLost ? true : false;\r\n\r\n            // Exceptions\r\n            if (navigator && navigator.userAgent) {\r\n                let ua = navigator.userAgent;\r\n\r\n                for (var exception of Engine.ExceptionList) {\r\n                    let key = exception.key;\r\n                    let targets = exception.targets;\r\n                    let check = new RegExp(key);\r\n\r\n                    if (check.test(ua)) {\r\n                        if (exception.capture && exception.captureConstraint) {\r\n                            let capture = exception.capture;\r\n                            let constraint = exception.captureConstraint;\r\n\r\n                            let regex = new RegExp(capture);\r\n                            let matches = regex.exec(ua);\r\n\r\n                            if (matches && matches.length > 0) {\r\n                                let capturedValue = parseInt(matches[matches.length - 1]);\r\n                                if (capturedValue >= constraint) {\r\n                                    continue;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        for (var target of targets) {\r\n                            switch (target) {\r\n                                case \"uniformBuffer\":\r\n                                    this.disableUniformBuffers = true;\r\n                                    break;\r\n                                case \"vao\":\r\n                                    this.disableVertexArrayObjects = true;\r\n                                    break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // GL\r\n            if (!options.disableWebGL2Support) {\r\n                try {\r\n                    this._gl = <any>(canvas.getContext(\"webgl2\", options) || canvas.getContext(\"experimental-webgl2\", options));\r\n                    if (this._gl) {\r\n                        this._webGLVersion = 2.0;\r\n\r\n                        // Prevent weird browsers to lie :-)\r\n                        if (!this._gl.deleteQuery) {\r\n                            this._webGLVersion = 1.0;\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // Do nothing\r\n                }\r\n            }\r\n\r\n            if (!this._gl) {\r\n                if (!canvas) {\r\n                    throw new Error(\"The provided canvas is null or undefined.\");\r\n                }\r\n                try {\r\n                    this._gl = <WebGLRenderingContext>(canvas.getContext(\"webgl\", options) || canvas.getContext(\"experimental-webgl\", options));\r\n                } catch (e) {\r\n                    throw new Error(\"WebGL not supported\");\r\n                }\r\n            }\r\n\r\n            if (!this._gl) {\r\n                throw new Error(\"WebGL not supported\");\r\n            }\r\n\r\n            // Ensures a consistent color space unpacking of textures cross browser.\r\n            this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\r\n\r\n            this._onCanvasFocus = () => {\r\n                this.onCanvasFocusObservable.notifyObservers(this);\r\n            };\r\n\r\n            this._onCanvasBlur = () => {\r\n                this.onCanvasBlurObservable.notifyObservers(this);\r\n            };\r\n\r\n            canvas.addEventListener(\"focus\", this._onCanvasFocus);\r\n            canvas.addEventListener(\"blur\", this._onCanvasBlur);\r\n\r\n            this._onBlur = () => {\r\n                if (this.disablePerformanceMonitorInBackground) {\r\n                    this._performanceMonitor.disable();\r\n                }\r\n                this._windowIsBackground = true;\r\n            };\r\n\r\n            this._onFocus = () => {\r\n                if (this.disablePerformanceMonitorInBackground) {\r\n                    this._performanceMonitor.enable();\r\n                }\r\n                this._windowIsBackground = false;\r\n            };\r\n\r\n            this._onCanvasPointerOut = (ev) => {\r\n                this.onCanvasPointerOutObservable.notifyObservers(ev);\r\n            };\r\n\r\n            if (DomManagement.IsWindowObjectExist()) {\r\n                window.addEventListener(\"blur\", this._onBlur);\r\n                window.addEventListener(\"focus\", this._onFocus);\r\n            }\r\n\r\n            canvas.addEventListener(\"pointerout\", this._onCanvasPointerOut);\r\n\r\n            // Context lost\r\n            if (!this._doNotHandleContextLost) {\r\n                this._onContextLost = (evt: Event) => {\r\n                    evt.preventDefault();\r\n                    this._contextWasLost = true;\r\n                    Logger.Warn(\"WebGL context lost.\");\r\n\r\n                    this.onContextLostObservable.notifyObservers(this);\r\n                };\r\n\r\n                this._onContextRestored = () => {\r\n                    // Adding a timeout to avoid race condition at browser level\r\n                    setTimeout(() => {\r\n                        // Rebuild gl context\r\n                        this._initGLContext();\r\n                        // Rebuild effects\r\n                        this._rebuildEffects();\r\n                        // Rebuild textures\r\n                        this._rebuildInternalTextures();\r\n                        // Rebuild buffers\r\n                        this._rebuildBuffers();\r\n                        // Cache\r\n                        this.wipeCaches(true);\r\n                        Logger.Warn(\"WebGL context successfully restored.\");\r\n                        this.onContextRestoredObservable.notifyObservers(this);\r\n                        this._contextWasLost = false;\r\n                    }, 0);\r\n                };\r\n\r\n                canvas.addEventListener(\"webglcontextlost\", this._onContextLost, false);\r\n                canvas.addEventListener(\"webglcontextrestored\", this._onContextRestored, false);\r\n            }\r\n\r\n            if (!options.doNotHandleTouchAction) {\r\n                this._disableTouchAction();\r\n            }\r\n        } else {\r\n            this._gl = <WebGLRenderingContext>canvasOrContext;\r\n            this._renderingCanvas = this._gl.canvas;\r\n\r\n            if (this._gl.renderbufferStorageMultisample) {\r\n                this._webGLVersion = 2.0;\r\n            }\r\n\r\n            const attributes = this._gl.getContextAttributes();\r\n            if (attributes) {\r\n                options.stencil = attributes.stencil;\r\n            }\r\n        }\r\n\r\n        if (options.useHighPrecisionFloats !== undefined) {\r\n            this._highPrecisionShadersAllowed = options.useHighPrecisionFloats;\r\n        }\r\n\r\n        // Viewport\r\n        const devicePixelRatio = DomManagement.IsWindowObjectExist() ? (window.devicePixelRatio || 1.0) : 1.0;\r\n\r\n        var limitDeviceRatio = options.limitDeviceRatio || devicePixelRatio;\r\n        this._hardwareScalingLevel = adaptToDeviceRatio ? 1.0 / Math.min(limitDeviceRatio, devicePixelRatio) : 1.0;\r\n        this.resize();\r\n\r\n        this._isStencilEnable = options.stencil ? true : false;\r\n        this._initGLContext();\r\n\r\n        if (canvas) {\r\n            let anyDoc = document as any;\r\n\r\n            // Fullscreen\r\n            this._onFullscreenChange = () => {\r\n\r\n                if (anyDoc.fullscreen !== undefined) {\r\n                    this.isFullscreen = anyDoc.fullscreen;\r\n                } else if (anyDoc.mozFullScreen !== undefined) {\r\n                    this.isFullscreen = anyDoc.mozFullScreen;\r\n                } else if (anyDoc.webkitIsFullScreen !== undefined) {\r\n                    this.isFullscreen = anyDoc.webkitIsFullScreen;\r\n                } else if (anyDoc.msIsFullScreen !== undefined) {\r\n                    this.isFullscreen = anyDoc.msIsFullScreen;\r\n                }\r\n\r\n                // Pointer lock\r\n                if (this.isFullscreen && this._pointerLockRequested && canvas) {\r\n                    canvas.requestPointerLock = canvas.requestPointerLock ||\r\n                        canvas.msRequestPointerLock ||\r\n                        canvas.mozRequestPointerLock ||\r\n                        canvas.webkitRequestPointerLock;\r\n\r\n                    if (canvas.requestPointerLock) {\r\n                        canvas.requestPointerLock();\r\n                    }\r\n                }\r\n            };\r\n\r\n            document.addEventListener(\"fullscreenchange\", this._onFullscreenChange, false);\r\n            document.addEventListener(\"mozfullscreenchange\", this._onFullscreenChange, false);\r\n            document.addEventListener(\"webkitfullscreenchange\", this._onFullscreenChange, false);\r\n            document.addEventListener(\"msfullscreenchange\", this._onFullscreenChange, false);\r\n\r\n            // Pointer lock\r\n            this._onPointerLockChange = () => {\r\n                this.isPointerLock = (anyDoc.mozPointerLockElement === canvas ||\r\n                    anyDoc.webkitPointerLockElement === canvas ||\r\n                    anyDoc.msPointerLockElement === canvas ||\r\n                    anyDoc.pointerLockElement === canvas\r\n                );\r\n            };\r\n\r\n            document.addEventListener(\"pointerlockchange\", this._onPointerLockChange, false);\r\n            document.addEventListener(\"mspointerlockchange\", this._onPointerLockChange, false);\r\n            document.addEventListener(\"mozpointerlockchange\", this._onPointerLockChange, false);\r\n            document.addEventListener(\"webkitpointerlockchange\", this._onPointerLockChange, false);\r\n\r\n            this._connectVREvents(canvas, anyDoc);\r\n        }\r\n\r\n        // Create Audio Engine if needed.\r\n        if (!Engine.audioEngine && options.audioEngine && Engine.AudioEngineFactory) {\r\n            Engine.audioEngine = Engine.AudioEngineFactory(this.getRenderingCanvas());\r\n        }\r\n\r\n        // Prepare buffer pointers\r\n        for (var i = 0; i < this._caps.maxVertexAttribs; i++) {\r\n            this._currentBufferPointers[i] = new BufferPointer();\r\n        }\r\n\r\n        // Load WebVR Devices\r\n        this._prepareVRComponent();\r\n        if (options.autoEnableWebVR) {\r\n            this.initWebVR();\r\n        }\r\n\r\n        // Detect if we are running on a faulty buggy OS.\r\n        this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent);\r\n\r\n        // Detect if we are running on a faulty buggy desktop OS.\r\n        this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n\r\n        console.log(`Babylon.js v${Engine.Version} - ${this.description}`);\r\n\r\n        this.enableOfflineSupport = Engine.OfflineProviderFactory !== undefined;\r\n    }\r\n\r\n    // WebVR\r\n\r\n    /**\r\n     * Initializes a webVR display and starts listening to display change events\r\n     * The onVRDisplayChangedObservable will be notified upon these changes\r\n     * @returns The onVRDisplayChangedObservable\r\n     */\r\n    public initWebVR(): Observable<IDisplayChangedEventArgs> {\r\n        throw _DevTools.WarnImport(\"WebVRCamera\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _prepareVRComponent() {\r\n        // Do nothing as the engine side effect will overload it\r\n    }\r\n\r\n    /** @hidden */\r\n    public _connectVREvents(canvas: HTMLCanvasElement, document: any) {\r\n        // Do nothing as the engine side effect will overload it\r\n    }\r\n\r\n    /** @hidden */\r\n    public _submitVRFrame() {\r\n        // Do nothing as the engine side effect will overload it\r\n    }\r\n    /**\r\n     * Call this function to leave webVR mode\r\n     * Will do nothing if webVR is not supported or if there is no webVR device\r\n     * @see http://doc.babylonjs.com/how_to/webvr_camera\r\n     */\r\n    public disableVR() {\r\n        // Do nothing as the engine side effect will overload it\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that the system is in VR mode and is presenting\r\n     * @returns true if VR mode is engaged\r\n     */\r\n    public isVRPresenting() {\r\n        return false;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _requestVRFrame() {\r\n        // Do nothing as the engine side effect will overload it\r\n    }\r\n\r\n    private _disableTouchAction(): void {\r\n        if (!this._renderingCanvas) {\r\n            return;\r\n        }\r\n\r\n        this._renderingCanvas.setAttribute(\"touch-action\", \"none\");\r\n        this._renderingCanvas.style.touchAction = \"none\";\r\n        this._renderingCanvas.style.msTouchAction = \"none\";\r\n    }\r\n\r\n    private _rebuildInternalTextures(): void {\r\n        let currentState = this._internalTexturesCache.slice(); // Do a copy because the rebuild will add proxies\r\n\r\n        for (var internalTexture of currentState) {\r\n            internalTexture._rebuild();\r\n        }\r\n    }\r\n\r\n    private _rebuildEffects(): void {\r\n        for (var key in this._compiledEffects) {\r\n            let effect = <Effect>this._compiledEffects[key];\r\n\r\n            effect._prepareEffect();\r\n        }\r\n\r\n        Effect.ResetCache();\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if all created effects are ready\r\n     * @returns true if all effects are ready\r\n     */\r\n    public areAllEffectsReady(): boolean {\r\n        for (var key in this._compiledEffects) {\r\n            let effect = <Effect>this._compiledEffects[key];\r\n\r\n            if (!effect.isReady()) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private _rebuildBuffers(): void {\r\n        // Index / Vertex\r\n        for (var scene of this.scenes) {\r\n            scene.resetCachedMaterial();\r\n            scene._rebuildGeometries();\r\n            scene._rebuildTextures();\r\n        }\r\n\r\n        // Uniforms\r\n        for (var uniformBuffer of this._uniformBuffers) {\r\n            uniformBuffer._rebuild();\r\n        }\r\n    }\r\n\r\n    private _initGLContext(): void {\r\n        // Caps\r\n        this._caps = new EngineCapabilities();\r\n        this._caps.maxTexturesImageUnits = this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);\r\n        this._caps.maxCombinedTexturesImageUnits = this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);\r\n        this._caps.maxVertexTextureImageUnits = this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n        this._caps.maxTextureSize = this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE);\r\n        this._caps.maxCubemapTextureSize = this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n        this._caps.maxRenderTextureSize = this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE);\r\n        this._caps.maxVertexAttribs = this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS);\r\n        this._caps.maxVaryingVectors = this._gl.getParameter(this._gl.MAX_VARYING_VECTORS);\r\n        this._caps.maxFragmentUniformVectors = this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS);\r\n        this._caps.maxVertexUniformVectors = this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n\r\n        // Infos\r\n        this._glVersion = this._gl.getParameter(this._gl.VERSION);\r\n\r\n        var rendererInfo: any = this._gl.getExtension(\"WEBGL_debug_renderer_info\");\r\n        if (rendererInfo != null) {\r\n            this._glRenderer = this._gl.getParameter(rendererInfo.UNMASKED_RENDERER_WEBGL);\r\n            this._glVendor = this._gl.getParameter(rendererInfo.UNMASKED_VENDOR_WEBGL);\r\n        }\r\n\r\n        if (!this._glVendor) {\r\n            this._glVendor = \"Unknown vendor\";\r\n        }\r\n\r\n        if (!this._glRenderer) {\r\n            this._glRenderer = \"Unknown renderer\";\r\n        }\r\n\r\n        // Constants\r\n        this._gl.HALF_FLOAT_OES = 0x8D61;   // Half floating-point type (16-bit).\r\n        if (this._gl.RGBA16F !== 0x881A) {\r\n            this._gl.RGBA16F = 0x881A;      // RGBA 16-bit floating-point color-renderable internal sized format.\r\n        }\r\n        if (this._gl.RGBA32F !== 0x8814) {\r\n            this._gl.RGBA32F = 0x8814;      // RGBA 32-bit floating-point color-renderable internal sized format.\r\n        }\r\n        if (this._gl.DEPTH24_STENCIL8 !== 35056) {\r\n            this._gl.DEPTH24_STENCIL8 = 35056;\r\n        }\r\n\r\n        // Extensions\r\n        this._caps.standardDerivatives = this._webGLVersion > 1 || (this._gl.getExtension('OES_standard_derivatives') !== null);\r\n\r\n        this._caps.astc = this._gl.getExtension('WEBGL_compressed_texture_astc') || this._gl.getExtension('WEBKIT_WEBGL_compressed_texture_astc');\r\n        this._caps.s3tc = this._gl.getExtension('WEBGL_compressed_texture_s3tc') || this._gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\r\n        this._caps.pvrtc = this._gl.getExtension('WEBGL_compressed_texture_pvrtc') || this._gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\r\n        this._caps.etc1 = this._gl.getExtension('WEBGL_compressed_texture_etc1') || this._gl.getExtension('WEBKIT_WEBGL_compressed_texture_etc1');\r\n        this._caps.etc2 = this._gl.getExtension('WEBGL_compressed_texture_etc') || this._gl.getExtension('WEBKIT_WEBGL_compressed_texture_etc') ||\r\n            this._gl.getExtension('WEBGL_compressed_texture_es3_0'); // also a requirement of OpenGL ES 3\r\n\r\n        this._caps.textureAnisotropicFilterExtension = this._gl.getExtension('EXT_texture_filter_anisotropic') || this._gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic') || this._gl.getExtension('MOZ_EXT_texture_filter_anisotropic');\r\n        this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0;\r\n        this._caps.uintIndices = this._webGLVersion > 1 || this._gl.getExtension('OES_element_index_uint') !== null;\r\n        this._caps.fragmentDepthSupported = this._webGLVersion > 1 || this._gl.getExtension('EXT_frag_depth') !== null;\r\n        this._caps.highPrecisionShaderSupported = false;\r\n        this._caps.timerQuery = this._gl.getExtension('EXT_disjoint_timer_query_webgl2') || this._gl.getExtension(\"EXT_disjoint_timer_query\");\r\n        if (this._caps.timerQuery) {\r\n            if (this._webGLVersion === 1) {\r\n                this._gl.getQuery = (<any>this._caps.timerQuery).getQueryEXT.bind(this._caps.timerQuery);\r\n            }\r\n            this._caps.canUseTimestampForTimerQuery = this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT) > 0;\r\n        }\r\n\r\n        // Checks if some of the format renders first to allow the use of webgl inspector.\r\n        this._caps.colorBufferFloat = this._webGLVersion > 1 && this._gl.getExtension('EXT_color_buffer_float');\r\n\r\n        this._caps.textureFloat = (this._webGLVersion > 1 || this._gl.getExtension('OES_texture_float')) ? true : false;\r\n        this._caps.textureFloatLinearFiltering = this._caps.textureFloat && this._gl.getExtension('OES_texture_float_linear') ? true : false;\r\n        this._caps.textureFloatRender = this._caps.textureFloat && this._canRenderToFloatFramebuffer() ? true : false;\r\n\r\n        this._caps.textureHalfFloat = (this._webGLVersion > 1 || this._gl.getExtension('OES_texture_half_float')) ? true : false;\r\n        this._caps.textureHalfFloatLinearFiltering = (this._webGLVersion > 1 || (this._caps.textureHalfFloat && this._gl.getExtension('OES_texture_half_float_linear'))) ? true : false;\r\n        if (this._webGLVersion > 1) {\r\n            this._gl.HALF_FLOAT_OES = 0x140B;\r\n        }\r\n        this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer();\r\n\r\n        this._caps.textureLOD = (this._webGLVersion > 1 || this._gl.getExtension('EXT_shader_texture_lod')) ? true : false;\r\n\r\n        this._caps.multiview = this._gl.getExtension('OVR_multiview2');\r\n        // Draw buffers\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.drawBuffersExtension = true;\r\n        } else {\r\n            var drawBuffersExtension = this._gl.getExtension('WEBGL_draw_buffers');\r\n\r\n            if (drawBuffersExtension !== null) {\r\n                this._caps.drawBuffersExtension = true;\r\n                this._gl.drawBuffers = drawBuffersExtension.drawBuffersWEBGL.bind(drawBuffersExtension);\r\n                this._gl.DRAW_FRAMEBUFFER = this._gl.FRAMEBUFFER;\r\n\r\n                for (var i = 0; i < 16; i++) {\r\n                    (<any>this._gl)[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"] = (<any>drawBuffersExtension)[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"];\r\n                }\r\n            } else {\r\n                this._caps.drawBuffersExtension = false;\r\n            }\r\n        }\r\n\r\n        // Shader compiler threads\r\n        this._caps.parallelShaderCompile = this._gl.getExtension('KHR_parallel_shader_compile');\r\n\r\n        // Depth Texture\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.depthTextureExtension = true;\r\n        } else {\r\n            var depthTextureExtension = this._gl.getExtension('WEBGL_depth_texture');\r\n\r\n            if (depthTextureExtension != null) {\r\n                this._caps.depthTextureExtension = true;\r\n                this._gl.UNSIGNED_INT_24_8 = depthTextureExtension.UNSIGNED_INT_24_8_WEBGL;\r\n            }\r\n        }\r\n\r\n        // Vertex array object\r\n        if (this.disableVertexArrayObjects) {\r\n            this._caps.vertexArrayObject = false;\r\n        } else if (this._webGLVersion > 1) {\r\n            this._caps.vertexArrayObject = true;\r\n        } else {\r\n            var vertexArrayObjectExtension = this._gl.getExtension('OES_vertex_array_object');\r\n\r\n            if (vertexArrayObjectExtension != null) {\r\n                this._caps.vertexArrayObject = true;\r\n                this._gl.createVertexArray = vertexArrayObjectExtension.createVertexArrayOES.bind(vertexArrayObjectExtension);\r\n                this._gl.bindVertexArray = vertexArrayObjectExtension.bindVertexArrayOES.bind(vertexArrayObjectExtension);\r\n                this._gl.deleteVertexArray = vertexArrayObjectExtension.deleteVertexArrayOES.bind(vertexArrayObjectExtension);\r\n            } else {\r\n                this._caps.vertexArrayObject = false;\r\n            }\r\n        }\r\n\r\n        // Instances count\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.instancedArrays = true;\r\n        } else {\r\n            var instanceExtension = <ANGLE_instanced_arrays>this._gl.getExtension('ANGLE_instanced_arrays');\r\n\r\n            if (instanceExtension != null) {\r\n                this._caps.instancedArrays = true;\r\n                this._gl.drawArraysInstanced = instanceExtension.drawArraysInstancedANGLE.bind(instanceExtension);\r\n                this._gl.drawElementsInstanced = instanceExtension.drawElementsInstancedANGLE.bind(instanceExtension);\r\n                this._gl.vertexAttribDivisor = instanceExtension.vertexAttribDivisorANGLE.bind(instanceExtension);\r\n            } else {\r\n                this._caps.instancedArrays = false;\r\n            }\r\n        }\r\n\r\n        // Intelligently add supported compressed formats in order to check for.\r\n        // Check for ASTC support first as it is most powerful and to be very cross platform.\r\n        // Next PVRTC & DXT, which are probably superior to ETC1/2.\r\n        // Likely no hardware which supports both PVR & DXT, so order matters little.\r\n        // ETC2 is newer and handles ETC1 (no alpha capability), so check for first.\r\n        if (this._caps.astc) { this.texturesSupported.push('-astc.ktx'); }\r\n        if (this._caps.s3tc) { this.texturesSupported.push('-dxt.ktx'); }\r\n        if (this._caps.pvrtc) { this.texturesSupported.push('-pvrtc.ktx'); }\r\n        if (this._caps.etc2) { this.texturesSupported.push('-etc2.ktx'); }\r\n        if (this._caps.etc1) { this.texturesSupported.push('-etc1.ktx'); }\r\n\r\n        if (this._gl.getShaderPrecisionFormat) {\r\n            var vertex_highp = this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER, this._gl.HIGH_FLOAT);\r\n            var fragment_highp = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT);\r\n\r\n            if (vertex_highp && fragment_highp) {\r\n                this._caps.highPrecisionShaderSupported = vertex_highp.precision !== 0 && fragment_highp.precision !== 0;\r\n            }\r\n        }\r\n\r\n        // Depth buffer\r\n        this.setDepthBuffer(true);\r\n        this.setDepthFunctionToLessOrEqual();\r\n        this.setDepthWrite(true);\r\n\r\n        // Texture maps\r\n        this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits;\r\n        for (let slot = 0; slot < this._maxSimultaneousTextures; slot++) {\r\n            this._nextFreeTextureSlots.push(slot);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets version of the current webGL context\r\n     */\r\n    public get webGLVersion(): number {\r\n        return this._webGLVersion;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the stencil buffer has been enabled through the creation option of the context.\r\n     */\r\n    public get isStencilEnable(): boolean {\r\n        return this._isStencilEnable;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _prepareWorkingCanvas(): void {\r\n        if (this._workingCanvas) {\r\n            return;\r\n        }\r\n\r\n        this._workingCanvas = document.createElement(\"canvas\");\r\n        let context = this._workingCanvas.getContext(\"2d\");\r\n\r\n        if (context) {\r\n            this._workingContext = context;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset the texture cache to empty state\r\n     */\r\n    public resetTextureCache() {\r\n        for (var key in this._boundTexturesCache) {\r\n            if (!this._boundTexturesCache.hasOwnProperty(key)) {\r\n                continue;\r\n            }\r\n            this._boundTexturesCache[key] = null;\r\n        }\r\n\r\n        this._currentTextureChannel = -1;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine is running in deterministic lock step mode\r\n     * @see http://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\r\n     * @returns true if engine is in deterministic lock step mode\r\n     */\r\n    public isDeterministicLockStep(): boolean {\r\n        return this._deterministicLockstep;\r\n    }\r\n\r\n    /**\r\n     * Gets the max steps when engine is running in deterministic lock step\r\n     * @see http://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\r\n     * @returns the max steps\r\n     */\r\n    public getLockstepMaxSteps(): number {\r\n        return this._lockstepMaxSteps;\r\n    }\r\n\r\n    /**\r\n     * Gets an object containing information about the current webGL context\r\n     * @returns an object containing the vender, the renderer and the version of the current webGL context\r\n     */\r\n    public getGlInfo() {\r\n        return {\r\n            vendor: this._glVendor,\r\n            renderer: this._glRenderer,\r\n            version: this._glVersion\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets current aspect ratio\r\n     * @param camera defines the camera to use to get the aspect ratio\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the aspect ratio\r\n     */\r\n    public getAspectRatio(camera: Camera, useScreen = false): number {\r\n        var viewport = camera.viewport;\r\n        return (this.getRenderWidth(useScreen) * viewport.width) / (this.getRenderHeight(useScreen) * viewport.height);\r\n    }\r\n\r\n    /**\r\n     * Gets current screen aspect ratio\r\n     * @returns a number defining the aspect ratio\r\n     */\r\n    public getScreenAspectRatio(): number {\r\n        return (this.getRenderWidth(true)) / (this.getRenderHeight(true));\r\n    }\r\n\r\n    /**\r\n     * Gets the current render width\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render width\r\n     */\r\n    public getRenderWidth(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.width;\r\n        }\r\n\r\n        return this._gl.drawingBufferWidth;\r\n    }\r\n\r\n    /**\r\n     * Gets the current render height\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render height\r\n     */\r\n    public getRenderHeight(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.height;\r\n        }\r\n\r\n        return this._gl.drawingBufferHeight;\r\n    }\r\n\r\n    /**\r\n     * Gets the HTML canvas attached with the current webGL context\r\n     * @returns a HTML canvas\r\n     */\r\n    public getRenderingCanvas(): Nullable<HTMLCanvasElement> {\r\n        return this._renderingCanvas;\r\n    }\r\n\r\n    /**\r\n     * Gets the client rect of the HTML canvas attached with the current webGL context\r\n     * @returns a client rectanglee\r\n     */\r\n    public getRenderingCanvasClientRect(): Nullable<ClientRect> {\r\n        if (!this._renderingCanvas) {\r\n            return null;\r\n        }\r\n        return this._renderingCanvas.getBoundingClientRect();\r\n    }\r\n\r\n    /**\r\n     * Defines the hardware scaling level.\r\n     * By default the hardware scaling level is computed from the window device ratio.\r\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\r\n     * @param level defines the level to use\r\n     */\r\n    public setHardwareScalingLevel(level: number): void {\r\n        this._hardwareScalingLevel = level;\r\n        this.resize();\r\n    }\r\n\r\n    /**\r\n     * Gets the current hardware scaling level.\r\n     * By default the hardware scaling level is computed from the window device ratio.\r\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\r\n     * @returns a number indicating the current hardware scaling level\r\n     */\r\n    public getHardwareScalingLevel(): number {\r\n        return this._hardwareScalingLevel;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of loaded textures\r\n     * @returns an array containing all loaded textures\r\n     */\r\n    public getLoadedTexturesCache(): InternalTexture[] {\r\n        return this._internalTexturesCache;\r\n    }\r\n\r\n    /**\r\n     * Gets the object containing all engine capabilities\r\n     * @returns the EngineCapabilities object\r\n     */\r\n    public getCaps(): EngineCapabilities {\r\n        return this._caps;\r\n    }\r\n\r\n    /**\r\n     * Gets the current depth function\r\n     * @returns a number defining the depth function\r\n     */\r\n    public getDepthFunction(): Nullable<number> {\r\n        return this._depthCullingState.depthFunc;\r\n    }\r\n\r\n    /**\r\n     * Sets the current depth function\r\n     * @param depthFunc defines the function to use\r\n     */\r\n    public setDepthFunction(depthFunc: number) {\r\n        this._depthCullingState.depthFunc = depthFunc;\r\n    }\r\n\r\n    /**\r\n     * Sets the current depth function to GREATER\r\n     */\r\n    public setDepthFunctionToGreater(): void {\r\n        this._depthCullingState.depthFunc = this._gl.GREATER;\r\n    }\r\n\r\n    /**\r\n     * Sets the current depth function to GEQUAL\r\n     */\r\n    public setDepthFunctionToGreaterOrEqual(): void {\r\n        this._depthCullingState.depthFunc = this._gl.GEQUAL;\r\n    }\r\n\r\n    /**\r\n     * Sets the current depth function to LESS\r\n     */\r\n    public setDepthFunctionToLess(): void {\r\n        this._depthCullingState.depthFunc = this._gl.LESS;\r\n    }\r\n\r\n    private _cachedStencilBuffer: boolean;\r\n    private _cachedStencilFunction: number;\r\n    private _cachedStencilMask: number;\r\n    private _cachedStencilOperationPass: number;\r\n    private _cachedStencilOperationFail: number;\r\n    private _cachedStencilOperationDepthFail: number;\r\n    private _cachedStencilReference: number;\r\n\r\n    /**\r\n     * Caches the the state of the stencil buffer\r\n     */\r\n    public cacheStencilState() {\r\n        this._cachedStencilBuffer = this.getStencilBuffer();\r\n        this._cachedStencilFunction = this.getStencilFunction();\r\n        this._cachedStencilMask = this.getStencilMask();\r\n        this._cachedStencilOperationPass = this.getStencilOperationPass();\r\n        this._cachedStencilOperationFail = this.getStencilOperationFail();\r\n        this._cachedStencilOperationDepthFail = this.getStencilOperationDepthFail();\r\n        this._cachedStencilReference = this.getStencilFunctionReference();\r\n    }\r\n\r\n    /**\r\n     * Restores the state of the stencil buffer\r\n     */\r\n    public restoreStencilState() {\r\n        this.setStencilFunction(this._cachedStencilFunction);\r\n        this.setStencilMask(this._cachedStencilMask);\r\n        this.setStencilBuffer(this._cachedStencilBuffer);\r\n        this.setStencilOperationPass(this._cachedStencilOperationPass);\r\n        this.setStencilOperationFail(this._cachedStencilOperationFail);\r\n        this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail);\r\n        this.setStencilFunctionReference(this._cachedStencilReference);\r\n    }\r\n\r\n    /**\r\n     * Sets the current depth function to LEQUAL\r\n     */\r\n    public setDepthFunctionToLessOrEqual(): void {\r\n        this._depthCullingState.depthFunc = this._gl.LEQUAL;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if stencil buffer is enabled\r\n     * @returns the current stencil buffer state\r\n     */\r\n    public getStencilBuffer(): boolean {\r\n        return this._stencilState.stencilTest;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable the stencil buffer\r\n     * @param enable defines if the stencil buffer must be enabled or disabled\r\n     */\r\n    public setStencilBuffer(enable: boolean): void {\r\n        this._stencilState.stencilTest = enable;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil mask\r\n     * @returns a number defining the new stencil mask to use\r\n     */\r\n    public getStencilMask(): number {\r\n        return this._stencilState.stencilMask;\r\n    }\r\n\r\n    /**\r\n     * Sets the current stencil mask\r\n     * @param mask defines the new stencil mask to use\r\n     */\r\n    public setStencilMask(mask: number): void {\r\n        this._stencilState.stencilMask = mask;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil function\r\n     * @returns a number defining the stencil function to use\r\n     */\r\n    public getStencilFunction(): number {\r\n        return this._stencilState.stencilFunc;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil reference value\r\n     * @returns a number defining the stencil reference value to use\r\n     */\r\n    public getStencilFunctionReference(): number {\r\n        return this._stencilState.stencilFuncRef;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil mask\r\n     * @returns a number defining the stencil mask to use\r\n     */\r\n    public getStencilFunctionMask(): number {\r\n        return this._stencilState.stencilFuncMask;\r\n    }\r\n\r\n    /**\r\n     * Sets the current stencil function\r\n     * @param stencilFunc defines the new stencil function to use\r\n     */\r\n    public setStencilFunction(stencilFunc: number) {\r\n        this._stencilState.stencilFunc = stencilFunc;\r\n    }\r\n\r\n    /**\r\n     * Sets the current stencil reference\r\n     * @param reference defines the new stencil reference to use\r\n     */\r\n    public setStencilFunctionReference(reference: number) {\r\n        this._stencilState.stencilFuncRef = reference;\r\n    }\r\n\r\n    /**\r\n     * Sets the current stencil mask\r\n     * @param mask defines the new stencil mask to use\r\n     */\r\n    public setStencilFunctionMask(mask: number) {\r\n        this._stencilState.stencilFuncMask = mask;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil operation when stencil fails\r\n     * @returns a number defining stencil operation to use when stencil fails\r\n     */\r\n    public getStencilOperationFail(): number {\r\n        return this._stencilState.stencilOpStencilFail;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil operation when depth fails\r\n     * @returns a number defining stencil operation to use when depth fails\r\n     */\r\n    public getStencilOperationDepthFail(): number {\r\n        return this._stencilState.stencilOpDepthFail;\r\n    }\r\n\r\n    /**\r\n     * Gets the current stencil operation when stencil passes\r\n     * @returns a number defining stencil operation to use when stencil passes\r\n     */\r\n    public getStencilOperationPass(): number {\r\n        return this._stencilState.stencilOpStencilDepthPass;\r\n    }\r\n\r\n    /**\r\n     * Sets the stencil operation to use when stencil fails\r\n     * @param operation defines the stencil operation to use when stencil fails\r\n     */\r\n    public setStencilOperationFail(operation: number): void {\r\n        this._stencilState.stencilOpStencilFail = operation;\r\n    }\r\n\r\n    /**\r\n     * Sets the stencil operation to use when depth fails\r\n     * @param operation defines the stencil operation to use when depth fails\r\n     */\r\n    public setStencilOperationDepthFail(operation: number): void {\r\n        this._stencilState.stencilOpDepthFail = operation;\r\n    }\r\n\r\n    /**\r\n     * Sets the stencil operation to use when stencil passes\r\n     * @param operation defines the stencil operation to use when stencil passes\r\n     */\r\n    public setStencilOperationPass(operation: number): void {\r\n        this._stencilState.stencilOpStencilDepthPass = operation;\r\n    }\r\n\r\n    /**\r\n     * Sets a boolean indicating if the dithering state is enabled or disabled\r\n     * @param value defines the dithering state\r\n     */\r\n    public setDitheringState(value: boolean): void {\r\n        if (value) {\r\n            this._gl.enable(this._gl.DITHER);\r\n        } else {\r\n            this._gl.disable(this._gl.DITHER);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a boolean indicating if the rasterizer state is enabled or disabled\r\n     * @param value defines the rasterizer state\r\n     */\r\n    public setRasterizerState(value: boolean): void {\r\n        if (value) {\r\n            this._gl.disable(this._gl.RASTERIZER_DISCARD);\r\n        } else {\r\n            this._gl.enable(this._gl.RASTERIZER_DISCARD);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * stop executing a render loop function and remove it from the execution array\r\n     * @param renderFunction defines the function to be removed. If not provided all functions will be removed.\r\n     */\r\n    public stopRenderLoop(renderFunction?: () => void): void {\r\n        if (!renderFunction) {\r\n            this._activeRenderLoops = [];\r\n            return;\r\n        }\r\n\r\n        var index = this._activeRenderLoops.indexOf(renderFunction);\r\n\r\n        if (index >= 0) {\r\n            this._activeRenderLoops.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _renderLoop(): void {\r\n        if (!this._contextWasLost) {\r\n            var shouldRender = true;\r\n            if (!this.renderEvenInBackground && this._windowIsBackground) {\r\n                shouldRender = false;\r\n            }\r\n\r\n            if (shouldRender) {\r\n                // Start new frame\r\n                this.beginFrame();\r\n\r\n                for (var index = 0; index < this._activeRenderLoops.length; index++) {\r\n                    var renderFunction = this._activeRenderLoops[index];\r\n\r\n                    renderFunction();\r\n                }\r\n\r\n                // Present\r\n                this.endFrame();\r\n            }\r\n        }\r\n\r\n        if (this._activeRenderLoops.length > 0) {\r\n            // Register new frame\r\n            if (this.customAnimationFrameRequester) {\r\n                this.customAnimationFrameRequester.requestID = Tools.QueueNewFrame(this.customAnimationFrameRequester.renderFunction || this._bindedRenderFunction, this.customAnimationFrameRequester);\r\n                this._frameHandler = this.customAnimationFrameRequester.requestID;\r\n            } else if (this.isVRPresenting()) {\r\n                this._requestVRFrame();\r\n            } else {\r\n                this._frameHandler = Tools.QueueNewFrame(this._bindedRenderFunction);\r\n            }\r\n        } else {\r\n            this._renderingQueueLaunched = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register and execute a render loop. The engine can have more than one render function\r\n     * @param renderFunction defines the function to continuously execute\r\n     */\r\n    public runRenderLoop(renderFunction: () => void): void {\r\n        if (this._activeRenderLoops.indexOf(renderFunction) !== -1) {\r\n            return;\r\n        }\r\n\r\n        this._activeRenderLoops.push(renderFunction);\r\n\r\n        if (!this._renderingQueueLaunched) {\r\n            this._renderingQueueLaunched = true;\r\n            this._bindedRenderFunction = this._renderLoop.bind(this);\r\n            this._frameHandler = Tools.QueueNewFrame(this._bindedRenderFunction);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle full screen mode\r\n     * @param requestPointerLock defines if a pointer lock should be requested from the user\r\n     */\r\n    public switchFullscreen(requestPointerLock: boolean): void {\r\n        if (this.isFullscreen) {\r\n            this.exitFullscreen();\r\n        } else {\r\n            this.enterFullscreen(requestPointerLock);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enters full screen mode\r\n     * @param requestPointerLock defines if a pointer lock should be requested from the user\r\n     */\r\n    public enterFullscreen(requestPointerLock: boolean): void {\r\n        if (!this.isFullscreen) {\r\n            this._pointerLockRequested = requestPointerLock;\r\n            if (this._renderingCanvas) {\r\n                Tools.RequestFullscreen(this._renderingCanvas);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Exits full screen mode\r\n     */\r\n    public exitFullscreen(): void {\r\n        if (this.isFullscreen) {\r\n            Tools.ExitFullscreen();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the current render buffer or the current render target (if any is set up)\r\n     * @param color defines the color to use\r\n     * @param backBuffer defines if the back buffer must be cleared\r\n     * @param depth defines if the depth buffer must be cleared\r\n     * @param stencil defines if the stencil buffer must be cleared\r\n     */\r\n    public clear(color: Nullable<Color4>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\r\n        this.applyStates();\r\n\r\n        var mode = 0;\r\n        if (backBuffer && color) {\r\n            this._gl.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\r\n            mode |= this._gl.COLOR_BUFFER_BIT;\r\n        }\r\n        if (depth) {\r\n            this._gl.clearDepth(1.0);\r\n            mode |= this._gl.DEPTH_BUFFER_BIT;\r\n        }\r\n        if (stencil) {\r\n            this._gl.clearStencil(0);\r\n            mode |= this._gl.STENCIL_BUFFER_BIT;\r\n        }\r\n        this._gl.clear(mode);\r\n    }\r\n\r\n    /**\r\n     * Executes a scissor clear (ie. a clear on a specific portion of the screen)\r\n     * @param x defines the x-coordinate of the top left corner of the clear rectangle\r\n     * @param y defines the y-coordinate of the corner of the clear rectangle\r\n     * @param width defines the width of the clear rectangle\r\n     * @param height defines the height of the clear rectangle\r\n     * @param clearColor defines the clear color\r\n     */\r\n    public scissorClear(x: number, y: number, width: number, height: number, clearColor: Color4): void {\r\n        this.enableScissor(x, y, width, height);\r\n        this.clear(clearColor, true, true, true);\r\n        this.disableScissor();\r\n    }\r\n\r\n    /**\r\n     * Enable scissor test on a specific rectangle (ie. render will only be executed on a specific portion of the screen)\r\n     * @param x defines the x-coordinate of the top left corner of the clear rectangle\r\n     * @param y defines the y-coordinate of the corner of the clear rectangle\r\n     * @param width defines the width of the clear rectangle\r\n     * @param height defines the height of the clear rectangle\r\n     */\r\n    public enableScissor(x: number, y: number, width: number, height: number): void {\r\n        let gl = this._gl;\r\n\r\n        // Change state\r\n        gl.enable(gl.SCISSOR_TEST);\r\n        gl.scissor(x, y, width, height);\r\n    }\r\n\r\n    /**\r\n     * Disable previously set scissor test rectangle\r\n     */\r\n    public disableScissor() {\r\n        let gl = this._gl;\r\n\r\n        gl.disable(gl.SCISSOR_TEST);\r\n    }\r\n\r\n    private _viewportCached = new Vector4(0, 0, 0, 0);\r\n\r\n    /** @hidden */\r\n    public _viewport(x: number, y: number, width: number, height: number): void {\r\n        if (x !== this._viewportCached.x ||\r\n            y !== this._viewportCached.y ||\r\n            width !== this._viewportCached.z ||\r\n            height !== this._viewportCached.w) {\r\n            this._viewportCached.x = x;\r\n            this._viewportCached.y = y;\r\n            this._viewportCached.z = width;\r\n            this._viewportCached.w = height;\r\n\r\n            this._gl.viewport(x, y, width, height);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the WebGL's viewport\r\n     * @param viewport defines the viewport element to be used\r\n     * @param requiredWidth defines the width required for rendering. If not provided the rendering canvas' width is used\r\n     * @param requiredHeight defines the height required for rendering. If not provided the rendering canvas' height is used\r\n     */\r\n    public setViewport(viewport: Viewport, requiredWidth?: number, requiredHeight?: number): void {\r\n        var width = requiredWidth || this.getRenderWidth();\r\n        var height = requiredHeight || this.getRenderHeight();\r\n        var x = viewport.x || 0;\r\n        var y = viewport.y || 0;\r\n\r\n        this._cachedViewport = viewport;\r\n\r\n        this._viewport(x * width, y * height, width * viewport.width, height * viewport.height);\r\n    }\r\n\r\n    /**\r\n     * Directly set the WebGL Viewport\r\n     * @param x defines the x coordinate of the viewport (in screen space)\r\n     * @param y defines the y coordinate of the viewport (in screen space)\r\n     * @param width defines the width of the viewport (in screen space)\r\n     * @param height defines the height of the viewport (in screen space)\r\n     * @return the current viewport Object (if any) that is being replaced by this call. You can restore this viewport later on to go back to the original state\r\n     */\r\n    public setDirectViewport(x: number, y: number, width: number, height: number): Nullable<Viewport> {\r\n        let currentViewport = this._cachedViewport;\r\n        this._cachedViewport = null;\r\n\r\n        this._viewport(x, y, width, height);\r\n\r\n        return currentViewport;\r\n    }\r\n\r\n    /**\r\n     * Begin a new frame\r\n     */\r\n    public beginFrame(): void {\r\n        this.onBeginFrameObservable.notifyObservers(this);\r\n        this._measureFps();\r\n    }\r\n\r\n    /**\r\n     * Enf the current frame\r\n     */\r\n    public endFrame(): void {\r\n        // Force a flush in case we are using a bad OS.\r\n        if (this._badOS) {\r\n            this.flushFramebuffer();\r\n        }\r\n\r\n        this._submitVRFrame();\r\n\r\n        this.onEndFrameObservable.notifyObservers(this);\r\n    }\r\n\r\n    /**\r\n     * Resize the view according to the canvas' size\r\n     */\r\n    public resize(): void {\r\n        // We're not resizing the size of the canvas while in VR mode & presenting\r\n        if (!this.isVRPresenting()) {\r\n            var width = this._renderingCanvas ? this._renderingCanvas.clientWidth : window.innerWidth;\r\n            var height = this._renderingCanvas ? this._renderingCanvas.clientHeight : window.innerHeight;\r\n\r\n            this.setSize(width / this._hardwareScalingLevel, height / this._hardwareScalingLevel);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force a specific size of the canvas\r\n     * @param width defines the new canvas' width\r\n     * @param height defines the new canvas' height\r\n     */\r\n    public setSize(width: number, height: number): void {\r\n        if (!this._renderingCanvas) {\r\n            return;\r\n        }\r\n\r\n        if (this._renderingCanvas.width === width && this._renderingCanvas.height === height) {\r\n            return;\r\n        }\r\n\r\n        this._renderingCanvas.width = width;\r\n        this._renderingCanvas.height = height;\r\n\r\n        for (var index = 0; index < this.scenes.length; index++) {\r\n            var scene = this.scenes[index];\r\n\r\n            for (var camIndex = 0; camIndex < scene.cameras.length; camIndex++) {\r\n                var cam = scene.cameras[camIndex];\r\n\r\n                cam._currentRenderId = 0;\r\n            }\r\n        }\r\n\r\n        if (this.onResizeObservable.hasObservers) {\r\n            this.onResizeObservable.notifyObservers(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Binds the frame buffer to the specified texture.\r\n     * @param texture The texture to render to or null for the default canvas\r\n     * @param faceIndex The face of the texture to render to in case of cube texture\r\n     * @param requiredWidth The width of the target to render to\r\n     * @param requiredHeight The height of the target to render to\r\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\r\n     * @param depthStencilTexture The depth stencil texture to use to render\r\n     * @param lodLevel defines le lod level to bind to the frame buffer\r\n     */\r\n    public bindFramebuffer(texture: InternalTexture, faceIndex?: number, requiredWidth?: number, requiredHeight?: number, forceFullscreenViewport?: boolean, depthStencilTexture?: InternalTexture, lodLevel = 0): void {\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        }\r\n        this._currentRenderTarget = texture;\r\n        this._bindUnboundFramebuffer(texture._MSAAFramebuffer ? texture._MSAAFramebuffer : texture._framebuffer);\r\n        var gl = this._gl;\r\n        if (texture.isCube) {\r\n            if (faceIndex === undefined) {\r\n                faceIndex = 0;\r\n            }\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, texture._webGLTexture, lodLevel);\r\n\r\n            if (depthStencilTexture) {\r\n                if (depthStencilTexture._generateStencilBuffer) {\r\n                    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, depthStencilTexture._webGLTexture, lodLevel);\r\n                }\r\n                else {\r\n                    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, depthStencilTexture._webGLTexture, lodLevel);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._cachedViewport && !forceFullscreenViewport) {\r\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\r\n        } else {\r\n            if (!requiredWidth) {\r\n                requiredWidth = texture.width;\r\n                if (lodLevel) {\r\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n            if (!requiredHeight) {\r\n                requiredHeight = texture.height;\r\n                if (lodLevel) {\r\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n\r\n            this._viewport(0, 0, requiredWidth, requiredHeight);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    /** @hidden */\r\n    public _bindUnboundFramebuffer(framebuffer: Nullable<WebGLFramebuffer>) {\r\n        if (this._currentFramebuffer !== framebuffer) {\r\n            this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, framebuffer);\r\n            this._currentFramebuffer = framebuffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target texture from the webGL context\r\n     * @param texture defines the render target texture to unbind\r\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\r\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\r\n     */\r\n    public unBindFramebuffer(texture: InternalTexture, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\r\n        this._currentRenderTarget = null;\r\n\r\n        // If MSAA, we need to bitblt back to main texture\r\n        var gl = this._gl;\r\n\r\n        if (texture._MSAAFramebuffer) {\r\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, texture._MSAAFramebuffer);\r\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, texture._framebuffer);\r\n            gl.blitFramebuffer(0, 0, texture.width, texture.height,\r\n                0, 0, texture.width, texture.height,\r\n                gl.COLOR_BUFFER_BIT, gl.NEAREST);\r\n        }\r\n\r\n        if (texture.generateMipMaps && !disableGenerateMipMaps && !texture.isCube) {\r\n            this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n            this._bindTextureDirectly(gl.TEXTURE_2D, null);\r\n        }\r\n\r\n        if (onBeforeUnbind) {\r\n            if (texture._MSAAFramebuffer) {\r\n                // Bind the correct framebuffer\r\n                this._bindUnboundFramebuffer(texture._framebuffer);\r\n            }\r\n            onBeforeUnbind();\r\n        }\r\n\r\n        this._bindUnboundFramebuffer(null);\r\n    }\r\n\r\n    /**\r\n     * Force the mipmap generation for the given render target texture\r\n     * @param texture defines the render target texture to use\r\n     */\r\n    public generateMipMapsForCubemap(texture: InternalTexture) {\r\n        if (texture.generateMipMaps) {\r\n            var gl = this._gl;\r\n            this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP, texture, true);\r\n            gl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n            this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP, null);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force a webGL flush (ie. a flush of all waiting webGL commands)\r\n     */\r\n    public flushFramebuffer(): void {\r\n        this._gl.flush();\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target and bind the default framebuffer\r\n     */\r\n    public restoreDefaultFramebuffer(): void {\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        } else {\r\n            this._bindUnboundFramebuffer(null);\r\n        }\r\n        if (this._cachedViewport) {\r\n            this.setViewport(this._cachedViewport);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    // UBOs\r\n\r\n    /**\r\n     * Create an uniform buffer\r\n     * @see http://doc.babylonjs.com/features/webgl2#uniform-buffer-objets\r\n     * @param elements defines the content of the uniform buffer\r\n     * @returns the webGL uniform buffer\r\n     */\r\n    public createUniformBuffer(elements: FloatArray): DataBuffer {\r\n        var ubo = this._gl.createBuffer();\r\n\r\n        if (!ubo) {\r\n            throw new Error(\"Unable to create uniform buffer\");\r\n        }\r\n        let result = new WebGLDataBuffer(ubo);\r\n\r\n        this.bindUniformBuffer(result);\r\n\r\n        if (elements instanceof Float32Array) {\r\n            this._gl.bufferData(this._gl.UNIFORM_BUFFER, <Float32Array>elements, this._gl.STATIC_DRAW);\r\n        } else {\r\n            this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(<number[]>elements), this._gl.STATIC_DRAW);\r\n        }\r\n\r\n        this.bindUniformBuffer(null);\r\n\r\n        result.references = 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Create a dynamic uniform buffer\r\n     * @see http://doc.babylonjs.com/features/webgl2#uniform-buffer-objets\r\n     * @param elements defines the content of the uniform buffer\r\n     * @returns the webGL uniform buffer\r\n     */\r\n    public createDynamicUniformBuffer(elements: FloatArray): DataBuffer {\r\n        var ubo = this._gl.createBuffer();\r\n\r\n        if (!ubo) {\r\n            throw new Error(\"Unable to create dynamic uniform buffer\");\r\n        }\r\n\r\n        let result = new WebGLDataBuffer(ubo);\r\n        this.bindUniformBuffer(result);\r\n\r\n        if (elements instanceof Float32Array) {\r\n            this._gl.bufferData(this._gl.UNIFORM_BUFFER, <Float32Array>elements, this._gl.DYNAMIC_DRAW);\r\n        } else {\r\n            this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(<number[]>elements), this._gl.DYNAMIC_DRAW);\r\n        }\r\n\r\n        this.bindUniformBuffer(null);\r\n\r\n        result.references = 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Update an existing uniform buffer\r\n     * @see http://doc.babylonjs.com/features/webgl2#uniform-buffer-objets\r\n     * @param uniformBuffer defines the target uniform buffer\r\n     * @param elements defines the content to update\r\n     * @param offset defines the offset in the uniform buffer where update should start\r\n     * @param count defines the size of the data to update\r\n     */\r\n    public updateUniformBuffer(uniformBuffer: DataBuffer, elements: FloatArray, offset?: number, count?: number): void {\r\n        this.bindUniformBuffer(uniformBuffer);\r\n\r\n        if (offset === undefined) {\r\n            offset = 0;\r\n        }\r\n\r\n        if (count === undefined) {\r\n            if (elements instanceof Float32Array) {\r\n                this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, offset, <Float32Array>elements);\r\n            } else {\r\n                this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, offset, new Float32Array(<number[]>elements));\r\n            }\r\n        } else {\r\n            if (elements instanceof Float32Array) {\r\n                this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, <Float32Array>elements.subarray(offset, offset + count));\r\n            } else {\r\n                this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, new Float32Array(<number[]>elements).subarray(offset, offset + count));\r\n            }\r\n        }\r\n\r\n        this.bindUniformBuffer(null);\r\n    }\r\n\r\n    // VBOs\r\n    private _resetVertexBufferBinding(): void {\r\n        this.bindArrayBuffer(null);\r\n        this._cachedVertexBuffers = null;\r\n    }\r\n\r\n    /**\r\n     * Creates a vertex buffer\r\n     * @param data the data for the vertex buffer\r\n     * @returns the new WebGL static buffer\r\n     */\r\n    public createVertexBuffer(data: DataArray): DataBuffer {\r\n        var vbo = this._gl.createBuffer();\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create vertex buffer\");\r\n        }\r\n\r\n        let dataBuffer = new WebGLDataBuffer(vbo);\r\n        this.bindArrayBuffer(dataBuffer);\r\n\r\n        if (data instanceof Array) {\r\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(data), this._gl.STATIC_DRAW);\r\n        } else {\r\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, <ArrayBuffer>data, this._gl.STATIC_DRAW);\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n\r\n        dataBuffer.references = 1;\r\n        return dataBuffer;\r\n    }\r\n\r\n    /**\r\n     * Creates a dynamic vertex buffer\r\n     * @param data the data for the dynamic vertex buffer\r\n     * @returns the new WebGL dynamic buffer\r\n     */\r\n    public createDynamicVertexBuffer(data: DataArray): DataBuffer {\r\n        var vbo = this._gl.createBuffer();\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create dynamic vertex buffer\");\r\n        }\r\n\r\n        let result = new WebGLDataBuffer(vbo);\r\n        this.bindArrayBuffer(result);\r\n\r\n        if (data instanceof Array) {\r\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(data), this._gl.DYNAMIC_DRAW);\r\n        } else {\r\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, <ArrayBuffer>data, this._gl.DYNAMIC_DRAW);\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n        result.references = 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Update a dynamic index buffer\r\n     * @param indexBuffer defines the target index buffer\r\n     * @param indices defines the data to update\r\n     * @param offset defines the offset in the target index buffer where update should start\r\n     */\r\n    public updateDynamicIndexBuffer(indexBuffer: DataBuffer, indices: IndicesArray, offset: number = 0): void {\r\n        // Force cache update\r\n        this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER] = null;\r\n        this.bindIndexBuffer(indexBuffer);\r\n        var arrayBuffer;\r\n\r\n        if (indices instanceof Uint16Array || indices instanceof Uint32Array) {\r\n            arrayBuffer = indices;\r\n        } else {\r\n            arrayBuffer = indexBuffer.is32Bits ? new Uint32Array(indices) : new Uint16Array(indices);\r\n        }\r\n\r\n        this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, arrayBuffer, this._gl.DYNAMIC_DRAW);\r\n\r\n        this._resetIndexBufferBinding();\r\n    }\r\n\r\n    /**\r\n     * Updates a dynamic vertex buffer.\r\n     * @param vertexBuffer the vertex buffer to update\r\n     * @param data the data used to update the vertex buffer\r\n     * @param byteOffset the byte offset of the data\r\n     * @param byteLength the byte length of the data\r\n     */\r\n    public updateDynamicVertexBuffer(vertexBuffer: DataBuffer, data: DataArray, byteOffset?: number, byteLength?: number): void {\r\n        this.bindArrayBuffer(vertexBuffer);\r\n\r\n        if (byteOffset === undefined) {\r\n            byteOffset = 0;\r\n        }\r\n\r\n        if (byteLength === undefined) {\r\n            if (data instanceof Array) {\r\n                this._gl.bufferSubData(this._gl.ARRAY_BUFFER, byteOffset, new Float32Array(data));\r\n            } else {\r\n                this._gl.bufferSubData(this._gl.ARRAY_BUFFER, byteOffset, <ArrayBuffer>data);\r\n            }\r\n        } else {\r\n            if (data instanceof Array) {\r\n                this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, new Float32Array(data).subarray(byteOffset, byteOffset + byteLength));\r\n            } else {\r\n                if (data instanceof ArrayBuffer) {\r\n                    data = new Uint8Array(data, byteOffset, byteLength);\r\n                } else {\r\n                    data = new Uint8Array(data.buffer, data.byteOffset + byteOffset, byteLength);\r\n                }\r\n\r\n                this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, <ArrayBuffer>data);\r\n            }\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n    }\r\n\r\n    private _resetIndexBufferBinding(): void {\r\n        this.bindIndexBuffer(null);\r\n        this._cachedIndexBuffer = null;\r\n    }\r\n\r\n    /**\r\n     * Creates a new index buffer\r\n     * @param indices defines the content of the index buffer\r\n     * @param updatable defines if the index buffer must be updatable\r\n     * @returns a new webGL buffer\r\n     */\r\n    public createIndexBuffer(indices: IndicesArray, updatable?: boolean): DataBuffer {\r\n        var vbo = this._gl.createBuffer();\r\n        let dataBuffer = new WebGLDataBuffer(vbo!);\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create index buffer\");\r\n        }\r\n\r\n        this.bindIndexBuffer(dataBuffer);\r\n\r\n        // Check for 32 bits indices\r\n        var arrayBuffer;\r\n        var need32Bits = false;\r\n\r\n        if (indices instanceof Uint16Array) {\r\n            arrayBuffer = indices;\r\n        } else {\r\n            //check 32 bit support\r\n            if (this._caps.uintIndices) {\r\n                if (indices instanceof Uint32Array) {\r\n                    arrayBuffer = indices;\r\n                    need32Bits = true;\r\n                } else {\r\n                    //number[] or Int32Array, check if 32 bit is necessary\r\n                    for (var index = 0; index < indices.length; index++) {\r\n                        if (indices[index] > 65535) {\r\n                            need32Bits = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    arrayBuffer = need32Bits ? new Uint32Array(indices) : new Uint16Array(indices);\r\n                }\r\n            } else {\r\n                //no 32 bit support, force conversion to 16 bit (values greater 16 bit are lost)\r\n                arrayBuffer = new Uint16Array(indices);\r\n            }\r\n        }\r\n\r\n        this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, arrayBuffer, updatable ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW);\r\n        this._resetIndexBufferBinding();\r\n        dataBuffer.references = 1;\r\n        dataBuffer.is32Bits = need32Bits;\r\n        return dataBuffer;\r\n    }\r\n\r\n    /**\r\n     * Bind a webGL buffer to the webGL context\r\n     * @param buffer defines the buffer to bind\r\n     */\r\n    public bindArrayBuffer(buffer: Nullable<DataBuffer>): void {\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n        this.bindBuffer(buffer, this._gl.ARRAY_BUFFER);\r\n    }\r\n\r\n    /**\r\n     * Bind an uniform buffer to the current webGL context\r\n     * @param buffer defines the buffer to bind\r\n     */\r\n    public bindUniformBuffer(buffer: Nullable<DataBuffer>): void {\r\n        this._gl.bindBuffer(this._gl.UNIFORM_BUFFER, buffer ? buffer.underlyingResource : null);\r\n    }\r\n\r\n    /**\r\n     * Bind a buffer to the current webGL context at a given location\r\n     * @param buffer defines the buffer to bind\r\n     * @param location defines the index where to bind the buffer\r\n     */\r\n    public bindUniformBufferBase(buffer: DataBuffer, location: number): void {\r\n        this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER, location, buffer ? buffer.underlyingResource : null);\r\n    }\r\n\r\n    /**\r\n     * Bind a specific block at a given index in a specific shader program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param blockName defines the block name\r\n     * @param index defines the index where to bind the block\r\n     */\r\n    public bindUniformBlock(pipelineContext: IPipelineContext, blockName: string, index: number): void {\r\n        let program = (pipelineContext as WebGLPipelineContext).program!;\r\n\r\n        var uniformLocation = this._gl.getUniformBlockIndex(program, blockName);\r\n\r\n        this._gl.uniformBlockBinding(program, uniformLocation, index);\r\n    }\r\n\r\n    private bindIndexBuffer(buffer: Nullable<DataBuffer>): void {\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n        this.bindBuffer(buffer, this._gl.ELEMENT_ARRAY_BUFFER);\r\n    }\r\n\r\n    private bindBuffer(buffer: Nullable<DataBuffer>, target: number): void {\r\n        if (this._vaoRecordInProgress || this._currentBoundBuffer[target] !== buffer) {\r\n            this._gl.bindBuffer(target, buffer ? buffer.underlyingResource : null);\r\n            this._currentBoundBuffer[target] = buffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update the bound buffer with the given data\r\n     * @param data defines the data to update\r\n     */\r\n    public updateArrayBuffer(data: Float32Array): void {\r\n        this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\r\n    }\r\n\r\n    private _vertexAttribPointer(buffer: DataBuffer, indx: number, size: number, type: number, normalized: boolean, stride: number, offset: number): void {\r\n        var pointer = this._currentBufferPointers[indx];\r\n\r\n        var changed = false;\r\n        if (!pointer.active) {\r\n            changed = true;\r\n            pointer.active = true;\r\n            pointer.index = indx;\r\n            pointer.size = size;\r\n            pointer.type = type;\r\n            pointer.normalized = normalized;\r\n            pointer.stride = stride;\r\n            pointer.offset = offset;\r\n            pointer.buffer = buffer;\r\n        } else {\r\n            if (pointer.buffer !== buffer) { pointer.buffer = buffer; changed = true; }\r\n            if (pointer.size !== size) { pointer.size = size; changed = true; }\r\n            if (pointer.type !== type) { pointer.type = type; changed = true; }\r\n            if (pointer.normalized !== normalized) { pointer.normalized = normalized; changed = true; }\r\n            if (pointer.stride !== stride) { pointer.stride = stride; changed = true; }\r\n            if (pointer.offset !== offset) { pointer.offset = offset; changed = true; }\r\n        }\r\n\r\n        if (changed || this._vaoRecordInProgress) {\r\n            this.bindArrayBuffer(buffer);\r\n            this._gl.vertexAttribPointer(indx, size, type, normalized, stride, offset);\r\n        }\r\n    }\r\n\r\n    private _bindIndexBufferWithCache(indexBuffer: Nullable<DataBuffer>): void {\r\n        if (indexBuffer == null) {\r\n            return;\r\n        }\r\n        if (this._cachedIndexBuffer !== indexBuffer) {\r\n            this._cachedIndexBuffer = indexBuffer;\r\n            this.bindIndexBuffer(indexBuffer);\r\n            this._uintIndicesCurrentlySet = indexBuffer.is32Bits;\r\n        }\r\n    }\r\n\r\n    private _bindVertexBuffersAttributes(vertexBuffers: { [key: string]: Nullable<VertexBuffer> }, effect: Effect): void {\r\n        var attributes = effect.getAttributesNames();\r\n\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n\r\n        this.unbindAllAttributes();\r\n\r\n        for (var index = 0; index < attributes.length; index++) {\r\n            var order = effect.getAttributeLocation(index);\r\n\r\n            if (order >= 0) {\r\n                var vertexBuffer = vertexBuffers[attributes[index]];\r\n\r\n                if (!vertexBuffer) {\r\n                    continue;\r\n                }\r\n\r\n                this._gl.enableVertexAttribArray(order);\r\n                if (!this._vaoRecordInProgress) {\r\n                    this._vertexAttribArraysEnabled[order] = true;\r\n                }\r\n\r\n                var buffer = vertexBuffer.getBuffer();\r\n                if (buffer) {\r\n                    this._vertexAttribPointer(buffer, order, vertexBuffer.getSize(), vertexBuffer.type, vertexBuffer.normalized, vertexBuffer.byteStride, vertexBuffer.byteOffset);\r\n\r\n                    if (vertexBuffer.getIsInstanced()) {\r\n                        this._gl.vertexAttribDivisor(order, vertexBuffer.getInstanceDivisor());\r\n                        if (!this._vaoRecordInProgress) {\r\n                            this._currentInstanceLocations.push(order);\r\n                            this._currentInstanceBuffers.push(buffer);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Records a vertex array object\r\n     * @see http://doc.babylonjs.com/features/webgl2#vertex-array-objects\r\n     * @param vertexBuffers defines the list of vertex buffers to store\r\n     * @param indexBuffer defines the index buffer to store\r\n     * @param effect defines the effect to store\r\n     * @returns the new vertex array object\r\n     */\r\n    public recordVertexArrayObject(vertexBuffers: { [key: string]: VertexBuffer; }, indexBuffer: Nullable<DataBuffer>, effect: Effect): WebGLVertexArrayObject {\r\n        var vao = this._gl.createVertexArray();\r\n\r\n        this._vaoRecordInProgress = true;\r\n\r\n        this._gl.bindVertexArray(vao);\r\n\r\n        this._mustWipeVertexAttributes = true;\r\n        this._bindVertexBuffersAttributes(vertexBuffers, effect);\r\n\r\n        this.bindIndexBuffer(indexBuffer);\r\n\r\n        this._vaoRecordInProgress = false;\r\n        this._gl.bindVertexArray(null);\r\n\r\n        return vao;\r\n    }\r\n\r\n    /**\r\n     * Bind a specific vertex array object\r\n     * @see http://doc.babylonjs.com/features/webgl2#vertex-array-objects\r\n     * @param vertexArrayObject defines the vertex array object to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     */\r\n    public bindVertexArrayObject(vertexArrayObject: WebGLVertexArrayObject, indexBuffer: Nullable<DataBuffer>): void {\r\n        if (this._cachedVertexArrayObject !== vertexArrayObject) {\r\n            this._cachedVertexArrayObject = vertexArrayObject;\r\n\r\n            this._gl.bindVertexArray(vertexArrayObject);\r\n            this._cachedVertexBuffers = null;\r\n            this._cachedIndexBuffer = null;\r\n\r\n            this._uintIndicesCurrentlySet = indexBuffer != null && indexBuffer.is32Bits;\r\n            this._mustWipeVertexAttributes = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind webGl buffers directly to the webGL context\r\n     * @param vertexBuffer defines the vertex buffer to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param vertexDeclaration defines the vertex declaration to use with the vertex buffer\r\n     * @param vertexStrideSize defines the vertex stride of the vertex buffer\r\n     * @param effect defines the effect associated with the vertex buffer\r\n     */\r\n    public bindBuffersDirectly(vertexBuffer: DataBuffer, indexBuffer: DataBuffer, vertexDeclaration: number[], vertexStrideSize: number, effect: Effect): void {\r\n        if (this._cachedVertexBuffers !== vertexBuffer || this._cachedEffectForVertexBuffers !== effect) {\r\n            this._cachedVertexBuffers = vertexBuffer;\r\n            this._cachedEffectForVertexBuffers = effect;\r\n\r\n            let attributesCount = effect.getAttributesCount();\r\n\r\n            this._unbindVertexArrayObject();\r\n            this.unbindAllAttributes();\r\n\r\n            var offset = 0;\r\n            for (var index = 0; index < attributesCount; index++) {\r\n\r\n                if (index < vertexDeclaration.length) {\r\n\r\n                    var order = effect.getAttributeLocation(index);\r\n\r\n                    if (order >= 0) {\r\n                        this._gl.enableVertexAttribArray(order);\r\n                        this._vertexAttribArraysEnabled[order] = true;\r\n                        this._vertexAttribPointer(vertexBuffer, order, vertexDeclaration[index], this._gl.FLOAT, false, vertexStrideSize, offset);\r\n                    }\r\n\r\n                    offset += vertexDeclaration[index] * 4;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._bindIndexBufferWithCache(indexBuffer);\r\n    }\r\n\r\n    private _unbindVertexArrayObject(): void {\r\n        if (!this._cachedVertexArrayObject) {\r\n            return;\r\n        }\r\n\r\n        this._cachedVertexArrayObject = null;\r\n        this._gl.bindVertexArray(null);\r\n    }\r\n\r\n    /**\r\n     * Bind a list of vertex buffers to the webGL context\r\n     * @param vertexBuffers defines the list of vertex buffers to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param effect defines the effect associated with the vertex buffers\r\n     */\r\n    public bindBuffers(vertexBuffers: { [key: string]: Nullable<VertexBuffer> }, indexBuffer: Nullable<DataBuffer>, effect: Effect): void {\r\n        if (this._cachedVertexBuffers !== vertexBuffers || this._cachedEffectForVertexBuffers !== effect) {\r\n            this._cachedVertexBuffers = vertexBuffers;\r\n            this._cachedEffectForVertexBuffers = effect;\r\n\r\n            this._bindVertexBuffersAttributes(vertexBuffers, effect);\r\n        }\r\n\r\n        this._bindIndexBufferWithCache(indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * Unbind all instance attributes\r\n     */\r\n    public unbindInstanceAttributes() {\r\n        var boundBuffer;\r\n        for (var i = 0, ul = this._currentInstanceLocations.length; i < ul; i++) {\r\n            var instancesBuffer = this._currentInstanceBuffers[i];\r\n            if (boundBuffer != instancesBuffer && instancesBuffer.references) {\r\n                boundBuffer = instancesBuffer;\r\n                this.bindArrayBuffer(instancesBuffer);\r\n            }\r\n            var offsetLocation = this._currentInstanceLocations[i];\r\n            this._gl.vertexAttribDivisor(offsetLocation, 0);\r\n        }\r\n        this._currentInstanceBuffers.length = 0;\r\n        this._currentInstanceLocations.length = 0;\r\n    }\r\n\r\n    /**\r\n     * Release and free the memory of a vertex array object\r\n     * @param vao defines the vertex array object to delete\r\n     */\r\n    public releaseVertexArrayObject(vao: WebGLVertexArrayObject) {\r\n        this._gl.deleteVertexArray(vao);\r\n    }\r\n\r\n    /** @hidden */\r\n    public _releaseBuffer(buffer: DataBuffer): boolean {\r\n        buffer.references--;\r\n\r\n        if (buffer.references === 0) {\r\n            this._gl.deleteBuffer(buffer.underlyingResource);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Creates a webGL buffer to use with instanciation\r\n     * @param capacity defines the size of the buffer\r\n     * @returns the webGL buffer\r\n     */\r\n    public createInstancesBuffer(capacity: number): DataBuffer {\r\n        var buffer = this._gl.createBuffer();\r\n\r\n        if (!buffer) {\r\n            throw new Error(\"Unable to create instance buffer\");\r\n        }\r\n\r\n        var result = new WebGLDataBuffer(buffer);\r\n        result.capacity = capacity;\r\n\r\n        this.bindArrayBuffer(result);\r\n        this._gl.bufferData(this._gl.ARRAY_BUFFER, capacity, this._gl.DYNAMIC_DRAW);\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Delete a webGL buffer used with instanciation\r\n     * @param buffer defines the webGL buffer to delete\r\n     */\r\n    public deleteInstancesBuffer(buffer: WebGLBuffer): void {\r\n        this._gl.deleteBuffer(buffer);\r\n    }\r\n\r\n    /**\r\n     * Update the content of a webGL buffer used with instanciation and bind it to the webGL context\r\n     * @param instancesBuffer defines the webGL buffer to update and bind\r\n     * @param data defines the data to store in the buffer\r\n     * @param offsetLocations defines the offsets or attributes information used to determine where data must be stored in the buffer\r\n     */\r\n    public updateAndBindInstancesBuffer(instancesBuffer: DataBuffer, data: Float32Array, offsetLocations: number[] | InstancingAttributeInfo[]): void {\r\n        this.bindArrayBuffer(instancesBuffer);\r\n        if (data) {\r\n            this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\r\n        }\r\n\r\n        if ((<any>offsetLocations[0]).index !== undefined) {\r\n            let stride = 0;\r\n            for (let i = 0; i < offsetLocations.length; i++) {\r\n                let ai = <InstancingAttributeInfo>offsetLocations[i];\r\n                stride += ai.attributeSize * 4;\r\n            }\r\n            for (let i = 0; i < offsetLocations.length; i++) {\r\n                let ai = <InstancingAttributeInfo>offsetLocations[i];\r\n\r\n                if (!this._vertexAttribArraysEnabled[ai.index]) {\r\n                    this._gl.enableVertexAttribArray(ai.index);\r\n                    this._vertexAttribArraysEnabled[ai.index] = true;\r\n                }\r\n\r\n                this._vertexAttribPointer(instancesBuffer, ai.index, ai.attributeSize, ai.attribyteType || this._gl.FLOAT, ai.normalized || false, stride, ai.offset);\r\n                this._gl.vertexAttribDivisor(ai.index, 1);\r\n                this._currentInstanceLocations.push(ai.index);\r\n                this._currentInstanceBuffers.push(instancesBuffer);\r\n            }\r\n        } else {\r\n            for (let index = 0; index < 4; index++) {\r\n                let offsetLocation = <number>offsetLocations[index];\r\n\r\n                if (!this._vertexAttribArraysEnabled[offsetLocation]) {\r\n                    this._gl.enableVertexAttribArray(offsetLocation);\r\n                    this._vertexAttribArraysEnabled[offsetLocation] = true;\r\n                }\r\n\r\n                this._vertexAttribPointer(instancesBuffer, offsetLocation, 4, this._gl.FLOAT, false, 64, index * 16);\r\n                this._gl.vertexAttribDivisor(offsetLocation, 1);\r\n                this._currentInstanceLocations.push(offsetLocation);\r\n                this._currentInstanceBuffers.push(instancesBuffer);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply all cached states (depth, culling, stencil and alpha)\r\n     */\r\n    public applyStates() {\r\n        this._depthCullingState.apply(this._gl);\r\n        this._stencilState.apply(this._gl);\r\n        this._alphaState.apply(this._gl);\r\n    }\r\n\r\n    /**\r\n     * Send a draw order\r\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public draw(useTriangles: boolean, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        this.drawElementsType(useTriangles ? Material.TriangleFillMode : Material.WireFrameFillMode, indexStart, indexCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of points\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawPointClouds(verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        this.drawArraysType(Material.PointFillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawUnIndexed(useTriangles: boolean, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        this.drawArraysType(useTriangles ? Material.TriangleFillMode : Material.WireFrameFillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this.applyStates();\r\n\r\n        this._drawCalls.addCount(1, false);\r\n        // Render\r\n\r\n        const drawMode = this._drawMode(fillMode);\r\n        var indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\r\n        var mult = this._uintIndicesCurrentlySet ? 4 : 2;\r\n        if (instancesCount) {\r\n            this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\r\n        } else {\r\n            this._gl.drawElements(drawMode, indexCount, indexFormat, indexStart * mult);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this.applyStates();\r\n        this._drawCalls.addCount(1, false);\r\n\r\n        const drawMode = this._drawMode(fillMode);\r\n        if (instancesCount) {\r\n            this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\r\n        } else {\r\n            this._gl.drawArrays(drawMode, verticesStart, verticesCount);\r\n        }\r\n    }\r\n\r\n    private _drawMode(fillMode: number): number {\r\n        switch (fillMode) {\r\n            // Triangle views\r\n            case Material.TriangleFillMode:\r\n                return this._gl.TRIANGLES;\r\n            case Material.PointFillMode:\r\n                return this._gl.POINTS;\r\n            case Material.WireFrameFillMode:\r\n                return this._gl.LINES;\r\n            // Draw modes\r\n            case Material.PointListDrawMode:\r\n                return this._gl.POINTS;\r\n            case Material.LineListDrawMode:\r\n                return this._gl.LINES;\r\n            case Material.LineLoopDrawMode:\r\n                return this._gl.LINE_LOOP;\r\n            case Material.LineStripDrawMode:\r\n                return this._gl.LINE_STRIP;\r\n            case Material.TriangleStripDrawMode:\r\n                return this._gl.TRIANGLE_STRIP;\r\n            case Material.TriangleFanDrawMode:\r\n                return this._gl.TRIANGLE_FAN;\r\n            default:\r\n                return this._gl.TRIANGLES;\r\n        }\r\n    }\r\n\r\n    // Shaders\r\n\r\n    /** @hidden */\r\n    public _releaseEffect(effect: Effect): void {\r\n        if (this._compiledEffects[effect._key]) {\r\n            delete this._compiledEffects[effect._key];\r\n\r\n            this._deletePipelineContext(effect.getPipelineContext() as WebGLPipelineContext);\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\r\n        let webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n        if (webGLPipelineContext && webGLPipelineContext.program) {\r\n            webGLPipelineContext.program.__SPECTOR_rebuildProgram = null;\r\n\r\n            if (webGLPipelineContext.transformFeedback) {\r\n                this.deleteTransformFeedback(webGLPipelineContext.transformFeedback);\r\n                webGLPipelineContext.transformFeedback = null;\r\n            }\r\n\r\n            this._gl.deleteProgram(webGLPipelineContext.program);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a new effect (used to store vertex/fragment shaders)\r\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\r\n     * @param attributesNamesOrOptions defines either a list of attribute names or an EffectCreationOptions object\r\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\r\n     * @param samplers defines an array of string used to represent textures\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param fallbacks defines the list of potential fallbacks to use if shader conmpilation fails\r\n     * @param onCompiled defines a function to call when the effect creation is successful\r\n     * @param onError defines a function to call when the effect creation has failed\r\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\r\n     * @returns the new Effect\r\n     */\r\n    public createEffect(baseName: any, attributesNamesOrOptions: string[] | EffectCreationOptions, uniformsNamesOrEngine: string[] | Engine, samplers?: string[], defines?: string, fallbacks?: EffectFallbacks,\r\n        onCompiled?: Nullable<(effect: Effect) => void>, onError?: Nullable<(effect: Effect, errors: string) => void>, indexParameters?: any): Effect {\r\n        var vertex = baseName.vertexElement || baseName.vertex || baseName;\r\n        var fragment = baseName.fragmentElement || baseName.fragment || baseName;\r\n\r\n        var name = vertex + \"+\" + fragment + \"@\" + (defines ? defines : (<EffectCreationOptions>attributesNamesOrOptions).defines);\r\n        if (this._compiledEffects[name]) {\r\n            var compiledEffect = <Effect>this._compiledEffects[name];\r\n            if (onCompiled && compiledEffect.isReady()) {\r\n                onCompiled(compiledEffect);\r\n            }\r\n\r\n            return compiledEffect;\r\n        }\r\n        var effect = new Effect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, this, defines, fallbacks, onCompiled, onError, indexParameters);\r\n        effect._key = name;\r\n        this._compiledEffects[name] = effect;\r\n\r\n        return effect;\r\n    }\r\n\r\n    private _compileShader(source: string, type: string, defines: Nullable<string>, shaderVersion: string): WebGLShader {\r\n        return this._compileRawShader(shaderVersion + (defines ? defines + \"\\n\" : \"\") + source, type);\r\n    }\r\n\r\n    private _compileRawShader(source: string, type: string): WebGLShader {\r\n        var gl = this._gl;\r\n        var shader = gl.createShader(type === \"vertex\" ? gl.VERTEX_SHADER : gl.FRAGMENT_SHADER);\r\n\r\n        if (!shader) {\r\n            throw new Error(\"Something went wrong while compile the shader.\");\r\n        }\r\n\r\n        gl.shaderSource(shader, source);\r\n        gl.compileShader(shader);\r\n\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * Directly creates a webGL program\r\n     * @param pipelineContext  defines the pipeline context to attach to\r\n     * @param vertexCode defines the vertex shader code to use\r\n     * @param fragmentCode defines the fragment shader code to use\r\n     * @param context defines the webGL context to use (if not set, the current one will be used)\r\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\r\n     * @returns the new webGL program\r\n     */\r\n    public createRawShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): WebGLProgram {\r\n        context = context || this._gl;\r\n\r\n        var vertexShader = this._compileRawShader(vertexCode, \"vertex\");\r\n        var fragmentShader = this._compileRawShader(fragmentCode, \"fragment\");\r\n\r\n        return this._createShaderProgram(pipelineContext as WebGLPipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\r\n    }\r\n\r\n    /**\r\n     * Creates a webGL program\r\n     * @param pipelineContext  defines the pipeline context to attach to\r\n     * @param vertexCode  defines the vertex shader code to use\r\n     * @param fragmentCode defines the fragment shader code to use\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param context defines the webGL context to use (if not set, the current one will be used)\r\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\r\n     * @returns the new webGL program\r\n     */\r\n    public createShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, defines: Nullable<string>, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): WebGLProgram {\r\n        context = context || this._gl;\r\n\r\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\r\n\r\n        var shaderVersion = (this._webGLVersion > 1) ? \"#version 300 es\\n#define WEBGL2 \\n\" : \"\";\r\n        var vertexShader = this._compileShader(vertexCode, \"vertex\", defines, shaderVersion);\r\n        var fragmentShader = this._compileShader(fragmentCode, \"fragment\", defines, shaderVersion);\r\n\r\n        let program = this._createShaderProgram(pipelineContext as WebGLPipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\r\n\r\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\r\n\r\n        return program;\r\n    }\r\n\r\n    /**\r\n     * Creates a new pipeline context\r\n     * @returns the new pipeline\r\n     */\r\n    public createPipelineContext() {\r\n        var pipelineContext = new WebGLPipelineContext();\r\n        pipelineContext.engine = this;\r\n\r\n        if (this._caps.parallelShaderCompile) {\r\n            pipelineContext.isParallelCompiled = true;\r\n        }\r\n\r\n        return pipelineContext;\r\n    }\r\n\r\n    private _createShaderProgram(pipelineContext: WebGLPipelineContext, vertexShader: WebGLShader, fragmentShader: WebGLShader, context: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): WebGLProgram {\r\n        var shaderProgram = context.createProgram();\r\n        pipelineContext.program = shaderProgram;\r\n\r\n        if (!shaderProgram) {\r\n            throw new Error(\"Unable to create program\");\r\n        }\r\n\r\n        context.attachShader(shaderProgram, vertexShader);\r\n        context.attachShader(shaderProgram, fragmentShader);\r\n\r\n        if (this.webGLVersion > 1 && transformFeedbackVaryings) {\r\n            let transformFeedback = this.createTransformFeedback();\r\n\r\n            this.bindTransformFeedback(transformFeedback);\r\n            this.setTranformFeedbackVaryings(shaderProgram, transformFeedbackVaryings);\r\n            pipelineContext.transformFeedback = transformFeedback;\r\n        }\r\n\r\n        context.linkProgram(shaderProgram);\r\n\r\n        if (this.webGLVersion > 1 && transformFeedbackVaryings) {\r\n            this.bindTransformFeedback(null);\r\n        }\r\n\r\n        pipelineContext.context = context;\r\n        pipelineContext.vertexShader = vertexShader;\r\n        pipelineContext.fragmentShader = fragmentShader;\r\n\r\n        if (!pipelineContext.isParallelCompiled) {\r\n            this._finalizePipelineContext(pipelineContext);\r\n        }\r\n\r\n        return shaderProgram;\r\n    }\r\n\r\n    private _finalizePipelineContext(pipelineContext: WebGLPipelineContext) {\r\n        const context = pipelineContext.context!;\r\n        const vertexShader = pipelineContext.vertexShader!;\r\n        const fragmentShader = pipelineContext.fragmentShader!;\r\n        const program = pipelineContext.program!;\r\n\r\n        var linked = context.getProgramParameter(program, context.LINK_STATUS);\r\n\r\n        if (!linked) { // Get more info\r\n\r\n            // Vertex\r\n            if (!this._gl.getShaderParameter(vertexShader, this._gl.COMPILE_STATUS)) {\r\n                let log = this._gl.getShaderInfoLog(vertexShader);\r\n                if (log) {\r\n                    throw new Error(log);\r\n                }\r\n            }\r\n\r\n            // Fragment\r\n            if (!this._gl.getShaderParameter(fragmentShader, this._gl.COMPILE_STATUS)) {\r\n                let log = this._gl.getShaderInfoLog(fragmentShader);\r\n                if (log) {\r\n                    throw new Error(log);\r\n                }\r\n            }\r\n\r\n            var error = context.getProgramInfoLog(program);\r\n            if (error) {\r\n                throw new Error(error);\r\n            }\r\n        }\r\n\r\n        if (this.validateShaderPrograms) {\r\n            context.validateProgram(program);\r\n            var validated = context.getProgramParameter(program, context.VALIDATE_STATUS);\r\n\r\n            if (!validated) {\r\n                var error = context.getProgramInfoLog(program);\r\n                if (error) {\r\n                    throw new Error(error);\r\n                }\r\n            }\r\n        }\r\n\r\n        context.deleteShader(vertexShader);\r\n        context.deleteShader(fragmentShader);\r\n\r\n        pipelineContext.vertexShader = undefined;\r\n        pipelineContext.fragmentShader = undefined;\r\n\r\n        if (pipelineContext.onCompiled) {\r\n            pipelineContext.onCompiled();\r\n            pipelineContext.onCompiled = undefined;\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _preparePipelineContext(pipelineContext: IPipelineContext, vertexSourceCode: string, fragmentSourceCode: string, createAsRaw: boolean,\r\n        rebuildRebind: any,\r\n        defines: Nullable<string>,\r\n        transformFeedbackVaryings: Nullable<string[]>) {\r\n        let webGLRenderingState = pipelineContext as WebGLPipelineContext;\r\n\r\n        if (createAsRaw) {\r\n            webGLRenderingState.program = this.createRawShaderProgram(webGLRenderingState, vertexSourceCode, fragmentSourceCode, undefined, transformFeedbackVaryings);\r\n        }\r\n        else {\r\n            webGLRenderingState.program = this.createShaderProgram(webGLRenderingState, vertexSourceCode, fragmentSourceCode, defines, undefined, transformFeedbackVaryings);\r\n        }\r\n        webGLRenderingState.program.__SPECTOR_rebuildProgram = rebuildRebind;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _isRenderingStateCompiled(pipelineContext: IPipelineContext): boolean {\r\n        let webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n        if (this._gl.getProgramParameter(webGLPipelineContext.program!, this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)) {\r\n            this._finalizePipelineContext(webGLPipelineContext);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\r\n        let webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        if (!webGLPipelineContext.isParallelCompiled) {\r\n            action();\r\n            return;\r\n        }\r\n\r\n        webGLPipelineContext.onCompiled = action;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of webGL uniform locations associated with a specific program based on a list of uniform names\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param uniformsNames defines the list of uniform names\r\n     * @returns an array of webGL uniform locations\r\n     */\r\n    public getUniforms(pipelineContext: IPipelineContext, uniformsNames: string[]): Nullable<WebGLUniformLocation>[] {\r\n        var results = new Array<Nullable<WebGLUniformLocation>>();\r\n        let webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        for (var index = 0; index < uniformsNames.length; index++) {\r\n            results.push(this._gl.getUniformLocation(webGLPipelineContext.program!, uniformsNames[index]));\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Gets the lsit of active attributes for a given webGL program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param attributesNames defines the list of attribute names to get\r\n     * @returns an array of indices indicating the offset of each attribute\r\n     */\r\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\r\n        var results = [];\r\n        let webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        for (var index = 0; index < attributesNames.length; index++) {\r\n            try {\r\n                results.push(this._gl.getAttribLocation(webGLPipelineContext.program!, attributesNames[index]));\r\n            } catch (e) {\r\n                results.push(-1);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Activates an effect, mkaing it the current one (ie. the one used for rendering)\r\n     * @param effect defines the effect to activate\r\n     */\r\n    public enableEffect(effect: Nullable<Effect>): void {\r\n        if (!effect || effect === this._currentEffect) {\r\n            return;\r\n        }\r\n\r\n        // Use program\r\n        this.bindSamplers(effect);\r\n\r\n        this._currentEffect = effect;\r\n\r\n        if (effect.onBind) {\r\n            effect.onBind(effect);\r\n        }\r\n        if (effect._onBindObservable) {\r\n            effect._onBindObservable.notifyObservers(effect);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     */\r\n    public setIntArray(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform1iv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     */\r\n    public setIntArray2(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): void {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform2iv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     */\r\n    public setIntArray3(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): void {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform3iv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     */\r\n    public setIntArray4(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): void {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform4iv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of float32 to store\r\n     */\r\n    public setFloatArray(uniform: Nullable<WebGLUniformLocation>, array: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform1fv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32 (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of float32 to store\r\n     */\r\n    public setFloatArray2(uniform: Nullable<WebGLUniformLocation>, array: Float32Array): void {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform2fv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32 (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of float32 to store\r\n     */\r\n    public setFloatArray3(uniform: Nullable<WebGLUniformLocation>, array: Float32Array): void {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform3fv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32 (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of float32 to store\r\n     */\r\n    public setFloatArray4(uniform: Nullable<WebGLUniformLocation>, array: Float32Array): void {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform4fv(uniform, array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     */\r\n    public setArray(uniform: Nullable<WebGLUniformLocation>, array: number[]): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform1fv(uniform, <any>array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     */\r\n    public setArray2(uniform: Nullable<WebGLUniformLocation>, array: number[]): void {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform2fv(uniform, <any>array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     */\r\n    public setArray3(uniform: Nullable<WebGLUniformLocation>, array: number[]): void {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform3fv(uniform, <any>array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     */\r\n    public setArray4(uniform: Nullable<WebGLUniformLocation>, array: number[]): void {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform4fv(uniform, <any>array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32 (stored as matrices)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrices defines the array of float32 to store\r\n     */\r\n    public setMatrices(uniform: Nullable<WebGLUniformLocation>, matrices: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniformMatrix4fv(uniform, false, matrices);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the matrix to store\r\n     */\r\n    public setMatrix(uniform: Nullable<WebGLUniformLocation>, matrix: Matrix): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniformMatrix4fv(uniform, false, matrix.toArray() as Float32Array);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix (3x3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the Float32Array representing the 3x3 matrix to store\r\n     */\r\n    public setMatrix3x3(uniform: Nullable<WebGLUniformLocation>, matrix: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniformMatrix3fv(uniform, false, matrix);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix (2x2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the Float32Array representing the 2x2 matrix to store\r\n     */\r\n    public setMatrix2x2(uniform: Nullable<WebGLUniformLocation>, matrix: Float32Array): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniformMatrix2fv(uniform, false, matrix);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (int)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the int number to store\r\n     */\r\n    public setInt(uniform: Nullable<WebGLUniformLocation>, value: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform1i(uniform, value);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (float)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the float number to store\r\n     */\r\n    public setFloat(uniform: Nullable<WebGLUniformLocation>, value: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform1f(uniform, value);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     */\r\n    public setFloat2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform2f(uniform, x, y);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     */\r\n    public setFloat3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform3f(uniform, x, y, z);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a boolean\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param bool defines the boolean to store\r\n     */\r\n    public setBool(uniform: Nullable<WebGLUniformLocation>, bool: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform1i(uniform, bool);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     */\r\n    public setFloat4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform4f(uniform, x, y, z, w);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a Color3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param color3 defines the color to store\r\n     */\r\n    public setColor3(uniform: Nullable<WebGLUniformLocation>, color3: Color3): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform3f(uniform, color3.r, color3.g, color3.b);\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a Color3 and an alpha value\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param color3 defines the color to store\r\n     * @param alpha defines the alpha component to store\r\n     */\r\n    public setColor4(uniform: Nullable<WebGLUniformLocation>, color3: Color3, alpha: number): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform4f(uniform, color3.r, color3.g, color3.b, alpha);\r\n    }\r\n\r\n    /**\r\n     * Sets a Color4 on a uniform variable\r\n     * @param uniform defines the uniform location\r\n     * @param color4 defines the value to be set\r\n     */\r\n    public setDirectColor4(uniform: Nullable<WebGLUniformLocation>, color4: Color4): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._gl.uniform4f(uniform, color4.r, color4.g, color4.b, color4.a);\r\n    }\r\n\r\n    // States\r\n\r\n    /**\r\n     * Set various states to the webGL context\r\n     * @param culling defines backface culling state\r\n     * @param zOffset defines the value to apply to zOffset (0 by default)\r\n     * @param force defines if states must be applied even if cache is up to date\r\n     * @param reverseSide defines if culling must be reversed (CCW instead of CW and CW instead of CCW)\r\n     */\r\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false): void {\r\n        // Culling\r\n        if (this._depthCullingState.cull !== culling || force) {\r\n            this._depthCullingState.cull = culling;\r\n        }\r\n\r\n        // Cull face\r\n        var cullFace = this.cullBackFaces ? this._gl.BACK : this._gl.FRONT;\r\n        if (this._depthCullingState.cullFace !== cullFace || force) {\r\n            this._depthCullingState.cullFace = cullFace;\r\n        }\r\n\r\n        // Z offset\r\n        this.setZOffset(zOffset);\r\n\r\n        // Front face\r\n        var frontFace = reverseSide ? this._gl.CW : this._gl.CCW;\r\n        if (this._depthCullingState.frontFace !== frontFace || force) {\r\n            this._depthCullingState.frontFace = frontFace;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the z offset to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffset(value: number): void {\r\n        this._depthCullingState.zOffset = value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset\r\n     * @returns the current zOffset state\r\n     */\r\n    public getZOffset(): number {\r\n        return this._depthCullingState.zOffset;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth buffering\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthBuffer(enable: boolean): void {\r\n        this._depthCullingState.depthTest = enable;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if depth writing is enabled\r\n     * @returns the current depth writing state\r\n     */\r\n    public getDepthWrite(): boolean {\r\n        return this._depthCullingState.depthMask;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthWrite(enable: boolean): void {\r\n        this._depthCullingState.depthMask = enable;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable color writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setColorWrite(enable: boolean): void {\r\n        this._gl.colorMask(enable, enable, enable, enable);\r\n        this._colorWrite = enable;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if color writing is enabled\r\n     * @returns the current color writing state\r\n     */\r\n    public getColorWrite(): boolean {\r\n        return this._colorWrite;\r\n    }\r\n\r\n    /**\r\n     * Sets alpha constants used by some alpha blending modes\r\n     * @param r defines the red component\r\n     * @param g defines the green component\r\n     * @param b defines the blue component\r\n     * @param a defines the alpha component\r\n     */\r\n    public setAlphaConstants(r: number, g: number, b: number, a: number) {\r\n        this._alphaState.setAlphaBlendConstants(r, g, b, a);\r\n    }\r\n\r\n    /**\r\n     * Sets the current alpha mode\r\n     * @param mode defines the mode to use (one of the Engine.ALPHA_XXX)\r\n     * @param noDepthWriteChange defines if depth writing state should remains unchanged (false by default)\r\n     * @see http://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n     */\r\n    public setAlphaMode(mode: number, noDepthWriteChange: boolean = false): void {\r\n        if (this._alphaMode === mode) {\r\n            return;\r\n        }\r\n\r\n        switch (mode) {\r\n            case Engine.ALPHA_DISABLE:\r\n                this._alphaState.alphaBlend = false;\r\n                break;\r\n            case Engine.ALPHA_PREMULTIPLIED:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_PREMULTIPLIED_PORTERDUFF:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_COMBINE:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_ONEONE:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE, this._gl.ZERO, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_ADD:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE, this._gl.ZERO, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_SUBTRACT:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_MULTIPLY:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR, this._gl.ZERO, this._gl.ONE, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_MAXIMIZED:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_INTERPOLATE:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR, this._gl.ONE_MINUS_CONSTANT_COLOR, this._gl.CONSTANT_ALPHA, this._gl.ONE_MINUS_CONSTANT_ALPHA);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n            case Engine.ALPHA_SCREENMODE:\r\n                this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA);\r\n                this._alphaState.alphaBlend = true;\r\n                break;\r\n        }\r\n        if (!noDepthWriteChange) {\r\n            this.setDepthWrite(mode === Engine.ALPHA_DISABLE);\r\n        }\r\n        this._alphaMode = mode;\r\n    }\r\n\r\n    /**\r\n     * Gets the current alpha mode\r\n     * @see http://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n     * @returns the current alpha mode\r\n     */\r\n    public getAlphaMode(): number {\r\n        return this._alphaMode;\r\n    }\r\n\r\n    // Textures\r\n\r\n    /**\r\n     * Clears the list of texture accessible through engine.\r\n     * This can help preventing texture load conflict due to name collision.\r\n     */\r\n    public clearInternalTexturesCache() {\r\n        this._internalTexturesCache = [];\r\n    }\r\n\r\n    /**\r\n     * Force the entire cache to be cleared\r\n     * You should not have to use this function unless your engine needs to share the webGL context with another engine\r\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\r\n     */\r\n    public wipeCaches(bruteForce?: boolean): void {\r\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\r\n            return;\r\n        }\r\n        this._currentEffect = null;\r\n        this._viewportCached.x = 0;\r\n        this._viewportCached.y = 0;\r\n        this._viewportCached.z = 0;\r\n        this._viewportCached.w = 0;\r\n\r\n        if (bruteForce) {\r\n            this.resetTextureCache();\r\n            this._currentProgram = null;\r\n\r\n            this._stencilState.reset();\r\n            this._depthCullingState.reset();\r\n            this.setDepthFunctionToLessOrEqual();\r\n            this._alphaState.reset();\r\n\r\n            this._unpackFlipYCached = null;\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n        this._cachedIndexBuffer = null;\r\n        this._cachedEffectForVertexBuffers = null;\r\n        this._unbindVertexArrayObject();\r\n        this.bindIndexBuffer(null);\r\n    }\r\n\r\n    /**\r\n     * Set the compressed texture format to use, based on the formats you have, and the formats\r\n     * supported by the hardware / browser.\r\n     *\r\n     * Khronos Texture Container (.ktx) files are used to support this.  This format has the\r\n     * advantage of being specifically designed for OpenGL.  Header elements directly correspond\r\n     * to API arguments needed to compressed textures.  This puts the burden on the container\r\n     * generator to house the arcane code for determining these for current & future formats.\r\n     *\r\n     * for description see https://www.khronos.org/opengles/sdk/tools/KTX/\r\n     * for file layout see https://www.khronos.org/opengles/sdk/tools/KTX/file_format_spec/\r\n     *\r\n     * Note: The result of this call is not taken into account when a texture is base64.\r\n     *\r\n     * @param formatsAvailable defines the list of those format families you have created\r\n     * on your server.  Syntax: '-' + format family + '.ktx'.  (Case and order do not matter.)\r\n     *\r\n     * Current families are astc, dxt, pvrtc, etc2, & etc1.\r\n     * @returns The extension selected.\r\n     */\r\n    public setTextureFormatToUse(formatsAvailable: Array<string>): Nullable<string> {\r\n        for (var i = 0, len1 = this.texturesSupported.length; i < len1; i++) {\r\n            for (var j = 0, len2 = formatsAvailable.length; j < len2; j++) {\r\n                if (this._texturesSupported[i] === formatsAvailable[j].toLowerCase()) {\r\n                    return this._textureFormatInUse = this._texturesSupported[i];\r\n                }\r\n            }\r\n        }\r\n        // actively set format to nothing, to allow this to be called more than once\r\n        // and possibly fail the 2nd time\r\n        this._textureFormatInUse = null;\r\n        return null;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getSamplingParameters(samplingMode: number, generateMipMaps: boolean): { min: number; mag: number } {\r\n        var gl = this._gl;\r\n        var magFilter = gl.NEAREST;\r\n        var minFilter = gl.NEAREST;\r\n\r\n        switch (samplingMode) {\r\n            case Engine.TEXTURE_BILINEAR_SAMPLINGMODE:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_TRILINEAR_SAMPLINGMODE:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_NEAREST_SAMPLINGMODE:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_NEAREST_LINEAR:\r\n                magFilter = gl.NEAREST;\r\n                minFilter = gl.LINEAR;\r\n                break;\r\n            case Engine.TEXTURE_NEAREST_NEAREST:\r\n                magFilter = gl.NEAREST;\r\n                minFilter = gl.NEAREST;\r\n                break;\r\n            case Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Engine.TEXTURE_LINEAR_LINEAR:\r\n                magFilter = gl.LINEAR;\r\n                minFilter = gl.LINEAR;\r\n                break;\r\n            case Engine.TEXTURE_LINEAR_NEAREST:\r\n                magFilter = gl.LINEAR;\r\n                minFilter = gl.NEAREST;\r\n                break;\r\n        }\r\n\r\n        return {\r\n            min: minFilter,\r\n            mag: magFilter\r\n        };\r\n    }\r\n\r\n    /** @hidden */\r\n    public _createTexture(): WebGLTexture {\r\n        let texture = this._gl.createTexture();\r\n\r\n        if (!texture) {\r\n            throw new Error(\"Unable to create texture\");\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a WebGLTexture\r\n     * @param urlArg defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param excludeLoaders array of texture loaders that should be excluded when picking a loader for the texture (default: empty array)\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public createTexture(urlArg: Nullable<string>, noMipmap: boolean, invertY: boolean, scene: Nullable<Scene>, samplingMode: number = Engine.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n        onLoad: Nullable<() => void> = null, onError: Nullable<(message: string, exception: any) => void> = null,\r\n        buffer: Nullable<string | ArrayBuffer | HTMLImageElement | Blob> = null, fallback: Nullable<InternalTexture> = null, format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null, excludeLoaders: Array<IInternalTextureLoader> = []): InternalTexture {\r\n        var url = String(urlArg); // assign a new string, so that the original is still available in case of fallback\r\n        var fromData = url.substr(0, 5) === \"data:\";\r\n        var fromBlob = url.substr(0, 5) === \"blob:\";\r\n        var isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\r\n\r\n        let texture = fallback ? fallback : new InternalTexture(this, InternalTexture.DATASOURCE_URL);\r\n\r\n        // establish the file extension, if possible\r\n        var lastDot = url.lastIndexOf('.');\r\n        var extension = forcedExtension ? forcedExtension : (lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\");\r\n\r\n        let loader: Nullable<IInternalTextureLoader> = null;\r\n        for (let availableLoader of Engine._TextureLoaders) {\r\n            if (excludeLoaders.indexOf(availableLoader) === -1 && availableLoader.canLoad(extension, this._textureFormatInUse, fallback, isBase64, buffer ? true : false)) {\r\n                loader = availableLoader;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (loader) {\r\n            url = loader.transformUrl(url, this._textureFormatInUse);\r\n        }\r\n\r\n        if (scene) {\r\n            scene._addPendingData(texture);\r\n        }\r\n        texture.url = url;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture.samplingMode = samplingMode;\r\n        texture.invertY = invertY;\r\n\r\n        if (!this._doNotHandleContextLost) {\r\n            // Keep a link to the buffer only if we plan to handle context lost\r\n            texture._buffer = buffer;\r\n        }\r\n\r\n        let onLoadObserver: Nullable<Observer<InternalTexture>> = null;\r\n        if (onLoad && !fallback) {\r\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\r\n        }\r\n\r\n        if (!fallback) { this._internalTexturesCache.push(texture); }\r\n\r\n        let onInternalError = (message?: string, exception?: any) => {\r\n            if (scene) {\r\n                scene._removePendingData(texture);\r\n            }\r\n\r\n            let customFallback = false;\r\n            if (loader) {\r\n                const fallbackUrl = loader.getFallbackTextureUrl(url, this._textureFormatInUse);\r\n                if (fallbackUrl) {\r\n                    // Add Back\r\n                    customFallback = true;\r\n                    excludeLoaders.push(loader);\r\n                    Tools.Warn((loader.constructor as any).name + \" failed when trying to load \" + texture.url + \", falling back to the next supported loader\");\r\n                    this.createTexture(urlArg, noMipmap, texture.invertY, scene, samplingMode, null, null, buffer, texture, undefined, undefined, excludeLoaders);\r\n                }\r\n            }\r\n\r\n            if (!customFallback) {\r\n                if (onLoadObserver) {\r\n                    texture.onLoadedObservable.remove(onLoadObserver);\r\n                }\r\n                if (Tools.UseFallbackTexture) {\r\n                    this.createTexture(Tools.fallbackTexture, noMipmap, texture.invertY, scene, samplingMode, null, null, buffer, texture);\r\n                }\r\n            }\r\n\r\n            if (onError) {\r\n                onError(message || \"Unknown error\", exception);\r\n            }\r\n        };\r\n\r\n        // processing for non-image formats\r\n        if (loader) {\r\n            var callback = (data: string | ArrayBuffer) => {\r\n                loader!.loadData(data as ArrayBuffer, texture, (width: number, height: number, loadMipmap: boolean, isCompressed: boolean, done: () => void, loadFailed) => {\r\n                    if (loadFailed) {\r\n                        onInternalError(\"TextureLoader failed to load data\");\r\n                    } else {\r\n                        this._prepareWebGLTexture(texture, scene, width, height, texture.invertY, !loadMipmap, isCompressed, () => {\r\n                            done();\r\n                            return false;\r\n                        }, samplingMode);\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (!buffer) {\r\n                this._loadFile(url, callback, undefined, scene ? scene.offlineProvider : undefined, true, (request?: WebRequest, exception?: any) => {\r\n                    onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\r\n                });\r\n            } else {\r\n                callback(buffer as ArrayBuffer);\r\n            }\r\n        } else {\r\n            var onload = (img: HTMLImageElement) => {\r\n                if (fromBlob && !this._doNotHandleContextLost) {\r\n                    // We need to store the image if we need to rebuild the texture\r\n                    // in case of a webgl context lost\r\n                    texture._buffer = img;\r\n                }\r\n\r\n                this._prepareWebGLTexture(texture, scene, img.width, img.height, texture.invertY, noMipmap, false, (potWidth, potHeight, continuationCallback) => {\r\n                    let gl = this._gl;\r\n                    var isPot = (img.width === potWidth && img.height === potHeight);\r\n                    let internalFormat = format ? this._getInternalFormat(format) : ((extension === \".jpg\") ? gl.RGB : gl.RGBA);\r\n\r\n                    if (isPot) {\r\n                        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, internalFormat, gl.UNSIGNED_BYTE, img);\r\n                        return false;\r\n                    }\r\n\r\n                    let maxTextureSize = this._caps.maxTextureSize;\r\n\r\n                    if (img.width > maxTextureSize || img.height > maxTextureSize || Engine._RescalePostProcessFactory === null) {\r\n                        this._prepareWorkingCanvas();\r\n                        if (!this._workingCanvas || !this._workingContext) {\r\n                            return false;\r\n                        }\r\n\r\n                        this._workingCanvas.width = potWidth;\r\n                        this._workingCanvas.height = potHeight;\r\n\r\n                        this._workingContext.drawImage(img, 0, 0, img.width, img.height, 0, 0, potWidth, potHeight);\r\n                        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, internalFormat, gl.UNSIGNED_BYTE, this._workingCanvas);\r\n\r\n                        texture.width = potWidth;\r\n                        texture.height = potHeight;\r\n\r\n                        return false;\r\n                    } else {\r\n                        // Using shaders when possible to rescale because canvas.drawImage is lossy\r\n                        let source = new InternalTexture(this, InternalTexture.DATASOURCE_TEMP);\r\n                        this._bindTextureDirectly(gl.TEXTURE_2D, source, true);\r\n                        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, internalFormat, gl.UNSIGNED_BYTE, img);\r\n\r\n                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n                        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n                        this._rescaleTexture(source, texture, scene, internalFormat, () => {\r\n                            this._releaseTexture(source);\r\n                            this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n\r\n                            continuationCallback();\r\n                        });\r\n                    }\r\n\r\n                    return true;\r\n                }, samplingMode);\r\n            };\r\n\r\n            if (!fromData || isBase64) {\r\n                if (buffer instanceof HTMLImageElement) {\r\n                    onload(buffer);\r\n                } else {\r\n                    Tools.LoadImage(url, onload, onInternalError, scene ? scene.offlineProvider : null);\r\n                }\r\n            }\r\n            else if (typeof buffer === \"string\" || buffer instanceof ArrayBuffer || buffer instanceof Blob) {\r\n                Tools.LoadImage(buffer, onload, onInternalError, scene ? scene.offlineProvider : null);\r\n            }\r\n            else {\r\n                onload(<HTMLImageElement>buffer);\r\n            }\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    private _rescaleTexture(source: InternalTexture, destination: InternalTexture, scene: Nullable<Scene>, internalFormat: number, onComplete: () => void): void {\r\n        let rtt = this.createRenderTargetTexture({\r\n            width: destination.width,\r\n            height: destination.height,\r\n        }, {\r\n                generateMipMaps: false,\r\n                type: Engine.TEXTURETYPE_UNSIGNED_INT,\r\n                samplingMode: Engine.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n                generateDepthBuffer: false,\r\n                generateStencilBuffer: false\r\n            }\r\n        );\r\n\r\n        if (!this._rescalePostProcess && Engine._RescalePostProcessFactory) {\r\n            this._rescalePostProcess = Engine._RescalePostProcessFactory(this);\r\n        }\r\n\r\n        this._rescalePostProcess.getEffect().executeWhenCompiled(() => {\r\n            this._rescalePostProcess.onApply = function(effect) {\r\n                effect._bindTexture(\"textureSampler\", source);\r\n            };\r\n\r\n            let hostingScene = scene;\r\n\r\n            if (!hostingScene) {\r\n                hostingScene = this.scenes[this.scenes.length - 1];\r\n            }\r\n            hostingScene.postProcessManager.directRender([this._rescalePostProcess], rtt, true);\r\n\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, destination, true);\r\n            this._gl.copyTexImage2D(this._gl.TEXTURE_2D, 0, internalFormat, 0, 0, destination.width, destination.height, 0);\r\n\r\n            this.unBindFramebuffer(rtt);\r\n            this._releaseTexture(rtt);\r\n\r\n            if (onComplete) {\r\n                onComplete();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates a raw texture\r\n     * @param data defines the data to store in the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param format defines the format of the data\r\n     * @param generateMipMaps defines if the engine should generate the mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (Texture.NEAREST_SAMPLINGMODE by default)\r\n     * @param compression defines the compression used (null by default)\r\n     * @param type defines the type fo the data (Engine.TEXTURETYPE_UNSIGNED_INT by default)\r\n     * @returns the raw texture inside an InternalTexture\r\n     */\r\n    public createRawTexture(data: Nullable<ArrayBufferView>, width: number, height: number, format: number, generateMipMaps: boolean, invertY: boolean, samplingMode: number, compression: Nullable<string> = null, type: number = Engine.TEXTURETYPE_UNSIGNED_INT): InternalTexture {\r\n        throw _DevTools.WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    private _unpackFlipYCached: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * In case you are sharing the context with other applications, it might\r\n     * be interested to not cache the unpack flip y state to ensure a consistent\r\n     * value would be set.\r\n     */\r\n    public enableUnpackFlipYCached = true;\r\n\r\n    /** @hidden */\r\n    public _unpackFlipY(value: boolean): void {\r\n        if (this._unpackFlipYCached !== value) {\r\n            this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, value ? 1 : 0);\r\n\r\n            if (this.enableUnpackFlipYCached) {\r\n                this._unpackFlipYCached = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getUnpackAlignement(): number {\r\n        return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT);\r\n    }\r\n\r\n    /**\r\n     * Creates a dynamic texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param generateMipMaps defines if the engine should generate the mip levels\r\n     * @param samplingMode defines the required sampling mode (Texture.NEAREST_SAMPLINGMODE by default)\r\n     * @returns the dynamic texture inside an InternalTexture\r\n     */\r\n    public createDynamicTexture(width: number, height: number, generateMipMaps: boolean, samplingMode: number): InternalTexture {\r\n        var texture = new InternalTexture(this, InternalTexture.DATASOURCE_DYNAMIC);\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n\r\n        if (generateMipMaps) {\r\n            width = this.needPOTTextures ? Tools.GetExponentOfTwo(width, this._caps.maxTextureSize) : width;\r\n            height = this.needPOTTextures ? Tools.GetExponentOfTwo(height, this._caps.maxTextureSize) : height;\r\n        }\r\n\r\n        //  this.resetTextureCache();\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.isReady = false;\r\n        texture.generateMipMaps = generateMipMaps;\r\n        texture.samplingMode = samplingMode;\r\n\r\n        this.updateTextureSamplingMode(samplingMode, texture);\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param samplingMode defines the required sampling mode\r\n     * @param texture defines the texture to update\r\n     */\r\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture): void {\r\n        var filters = this._getSamplingParameters(samplingMode, texture.generateMipMaps);\r\n\r\n        if (texture.isCube) {\r\n            this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MAG_FILTER, filters.mag, texture);\r\n            this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MIN_FILTER, filters.min);\r\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n        } else if (texture.is3D) {\r\n            this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, filters.mag, texture);\r\n            this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, filters.min);\r\n            this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n        } else {\r\n            this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, filters.mag, texture);\r\n            this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, filters.min);\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n        }\r\n\r\n        texture.samplingMode = samplingMode;\r\n    }\r\n\r\n    /**\r\n     * Update the content of a dynamic texture\r\n     * @param texture defines the texture to update\r\n     * @param canvas defines the canvas containing the source\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param premulAlpha defines if alpha is stored as premultiplied\r\n     * @param format defines the format of the data\r\n     * @param forceBindTexture if the texture should be forced to be bound eg. after a graphics context loss (Default: false)\r\n     */\r\n    public updateDynamicTexture(texture: Nullable<InternalTexture>, canvas: HTMLCanvasElement, invertY: boolean, premulAlpha: boolean = false, format?: number, forceBindTexture: boolean = false): void {\r\n        if (!texture) {\r\n            return;\r\n        }\r\n\r\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, texture, true, forceBindTexture);\r\n        this._unpackFlipY(invertY);\r\n        if (premulAlpha) {\r\n            this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);\r\n        }\r\n        let internalFormat = format ? this._getInternalFormat(format) : this._gl.RGBA;\r\n        this._gl.texImage2D(this._gl.TEXTURE_2D, 0, internalFormat, internalFormat, this._gl.UNSIGNED_BYTE, canvas);\r\n        if (texture.generateMipMaps) {\r\n            this._gl.generateMipmap(this._gl.TEXTURE_2D);\r\n        }\r\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n        if (premulAlpha) {\r\n            this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\r\n        }\r\n        texture.isReady = true;\r\n    }\r\n\r\n    /**\r\n     * Update a video texture\r\n     * @param texture defines the texture to update\r\n     * @param video defines the video element to use\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     */\r\n    public updateVideoTexture(texture: Nullable<InternalTexture>, video: HTMLVideoElement, invertY: boolean): void {\r\n        if (!texture || texture._isDisabled) {\r\n            return;\r\n        }\r\n\r\n        var wasPreviouslyBound = this._bindTextureDirectly(this._gl.TEXTURE_2D, texture, true);\r\n        this._unpackFlipY(!invertY); // Video are upside down by default\r\n\r\n        try {\r\n            // Testing video texture support\r\n            if (this._videoTextureSupported === undefined) {\r\n                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, video);\r\n\r\n                if (this._gl.getError() !== 0) {\r\n                    this._videoTextureSupported = false;\r\n                } else {\r\n                    this._videoTextureSupported = true;\r\n                }\r\n            }\r\n\r\n            // Copy video through the current working canvas if video texture is not supported\r\n            if (!this._videoTextureSupported) {\r\n                if (!texture._workingCanvas) {\r\n                    texture._workingCanvas = document.createElement(\"canvas\");\r\n                    let context = texture._workingCanvas.getContext(\"2d\");\r\n\r\n                    if (!context) {\r\n                        throw new Error(\"Unable to get 2d context\");\r\n                    }\r\n\r\n                    texture._workingContext = context;\r\n                    texture._workingCanvas.width = texture.width;\r\n                    texture._workingCanvas.height = texture.height;\r\n                }\r\n\r\n                texture._workingContext!.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, texture.width, texture.height);\r\n\r\n                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, texture._workingCanvas);\r\n            } else {\r\n                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, video);\r\n            }\r\n\r\n            if (texture.generateMipMaps) {\r\n                this._gl.generateMipmap(this._gl.TEXTURE_2D);\r\n            }\r\n\r\n            if (!wasPreviouslyBound) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n            }\r\n            //    this.resetTextureCache();\r\n            texture.isReady = true;\r\n\r\n        } catch (ex) {\r\n            // Something unexpected\r\n            // Let's disable the texture\r\n            texture._isDisabled = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates a depth texture Comparison Mode and Function.\r\n     * If the comparison Function is equal to 0, the mode will be set to none.\r\n     * Otherwise, this only works in webgl 2 and requires a shadow sampler in the shader.\r\n     * @param texture The texture to set the comparison function for\r\n     * @param comparisonFunction The comparison function to set, 0 if no comparison required\r\n     */\r\n    public updateTextureComparisonFunction(texture: InternalTexture, comparisonFunction: number): void {\r\n        if (this.webGLVersion === 1) {\r\n            Logger.Error(\"WebGL 1 does not support texture comparison.\");\r\n            return;\r\n        }\r\n\r\n        var gl = this._gl;\r\n\r\n        if (texture.isCube) {\r\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, texture, true);\r\n\r\n            if (comparisonFunction === 0) {\r\n                gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_FUNC, Engine.LEQUAL);\r\n                gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_MODE, gl.NONE);\r\n            }\r\n            else {\r\n                gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_FUNC, comparisonFunction);\r\n                gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n            }\r\n\r\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n        } else {\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, texture, true);\r\n\r\n            if (comparisonFunction === 0) {\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, Engine.LEQUAL);\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.NONE);\r\n            }\r\n            else {\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, comparisonFunction);\r\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n            }\r\n\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n        }\r\n\r\n        texture._comparisonFunction = comparisonFunction;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _setupDepthStencilTexture(internalTexture: InternalTexture, size: number | { width: number, height: number }, generateStencil: boolean, bilinearFiltering: boolean, comparisonFunction: number): void {\r\n        var width = (<{ width: number, height: number }>size).width || <number>size;\r\n        var height = (<{ width: number, height: number }>size).height || <number>size;\r\n        internalTexture.baseWidth = width;\r\n        internalTexture.baseHeight = height;\r\n        internalTexture.width = width;\r\n        internalTexture.height = height;\r\n        internalTexture.isReady = true;\r\n        internalTexture.samples = 1;\r\n        internalTexture.generateMipMaps = false;\r\n        internalTexture._generateDepthBuffer = true;\r\n        internalTexture._generateStencilBuffer = generateStencil;\r\n        internalTexture.samplingMode = bilinearFiltering ? Engine.TEXTURE_BILINEAR_SAMPLINGMODE : Engine.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        internalTexture.type = Engine.TEXTURETYPE_UNSIGNED_INT;\r\n        internalTexture._comparisonFunction = comparisonFunction;\r\n\r\n        var gl = this._gl;\r\n        var target = internalTexture.isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\r\n        var samplingParameters = this._getSamplingParameters(internalTexture.samplingMode, false);\r\n        gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, samplingParameters.mag);\r\n        gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, samplingParameters.min);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        if (comparisonFunction === 0) {\r\n            gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, Engine.LEQUAL);\r\n            gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.NONE);\r\n        }\r\n        else {\r\n            gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, comparisonFunction);\r\n            gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a depth stencil texture.\r\n     * This is only available in WebGL 2 or with the depth texture extension available.\r\n     * @param size The size of face edge in the texture.\r\n     * @param options The options defining the texture.\r\n     * @returns The texture\r\n     */\r\n    public createDepthStencilTexture(size: number | { width: number, height: number }, options: DepthTextureCreationOptions): InternalTexture {\r\n        if (options.isCube) {\r\n            let width = (<{ width: number, height: number }>size).width || <number>size;\r\n            return this._createDepthStencilCubeTexture(width, options);\r\n        }\r\n        else {\r\n            return this._createDepthStencilTexture(size, options);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a depth stencil texture.\r\n     * This is only available in WebGL 2 or with the depth texture extension available.\r\n     * @param size The size of face edge in the texture.\r\n     * @param options The options defining the texture.\r\n     * @returns The texture\r\n     */\r\n    private _createDepthStencilTexture(size: number | { width: number, height: number }, options: DepthTextureCreationOptions): InternalTexture {\r\n        var internalTexture = new InternalTexture(this, InternalTexture.DATASOURCE_DEPTHTEXTURE);\r\n\r\n        if (!this._caps.depthTextureExtension) {\r\n            Logger.Error(\"Depth texture is not supported by your browser or hardware.\");\r\n            return internalTexture;\r\n        }\r\n\r\n        var internalOptions = {\r\n            bilinearFiltering: false,\r\n            comparisonFunction: 0,\r\n            generateStencil: false,\r\n            ...options\r\n        };\r\n\r\n        var gl = this._gl;\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, internalTexture, true);\r\n\r\n        this._setupDepthStencilTexture(internalTexture, size, internalOptions.generateStencil, internalOptions.bilinearFiltering, internalOptions.comparisonFunction);\r\n\r\n        if (this.webGLVersion > 1) {\r\n            if (internalOptions.generateStencil) {\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH24_STENCIL8, internalTexture.width, internalTexture.height, 0, gl.DEPTH_STENCIL, gl.UNSIGNED_INT_24_8, null);\r\n            }\r\n            else {\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_COMPONENT24, internalTexture.width, internalTexture.height, 0, gl.DEPTH_COMPONENT, gl.UNSIGNED_INT, null);\r\n            }\r\n        }\r\n        else {\r\n            if (internalOptions.generateStencil) {\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_STENCIL, internalTexture.width, internalTexture.height, 0, gl.DEPTH_STENCIL, gl.UNSIGNED_INT_24_8, null);\r\n            }\r\n            else {\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_COMPONENT, internalTexture.width, internalTexture.height, 0, gl.DEPTH_COMPONENT, gl.UNSIGNED_INT, null);\r\n            }\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, null);\r\n\r\n        return internalTexture;\r\n    }\r\n\r\n    /**\r\n     * Sets the frame buffer Depth / Stencil attachement of the render target to the defined depth stencil texture.\r\n     * @param renderTarget The render target to set the frame buffer for\r\n     */\r\n    public setFrameBufferDepthStencilTexture(renderTarget: RenderTargetTexture): void {\r\n        // Create the framebuffer\r\n        var internalTexture = renderTarget.getInternalTexture();\r\n        if (!internalTexture || !internalTexture._framebuffer || !renderTarget.depthStencilTexture) {\r\n            return;\r\n        }\r\n\r\n        var gl = this._gl;\r\n        var depthStencilTexture = renderTarget.depthStencilTexture;\r\n\r\n        this._bindUnboundFramebuffer(internalTexture._framebuffer);\r\n        if (depthStencilTexture.isCube) {\r\n            if (depthStencilTexture._generateStencilBuffer) {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.TEXTURE_CUBE_MAP_POSITIVE_X, depthStencilTexture._webGLTexture, 0);\r\n            }\r\n            else {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_CUBE_MAP_POSITIVE_X, depthStencilTexture._webGLTexture, 0);\r\n            }\r\n        }\r\n        else {\r\n            if (depthStencilTexture._generateStencilBuffer) {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.TEXTURE_2D, depthStencilTexture._webGLTexture, 0);\r\n            }\r\n            else {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depthStencilTexture._webGLTexture, 0);\r\n            }\r\n        }\r\n        this._bindUnboundFramebuffer(null);\r\n    }\r\n\r\n    /**\r\n     * Creates a new render target texture\r\n     * @param size defines the size of the texture\r\n     * @param options defines the options used to create the texture\r\n     * @returns a new render target texture stored in an InternalTexture\r\n     */\r\n    public createRenderTargetTexture(size: number | { width: number, height: number }, options: boolean | RenderTargetCreationOptions): InternalTexture {\r\n        let fullOptions = new RenderTargetCreationOptions();\r\n\r\n        if (options !== undefined && typeof options === \"object\") {\r\n            fullOptions.generateMipMaps = options.generateMipMaps;\r\n            fullOptions.generateDepthBuffer = options.generateDepthBuffer === undefined ? true : options.generateDepthBuffer;\r\n            fullOptions.generateStencilBuffer = fullOptions.generateDepthBuffer && options.generateStencilBuffer;\r\n            fullOptions.type = options.type === undefined ? Engine.TEXTURETYPE_UNSIGNED_INT : options.type;\r\n            fullOptions.samplingMode = options.samplingMode === undefined ? Engine.TEXTURE_TRILINEAR_SAMPLINGMODE : options.samplingMode;\r\n            fullOptions.format = options.format === undefined ? Engine.TEXTUREFORMAT_RGBA : options.format;\r\n        } else {\r\n            fullOptions.generateMipMaps = <boolean>options;\r\n            fullOptions.generateDepthBuffer = true;\r\n            fullOptions.generateStencilBuffer = false;\r\n            fullOptions.type = Engine.TEXTURETYPE_UNSIGNED_INT;\r\n            fullOptions.samplingMode = Engine.TEXTURE_TRILINEAR_SAMPLINGMODE;\r\n            fullOptions.format = Engine.TEXTUREFORMAT_RGBA;\r\n        }\r\n\r\n        if (fullOptions.type === Engine.TEXTURETYPE_FLOAT && !this._caps.textureFloatLinearFiltering) {\r\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            fullOptions.samplingMode = Engine.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        }\r\n        else if (fullOptions.type === Engine.TEXTURETYPE_HALF_FLOAT && !this._caps.textureHalfFloatLinearFiltering) {\r\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            fullOptions.samplingMode = Engine.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        }\r\n        var gl = this._gl;\r\n\r\n        var texture = new InternalTexture(this, InternalTexture.DATASOURCE_RENDERTARGET);\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n\r\n        var width = (<{ width: number, height: number }>size).width || <number>size;\r\n        var height = (<{ width: number, height: number }>size).height || <number>size;\r\n\r\n        var filters = this._getSamplingParameters(fullOptions.samplingMode, fullOptions.generateMipMaps ? true : false);\r\n\r\n        if (fullOptions.type === Engine.TEXTURETYPE_FLOAT && !this._caps.textureFloat) {\r\n            fullOptions.type = Engine.TEXTURETYPE_UNSIGNED_INT;\r\n            Logger.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\");\r\n        }\r\n\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filters.mag);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filters.min);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(fullOptions.type, fullOptions.format), width, height, 0, this._getInternalFormat(fullOptions.format), this._getWebGLTextureType(fullOptions.type), null);\r\n\r\n        // Create the framebuffer\r\n        var currentFrameBuffer = this._currentFramebuffer;\r\n        var framebuffer = gl.createFramebuffer();\r\n        this._bindUnboundFramebuffer(framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture._webGLTexture, 0);\r\n\r\n        texture._depthStencilBuffer = this._setupFramebufferDepthAttachments(fullOptions.generateStencilBuffer ? true : false, fullOptions.generateDepthBuffer, width, height);\r\n\r\n        if (fullOptions.generateMipMaps) {\r\n            this._gl.generateMipmap(this._gl.TEXTURE_2D);\r\n        }\r\n\r\n        // Unbind\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, null);\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        this._bindUnboundFramebuffer(currentFrameBuffer);\r\n\r\n        texture._framebuffer = framebuffer;\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.isReady = true;\r\n        texture.samples = 1;\r\n        texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\r\n        texture.samplingMode = fullOptions.samplingMode;\r\n        texture.type = fullOptions.type;\r\n        texture.format = fullOptions.format;\r\n        texture._generateDepthBuffer = fullOptions.generateDepthBuffer;\r\n        texture._generateStencilBuffer = fullOptions.generateStencilBuffer ? true : false;\r\n\r\n        // this.resetTextureCache();\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _setupFramebufferDepthAttachments(generateStencilBuffer: boolean, generateDepthBuffer: boolean, width: number, height: number, samples = 1): Nullable<WebGLRenderbuffer> {\r\n        var depthStencilBuffer: Nullable<WebGLRenderbuffer> = null;\r\n        var gl = this._gl;\r\n\r\n        // Create the depth/stencil buffer\r\n        if (generateStencilBuffer) {\r\n            depthStencilBuffer = gl.createRenderbuffer();\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, depthStencilBuffer);\r\n\r\n            if (samples > 1) {\r\n                gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, gl.DEPTH24_STENCIL8, width, height);\r\n            } else {\r\n                gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, width, height);\r\n            }\r\n\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, depthStencilBuffer);\r\n        }\r\n        else if (generateDepthBuffer) {\r\n            depthStencilBuffer = gl.createRenderbuffer();\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, depthStencilBuffer);\r\n\r\n            if (samples > 1) {\r\n                gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, gl.DEPTH_COMPONENT16, width, height);\r\n            } else {\r\n                gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\r\n            }\r\n\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthStencilBuffer);\r\n        }\r\n\r\n        return depthStencilBuffer;\r\n    }\r\n\r\n    /**\r\n     * Updates the sample count of a render target texture\r\n     * @see http://doc.babylonjs.com/features/webgl2#multisample-render-targets\r\n     * @param texture defines the texture to update\r\n     * @param samples defines the sample count to set\r\n     * @returns the effective sample count (could be 0 if multisample render targets are not supported)\r\n     */\r\n    public updateRenderTargetTextureSampleCount(texture: Nullable<InternalTexture>, samples: number): number {\r\n        if (this.webGLVersion < 2 || !texture) {\r\n            return 1;\r\n        }\r\n\r\n        if (texture.samples === samples) {\r\n            return samples;\r\n        }\r\n\r\n        var gl = this._gl;\r\n\r\n        samples = Math.min(samples, gl.getParameter(gl.MAX_SAMPLES));\r\n\r\n        // Dispose previous render buffers\r\n        if (texture._depthStencilBuffer) {\r\n            gl.deleteRenderbuffer(texture._depthStencilBuffer);\r\n            texture._depthStencilBuffer = null;\r\n        }\r\n\r\n        if (texture._MSAAFramebuffer) {\r\n            gl.deleteFramebuffer(texture._MSAAFramebuffer);\r\n            texture._MSAAFramebuffer = null;\r\n        }\r\n\r\n        if (texture._MSAARenderBuffer) {\r\n            gl.deleteRenderbuffer(texture._MSAARenderBuffer);\r\n            texture._MSAARenderBuffer = null;\r\n        }\r\n\r\n        if (samples > 1) {\r\n            let framebuffer = gl.createFramebuffer();\r\n\r\n            if (!framebuffer) {\r\n                throw new Error(\"Unable to create multi sampled framebuffer\");\r\n            }\r\n\r\n            texture._MSAAFramebuffer = framebuffer;\r\n            this._bindUnboundFramebuffer(texture._MSAAFramebuffer);\r\n\r\n            var colorRenderbuffer = gl.createRenderbuffer();\r\n\r\n            if (!colorRenderbuffer) {\r\n                throw new Error(\"Unable to create multi sampled framebuffer\");\r\n            }\r\n\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, colorRenderbuffer);\r\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, this._getRGBAMultiSampleBufferFormat(texture.type), texture.width, texture.height);\r\n\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, colorRenderbuffer);\r\n\r\n            texture._MSAARenderBuffer = colorRenderbuffer;\r\n        } else {\r\n            this._bindUnboundFramebuffer(texture._framebuffer);\r\n        }\r\n\r\n        texture.samples = samples;\r\n        texture._depthStencilBuffer = this._setupFramebufferDepthAttachments(texture._generateStencilBuffer, texture._generateDepthBuffer, texture.width, texture.height, samples);\r\n\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        this._bindUnboundFramebuffer(null);\r\n\r\n        return samples;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadCompressedDataToTextureDirectly(texture: InternalTexture, internalFormat: number, width: number, height: number, data: ArrayBufferView, faceIndex: number = 0, lod: number = 0) {\r\n        var gl = this._gl;\r\n\r\n        var target = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        this._gl.compressedTexImage2D(target, lod, internalFormat, width, height, 0, <DataView>data);\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadDataToTextureDirectly(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        var gl = this._gl;\r\n\r\n        var textureType = this._getWebGLTextureType(texture.type);\r\n        var format = this._getInternalFormat(texture.format);\r\n        var internalFormat = this._getRGBABufferInternalSizedFormat(texture.type, format);\r\n\r\n        this._unpackFlipY(texture.invertY);\r\n\r\n        var target = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        const lodMaxWidth = Math.round(Scalar.Log2(texture.width));\r\n        const lodMaxHeight = Math.round(Scalar.Log2(texture.height));\r\n        const width = Math.pow(2, Math.max(lodMaxWidth - lod, 0));\r\n        const height = Math.pow(2, Math.max(lodMaxHeight - lod, 0));\r\n\r\n        gl.texImage2D(target, lod, internalFormat, width, height, 0, format, textureType, imageData);\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        var gl = this._gl;\r\n        var bindTarget = texture.isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\r\n\r\n        this._bindTextureDirectly(bindTarget, texture, true);\r\n\r\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\r\n\r\n        this._bindTextureDirectly(bindTarget, null, true);\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadImageToTexture(texture: InternalTexture, image: HTMLImageElement, faceIndex: number = 0, lod: number = 0) {\r\n        var gl = this._gl;\r\n\r\n        var textureType = this._getWebGLTextureType(texture.type);\r\n        var format = this._getInternalFormat(texture.format);\r\n        var internalFormat = this._getRGBABufferInternalSizedFormat(texture.type, format);\r\n\r\n        var bindTarget = texture.isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\r\n\r\n        this._bindTextureDirectly(bindTarget, texture, true);\r\n        this._unpackFlipY(texture.invertY);\r\n\r\n        var target = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        gl.texImage2D(target, lod, internalFormat, format, textureType, image);\r\n        this._bindTextureDirectly(bindTarget, null, true);\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _setCubeMapTextureParams(loadMipmap: boolean): void {\r\n        var gl = this._gl;\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, loadMipmap ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP, null);\r\n    }\r\n\r\n    /**\r\n     * Creates a new raw cube texture\r\n     * @param data defines the array of data to use to create each face\r\n     * @param size defines the size of the textures\r\n     * @param format defines the format of the data\r\n     * @param type defines the type of the data (like Engine.TEXTURETYPE_UNSIGNED_INT)\r\n     * @param generateMipMaps  defines if the engine should generate the mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compression used (null by default)\r\n     * @returns the cube texture as an InternalTexture\r\n     */\r\n    public createRawCubeTexture(data: Nullable<ArrayBufferView[]>, size: number, format: number, type: number,\r\n        generateMipMaps: boolean, invertY: boolean, samplingMode: number,\r\n        compression: Nullable<string> = null): InternalTexture {\r\n        throw _DevTools.WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    /**\r\n     * Creates a new raw 3D texture\r\n     * @param data defines the data used to create the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param depth defines the depth of the texture\r\n     * @param format defines the format of the texture\r\n     * @param generateMipMaps defines if the engine must generate mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compressed used (can be null)\r\n     * @param textureType defines the compressed used (can be null)\r\n     * @returns a new raw 3D texture (stored in an InternalTexture)\r\n     */\r\n    public createRawTexture3D(data: Nullable<ArrayBufferView>, width: number, height: number, depth: number, format: number, generateMipMaps: boolean, invertY: boolean, samplingMode: number, compression: Nullable<string> = null, textureType = Engine.TEXTURETYPE_UNSIGNED_INT): InternalTexture {\r\n        throw _DevTools.WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    private _prepareWebGLTextureContinuation(texture: InternalTexture, scene: Nullable<Scene>, noMipmap: boolean, isCompressed: boolean, samplingMode: number): void {\r\n        var gl = this._gl;\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        var filters = this._getSamplingParameters(samplingMode, !noMipmap);\r\n\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filters.mag);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filters.min);\r\n\r\n        if (!noMipmap && !isCompressed) {\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, null);\r\n\r\n        // this.resetTextureCache();\r\n        if (scene) {\r\n            scene._removePendingData(texture);\r\n        }\r\n\r\n        texture.onLoadedObservable.notifyObservers(texture);\r\n        texture.onLoadedObservable.clear();\r\n    }\r\n\r\n    private _prepareWebGLTexture(texture: InternalTexture, scene: Nullable<Scene>, width: number, height: number, invertY: boolean, noMipmap: boolean, isCompressed: boolean,\r\n        processFunction: (width: number, height: number, continuationCallback: () => void) => boolean, samplingMode: number = Engine.TEXTURE_TRILINEAR_SAMPLINGMODE): void {\r\n        var maxTextureSize = this.getCaps().maxTextureSize;\r\n        var potWidth = Math.min(maxTextureSize, this.needPOTTextures ? Tools.GetExponentOfTwo(width, maxTextureSize) : width);\r\n        var potHeight = Math.min(maxTextureSize, this.needPOTTextures ? Tools.GetExponentOfTwo(height, maxTextureSize) : height);\r\n\r\n        var gl = this._gl;\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        if (!texture._webGLTexture) {\r\n            //  this.resetTextureCache();\r\n            if (scene) {\r\n                scene._removePendingData(texture);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n        this._unpackFlipY(invertY === undefined ? true : (invertY ? true : false));\r\n\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = potWidth;\r\n        texture.height = potHeight;\r\n        texture.isReady = true;\r\n\r\n        if (processFunction(potWidth, potHeight, () => {\r\n            this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\r\n        })) {\r\n            // Returning as texture needs extra async steps\r\n            return;\r\n        }\r\n\r\n        this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\r\n    }\r\n\r\n    /** @hidden */\r\n    public _convertRGBtoRGBATextureData(rgbData: any, width: number, height: number, textureType: number): ArrayBufferView {\r\n        // Create new RGBA data container.\r\n        var rgbaData: any;\r\n        if (textureType === Engine.TEXTURETYPE_FLOAT) {\r\n            rgbaData = new Float32Array(width * height * 4);\r\n        }\r\n        else {\r\n            rgbaData = new Uint32Array(width * height * 4);\r\n        }\r\n\r\n        // Convert each pixel.\r\n        for (let x = 0; x < width; x++) {\r\n            for (let y = 0; y < height; y++) {\r\n                let index = (y * width + x) * 3;\r\n                let newIndex = (y * width + x) * 4;\r\n\r\n                // Map Old Value to new value.\r\n                rgbaData[newIndex + 0] = rgbData[index + 0];\r\n                rgbaData[newIndex + 1] = rgbData[index + 1];\r\n                rgbaData[newIndex + 2] = rgbData[index + 2];\r\n\r\n                // Add fully opaque alpha channel.\r\n                rgbaData[newIndex + 3] = 1;\r\n            }\r\n        }\r\n\r\n        return rgbaData;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _releaseFramebufferObjects(texture: InternalTexture): void {\r\n        var gl = this._gl;\r\n\r\n        if (texture._framebuffer) {\r\n            gl.deleteFramebuffer(texture._framebuffer);\r\n            texture._framebuffer = null;\r\n        }\r\n\r\n        if (texture._depthStencilBuffer) {\r\n            gl.deleteRenderbuffer(texture._depthStencilBuffer);\r\n            texture._depthStencilBuffer = null;\r\n        }\r\n\r\n        if (texture._MSAAFramebuffer) {\r\n            gl.deleteFramebuffer(texture._MSAAFramebuffer);\r\n            texture._MSAAFramebuffer = null;\r\n        }\r\n\r\n        if (texture._MSAARenderBuffer) {\r\n            gl.deleteRenderbuffer(texture._MSAARenderBuffer);\r\n            texture._MSAARenderBuffer = null;\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _releaseTexture(texture: InternalTexture): void {\r\n        var gl = this._gl;\r\n\r\n        this._releaseFramebufferObjects(texture);\r\n\r\n        gl.deleteTexture(texture._webGLTexture);\r\n\r\n        // Unbind channels\r\n        this.unbindAllTextures();\r\n\r\n        var index = this._internalTexturesCache.indexOf(texture);\r\n        if (index !== -1) {\r\n            this._internalTexturesCache.splice(index, 1);\r\n        }\r\n\r\n        // Integrated fixed lod samplers.\r\n        if (texture._lodTextureHigh) {\r\n            texture._lodTextureHigh.dispose();\r\n        }\r\n        if (texture._lodTextureMid) {\r\n            texture._lodTextureMid.dispose();\r\n        }\r\n        if (texture._lodTextureLow) {\r\n            texture._lodTextureLow.dispose();\r\n        }\r\n\r\n        // Set output texture of post process to null if the texture has been released/disposed\r\n        this.scenes.forEach((scene) => {\r\n            scene.postProcesses.forEach((postProcess) => {\r\n                if (postProcess._outputTexture == texture) {\r\n                    postProcess._outputTexture = null;\r\n                }\r\n            });\r\n            scene.cameras.forEach((camera) => {\r\n                camera._postProcesses.forEach((postProcess) => {\r\n                    if (postProcess) {\r\n                        if (postProcess._outputTexture == texture) {\r\n                            postProcess._outputTexture = null;\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    private setProgram(program: WebGLProgram): void {\r\n        if (this._currentProgram !== program) {\r\n            this._gl.useProgram(program);\r\n            this._currentProgram = program;\r\n        }\r\n    }\r\n\r\n    private _boundUniforms: { [key: number]: WebGLUniformLocation } = {};\r\n\r\n    /**\r\n     * Binds an effect to the webGL context\r\n     * @param effect defines the effect to bind\r\n     */\r\n    public bindSamplers(effect: Effect): void {\r\n        let webGLPipelineContext = effect.getPipelineContext() as WebGLPipelineContext;\r\n        this.setProgram(webGLPipelineContext.program!);\r\n        var samplers = effect.getSamplers();\r\n        for (var index = 0; index < samplers.length; index++) {\r\n            var uniform = effect.getUniform(samplers[index]);\r\n\r\n            if (uniform) {\r\n                this._boundUniforms[index] = uniform;\r\n            }\r\n        }\r\n        this._currentEffect = null;\r\n    }\r\n\r\n    private _activateCurrentTexture() {\r\n        if (this._currentTextureChannel !== this._activeChannel) {\r\n            this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel);\r\n            this._currentTextureChannel = this._activeChannel;\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _bindTextureDirectly(target: number, texture: Nullable<InternalTexture>, forTextureDataUpdate = false, force = false): boolean {\r\n        var wasPreviouslyBound = false;\r\n        let isTextureForRendering = texture && texture._associatedChannel > -1;\r\n        if (forTextureDataUpdate && isTextureForRendering) {\r\n            this._activeChannel = texture!._associatedChannel;\r\n        }\r\n\r\n        let currentTextureBound = this._boundTexturesCache[this._activeChannel];\r\n\r\n        if (currentTextureBound !== texture || force) {\r\n            this._activateCurrentTexture();\r\n\r\n            if (texture && texture.isMultiview) {\r\n                this._gl.bindTexture(target, texture ? texture._colorTextureArray : null);\r\n            } else {\r\n                this._gl.bindTexture(target, texture ? texture._webGLTexture : null);\r\n            }\r\n\r\n            this._boundTexturesCache[this._activeChannel] = texture;\r\n\r\n            if (texture) {\r\n                texture._associatedChannel = this._activeChannel;\r\n            }\r\n        } else if (forTextureDataUpdate) {\r\n            wasPreviouslyBound = true;\r\n            this._activateCurrentTexture();\r\n        }\r\n\r\n        if (isTextureForRendering && !forTextureDataUpdate) {\r\n            this._bindSamplerUniformToChannel(texture!._associatedChannel, this._activeChannel);\r\n        }\r\n\r\n        return wasPreviouslyBound;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _bindTexture(channel: number, texture: Nullable<InternalTexture>): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (texture) {\r\n            texture._associatedChannel = channel;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, texture);\r\n    }\r\n\r\n    /**\r\n     * Sets a texture to the webGL context from a postprocess\r\n     * @param channel defines the channel to use\r\n     * @param postProcess defines the source postprocess\r\n     */\r\n    public setTextureFromPostProcess(channel: number, postProcess: Nullable<PostProcess>): void {\r\n        this._bindTexture(channel, postProcess ? postProcess._textures.data[postProcess._currentRenderTextureInd] : null);\r\n    }\r\n\r\n    /**\r\n     * Binds the output of the passed in post process to the texture channel specified\r\n     * @param channel The channel the texture should be bound to\r\n     * @param postProcess The post process which's output should be bound\r\n     */\r\n    public setTextureFromPostProcessOutput(channel: number, postProcess: Nullable<PostProcess>): void {\r\n        this._bindTexture(channel, postProcess ? postProcess._outputTexture : null);\r\n    }\r\n\r\n    /**\r\n     * Unbind all textures from the webGL context\r\n     */\r\n    public unbindAllTextures(): void {\r\n        for (var channel = 0; channel < this._maxSimultaneousTextures; channel++) {\r\n            this._activeChannel = channel;\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n            if (this.webGLVersion > 1) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a texture to the according uniform.\r\n     * @param channel The texture channel\r\n     * @param uniform The uniform to set\r\n     * @param texture The texture to apply\r\n     */\r\n    public setTexture(channel: number, uniform: Nullable<WebGLUniformLocation>, texture: Nullable<BaseTexture>): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (uniform) {\r\n            this._boundUniforms[channel] = uniform;\r\n        }\r\n\r\n        this._setTexture(channel, texture);\r\n    }\r\n\r\n    /**\r\n     * Sets a depth stencil texture from a render target to the according uniform.\r\n     * @param channel The texture channel\r\n     * @param uniform The uniform to set\r\n     * @param texture The render target texture containing the depth stencil texture to apply\r\n     */\r\n    public setDepthStencilTexture(channel: number, uniform: Nullable<WebGLUniformLocation>, texture: Nullable<RenderTargetTexture>): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (uniform) {\r\n            this._boundUniforms[channel] = uniform;\r\n        }\r\n\r\n        if (!texture || !texture.depthStencilTexture) {\r\n            this._setTexture(channel, null);\r\n        }\r\n        else {\r\n            this._setTexture(channel, texture, false, true);\r\n        }\r\n    }\r\n\r\n    private _bindSamplerUniformToChannel(sourceSlot: number, destination: number) {\r\n        let uniform = this._boundUniforms[sourceSlot];\r\n        if (uniform._currentState === destination) {\r\n            return;\r\n        }\r\n        this._gl.uniform1i(uniform, destination);\r\n        uniform._currentState = destination;\r\n    }\r\n\r\n    private _getTextureWrapMode(mode: number): number {\r\n        switch (mode) {\r\n            case Engine.TEXTURE_WRAP_ADDRESSMODE:\r\n                return this._gl.REPEAT;\r\n            case Engine.TEXTURE_CLAMP_ADDRESSMODE:\r\n                return this._gl.CLAMP_TO_EDGE;\r\n            case Engine.TEXTURE_MIRROR_ADDRESSMODE:\r\n                return this._gl.MIRRORED_REPEAT;\r\n        }\r\n        return this._gl.REPEAT;\r\n    }\r\n\r\n    private _setTexture(channel: number, texture: Nullable<BaseTexture>, isPartOfTextureArray = false, depthStencilTexture = false): boolean {\r\n        // Not ready?\r\n        if (!texture) {\r\n            if (this._boundTexturesCache[channel] != null) {\r\n                this._activeChannel = channel;\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n                this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n                if (this.webGLVersion > 1) {\r\n                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // Video\r\n        if ((<VideoTexture>texture).video) {\r\n            this._activeChannel = channel;\r\n            (<VideoTexture>texture).update();\r\n        } else if (texture.delayLoadState === Engine.DELAYLOADSTATE_NOTLOADED) { // Delay loading\r\n            texture.delayLoad();\r\n            return false;\r\n        }\r\n\r\n        let internalTexture: InternalTexture;\r\n        if (depthStencilTexture) {\r\n            internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\r\n        }\r\n        else if (texture.isReady()) {\r\n            internalTexture = <InternalTexture>texture.getInternalTexture();\r\n        }\r\n        else if (texture.isCube) {\r\n            internalTexture = this.emptyCubeTexture;\r\n        }\r\n        else if (texture.is3D) {\r\n            internalTexture = this.emptyTexture3D;\r\n        }\r\n        else {\r\n            internalTexture = this.emptyTexture;\r\n        }\r\n\r\n        if (!isPartOfTextureArray && internalTexture) {\r\n            internalTexture._associatedChannel = channel;\r\n        }\r\n\r\n        let needToBind = true;\r\n        if (this._boundTexturesCache[channel] === internalTexture) {\r\n            if (!isPartOfTextureArray) {\r\n                this._bindSamplerUniformToChannel(internalTexture._associatedChannel, channel);\r\n            }\r\n\r\n            needToBind = false;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n        if (internalTexture && internalTexture.isMultiview) {\r\n            if (needToBind) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, internalTexture, isPartOfTextureArray);\r\n            }\r\n        } else if (internalTexture && internalTexture.is3D) {\r\n            if (needToBind) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_3D, internalTexture, isPartOfTextureArray);\r\n            }\r\n\r\n            if (internalTexture && internalTexture._cachedWrapU !== texture.wrapU) {\r\n                internalTexture._cachedWrapU = texture.wrapU;\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(texture.wrapU), internalTexture);\r\n            }\r\n\r\n            if (internalTexture && internalTexture._cachedWrapV !== texture.wrapV) {\r\n                internalTexture._cachedWrapV = texture.wrapV;\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(texture.wrapV), internalTexture);\r\n            }\r\n\r\n            if (internalTexture && internalTexture._cachedWrapR !== texture.wrapR) {\r\n                internalTexture._cachedWrapR = texture.wrapR;\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(texture.wrapR), internalTexture);\r\n            }\r\n\r\n            this._setAnisotropicLevel(this._gl.TEXTURE_3D, texture);\r\n        }\r\n        else if (internalTexture && internalTexture.isCube) {\r\n            if (needToBind) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, internalTexture, isPartOfTextureArray);\r\n            }\r\n\r\n            if (internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\r\n                internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\r\n                // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\r\n                var textureWrapMode = (texture.coordinatesMode !== Engine.TEXTURE_CUBIC_MODE && texture.coordinatesMode !== Engine.TEXTURE_SKYBOX_MODE) ? this._gl.REPEAT : this._gl.CLAMP_TO_EDGE;\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_S, textureWrapMode, internalTexture);\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_T, textureWrapMode);\r\n            }\r\n\r\n            this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP, texture);\r\n        } else {\r\n            if (needToBind) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D, internalTexture, isPartOfTextureArray);\r\n            }\r\n\r\n            if (internalTexture && internalTexture._cachedWrapU !== texture.wrapU) {\r\n                internalTexture._cachedWrapU = texture.wrapU;\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(texture.wrapU), internalTexture);\r\n            }\r\n\r\n            if (internalTexture && internalTexture._cachedWrapV !== texture.wrapV) {\r\n                internalTexture._cachedWrapV = texture.wrapV;\r\n                this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(texture.wrapV), internalTexture);\r\n            }\r\n\r\n            this._setAnisotropicLevel(this._gl.TEXTURE_2D, texture);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Sets an array of texture to the webGL context\r\n     * @param channel defines the channel where the texture array must be set\r\n     * @param uniform defines the associated uniform location\r\n     * @param textures defines the array of textures to bind\r\n     */\r\n    public setTextureArray(channel: number, uniform: Nullable<WebGLUniformLocation>, textures: BaseTexture[]): void {\r\n        if (channel === undefined || !uniform) {\r\n            return;\r\n        }\r\n\r\n        if (!this._textureUnits || this._textureUnits.length !== textures.length) {\r\n            this._textureUnits = new Int32Array(textures.length);\r\n        }\r\n        for (let i = 0; i < textures.length; i++) {\r\n            let texture = textures[i].getInternalTexture();\r\n\r\n            if (texture) {\r\n                this._textureUnits[channel + i] = channel + i;\r\n                texture._associatedChannel = channel + i;\r\n            } else {\r\n                this._textureUnits[channel + i] = -1;\r\n            }\r\n        }\r\n        this._gl.uniform1iv(uniform, this._textureUnits);\r\n\r\n        for (var index = 0; index < textures.length; index++) {\r\n            this._setTexture(this._textureUnits[index], textures[index], true);\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _setAnisotropicLevel(target: number, texture: BaseTexture) {\r\n        var internalTexture = texture.getInternalTexture();\r\n\r\n        if (!internalTexture) {\r\n            return;\r\n        }\r\n\r\n        var anisotropicFilterExtension = this._caps.textureAnisotropicFilterExtension;\r\n        var value = texture.anisotropicFilteringLevel;\r\n\r\n        if (internalTexture.samplingMode !== Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST\r\n            && internalTexture.samplingMode !== Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR\r\n            && internalTexture.samplingMode !== Engine.TEXTURE_LINEAR_LINEAR) {\r\n            value = 1; // Forcing the anisotropic to 1 because else webgl will force filters to linear\r\n        }\r\n\r\n        if (anisotropicFilterExtension && internalTexture._cachedAnisotropicFilteringLevel !== value) {\r\n            this._setTextureParameterFloat(target, anisotropicFilterExtension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(value, this._caps.maxAnisotropy), internalTexture);\r\n            internalTexture._cachedAnisotropicFilteringLevel = value;\r\n        }\r\n    }\r\n\r\n    private _setTextureParameterFloat(target: number, parameter: number, value: number, texture: InternalTexture): void {\r\n        this._bindTextureDirectly(target, texture, true, true);\r\n        this._gl.texParameterf(target, parameter, value);\r\n    }\r\n\r\n    private _setTextureParameterInteger(target: number, parameter: number, value: number, texture?: InternalTexture) {\r\n        if (texture) {\r\n            this._bindTextureDirectly(target, texture, true, true);\r\n        }\r\n        this._gl.texParameteri(target, parameter, value);\r\n    }\r\n\r\n    /**\r\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\r\n     * @param x defines the x coordinate of the rectangle where pixels must be read\r\n     * @param y defines the y coordinate of the rectangle where pixels must be read\r\n     * @param width defines the width of the rectangle where pixels must be read\r\n     * @param height defines the height of the rectangle where pixels must be read\r\n     * @returns a Uint8Array containing RGBA colors\r\n     */\r\n    public readPixels(x: number, y: number, width: number, height: number): Uint8Array {\r\n        var data = new Uint8Array(height * width * 4);\r\n        this._gl.readPixels(x, y, width, height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, data);\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Add an externaly attached data from its key.\r\n     * This method call will fail and return false, if such key already exists.\r\n     * If you don't care and just want to get the data no matter what, use the more convenient getOrAddExternalDataWithFactory() method.\r\n     * @param key the unique key that identifies the data\r\n     * @param data the data object to associate to the key for this Engine instance\r\n     * @return true if no such key were already present and the data was added successfully, false otherwise\r\n     */\r\n    public addExternalData<T>(key: string, data: T): boolean {\r\n        if (!this._externalData) {\r\n            this._externalData = new StringDictionary<Object>();\r\n        }\r\n        return this._externalData.add(key, data);\r\n    }\r\n\r\n    /**\r\n     * Get an externaly attached data from its key\r\n     * @param key the unique key that identifies the data\r\n     * @return the associated data, if present (can be null), or undefined if not present\r\n     */\r\n    public getExternalData<T>(key: string): T {\r\n        if (!this._externalData) {\r\n            this._externalData = new StringDictionary<Object>();\r\n        }\r\n        return <T>this._externalData.get(key);\r\n    }\r\n\r\n    /**\r\n     * Get an externaly attached data from its key, create it using a factory if it's not already present\r\n     * @param key the unique key that identifies the data\r\n     * @param factory the factory that will be called to create the instance if and only if it doesn't exists\r\n     * @return the associated data, can be null if the factory returned null.\r\n     */\r\n    public getOrAddExternalDataWithFactory<T>(key: string, factory: (k: string) => T): T {\r\n        if (!this._externalData) {\r\n            this._externalData = new StringDictionary<Object>();\r\n        }\r\n        return <T>this._externalData.getOrAddWithFactory(key, factory);\r\n    }\r\n\r\n    /**\r\n     * Remove an externaly attached data from the Engine instance\r\n     * @param key the unique key that identifies the data\r\n     * @return true if the data was successfully removed, false if it doesn't exist\r\n     */\r\n    public removeExternalData(key: string): boolean {\r\n        if (!this._externalData) {\r\n            this._externalData = new StringDictionary<Object>();\r\n        }\r\n\r\n        return this._externalData.remove(key);\r\n    }\r\n\r\n    /**\r\n     * Unbind all vertex attributes from the webGL context\r\n     */\r\n    public unbindAllAttributes() {\r\n        if (this._mustWipeVertexAttributes) {\r\n            this._mustWipeVertexAttributes = false;\r\n\r\n            for (var i = 0; i < this._caps.maxVertexAttribs; i++) {\r\n                this._gl.disableVertexAttribArray(i);\r\n                this._vertexAttribArraysEnabled[i] = false;\r\n                this._currentBufferPointers[i].active = false;\r\n            }\r\n            return;\r\n        }\r\n\r\n        for (var i = 0, ul = this._vertexAttribArraysEnabled.length; i < ul; i++) {\r\n            if (i >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[i]) {\r\n                continue;\r\n            }\r\n\r\n            this._gl.disableVertexAttribArray(i);\r\n            this._vertexAttribArraysEnabled[i] = false;\r\n            this._currentBufferPointers[i].active = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\r\n     */\r\n    public releaseEffects() {\r\n        for (var name in this._compiledEffects) {\r\n            let webGLPipelineContext = this._compiledEffects[name].getPipelineContext() as WebGLPipelineContext;\r\n            this._deletePipelineContext(webGLPipelineContext);\r\n        }\r\n\r\n        this._compiledEffects = {};\r\n    }\r\n\r\n    /**\r\n     * Dispose and release all associated resources\r\n     */\r\n    public dispose(): void {\r\n        this.hideLoadingUI();\r\n\r\n        this.stopRenderLoop();\r\n\r\n        this.onNewSceneAddedObservable.clear();\r\n\r\n        // Release postProcesses\r\n        while (this.postProcesses.length) {\r\n            this.postProcesses[0].dispose();\r\n        }\r\n\r\n        // Empty texture\r\n        if (this._emptyTexture) {\r\n            this._releaseTexture(this._emptyTexture);\r\n            this._emptyTexture = null;\r\n        }\r\n        if (this._emptyCubeTexture) {\r\n            this._releaseTexture(this._emptyCubeTexture);\r\n            this._emptyCubeTexture = null;\r\n        }\r\n\r\n        // Rescale PP\r\n        if (this._rescalePostProcess) {\r\n            this._rescalePostProcess.dispose();\r\n        }\r\n\r\n        // Release scenes\r\n        while (this.scenes.length) {\r\n            this.scenes[0].dispose();\r\n        }\r\n\r\n        // Release audio engine\r\n        if (Engine.Instances.length === 1 && Engine.audioEngine) {\r\n            Engine.audioEngine.dispose();\r\n        }\r\n\r\n        // Release effects\r\n        this.releaseEffects();\r\n\r\n        // Unbind\r\n        this.unbindAllAttributes();\r\n        this._boundUniforms = [];\r\n\r\n        if (this._dummyFramebuffer) {\r\n            this._gl.deleteFramebuffer(this._dummyFramebuffer);\r\n        }\r\n\r\n        //WebVR\r\n        this.disableVR();\r\n\r\n        // Events\r\n        if (DomManagement.IsWindowObjectExist()) {\r\n            window.removeEventListener(\"blur\", this._onBlur);\r\n            window.removeEventListener(\"focus\", this._onFocus);\r\n            if (this._renderingCanvas) {\r\n                this._renderingCanvas.removeEventListener(\"focus\", this._onCanvasFocus);\r\n                this._renderingCanvas.removeEventListener(\"blur\", this._onCanvasBlur);\r\n                this._renderingCanvas.removeEventListener(\"pointerout\", this._onCanvasPointerOut);\r\n\r\n                if (!this._doNotHandleContextLost) {\r\n                    this._renderingCanvas.removeEventListener(\"webglcontextlost\", this._onContextLost);\r\n                    this._renderingCanvas.removeEventListener(\"webglcontextrestored\", this._onContextRestored);\r\n                }\r\n            }\r\n            document.removeEventListener(\"fullscreenchange\", this._onFullscreenChange);\r\n            document.removeEventListener(\"mozfullscreenchange\", this._onFullscreenChange);\r\n            document.removeEventListener(\"webkitfullscreenchange\", this._onFullscreenChange);\r\n            document.removeEventListener(\"msfullscreenchange\", this._onFullscreenChange);\r\n            document.removeEventListener(\"pointerlockchange\", this._onPointerLockChange);\r\n            document.removeEventListener(\"mspointerlockchange\", this._onPointerLockChange);\r\n            document.removeEventListener(\"mozpointerlockchange\", this._onPointerLockChange);\r\n            document.removeEventListener(\"webkitpointerlockchange\", this._onPointerLockChange);\r\n        }\r\n\r\n        // Remove from Instances\r\n        var index = Engine.Instances.indexOf(this);\r\n\r\n        if (index >= 0) {\r\n            Engine.Instances.splice(index, 1);\r\n        }\r\n\r\n        this._workingCanvas = null;\r\n        this._workingContext = null;\r\n        this._currentBufferPointers = [];\r\n        this._renderingCanvas = null;\r\n        this._currentProgram = null;\r\n        this._bindedRenderFunction = null;\r\n\r\n        this.onResizeObservable.clear();\r\n        this.onCanvasBlurObservable.clear();\r\n        this.onCanvasFocusObservable.clear();\r\n        this.onCanvasPointerOutObservable.clear();\r\n        this.onBeginFrameObservable.clear();\r\n        this.onEndFrameObservable.clear();\r\n\r\n        Effect.ResetCache();\r\n\r\n        // Abort active requests\r\n        for (let request of this._activeRequests) {\r\n            request.abort();\r\n        }\r\n    }\r\n\r\n    // Loading screen\r\n\r\n    /**\r\n     * Display the loading screen\r\n     * @see http://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\r\n     */\r\n    public displayLoadingUI(): void {\r\n        if (!DomManagement.IsWindowObjectExist()) {\r\n            return;\r\n        }\r\n        const loadingScreen = this.loadingScreen;\r\n        if (loadingScreen) {\r\n            loadingScreen.displayLoadingUI();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide the loading screen\r\n     * @see http://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\r\n     */\r\n    public hideLoadingUI(): void {\r\n        if (!DomManagement.IsWindowObjectExist()) {\r\n            return;\r\n        }\r\n        const loadingScreen = this._loadingScreen;\r\n        if (loadingScreen) {\r\n            loadingScreen.hideLoadingUI();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the current loading screen object\r\n     * @see http://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\r\n     */\r\n    public get loadingScreen(): ILoadingScreen {\r\n        if (!this._loadingScreen && this._renderingCanvas) {\r\n            this._loadingScreen = Engine.DefaultLoadingScreenFactory(this._renderingCanvas);\r\n        }\r\n        return this._loadingScreen;\r\n    }\r\n\r\n    /**\r\n     * Sets the current loading screen object\r\n     * @see http://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\r\n     */\r\n    public set loadingScreen(loadingScreen: ILoadingScreen) {\r\n        this._loadingScreen = loadingScreen;\r\n    }\r\n\r\n    /**\r\n     * Sets the current loading screen text\r\n     * @see http://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\r\n     */\r\n    public set loadingUIText(text: string) {\r\n        this.loadingScreen.loadingUIText = text;\r\n    }\r\n\r\n    /**\r\n     * Sets the current loading screen background color\r\n     * @see http://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\r\n     */\r\n    public set loadingUIBackgroundColor(color: string) {\r\n        this.loadingScreen.loadingUIBackgroundColor = color;\r\n    }\r\n\r\n    /**\r\n     * Attach a new callback raised when context lost event is fired\r\n     * @param callback defines the callback to call\r\n     */\r\n    public attachContextLostEvent(callback: ((event: WebGLContextEvent) => void)): void {\r\n        if (this._renderingCanvas) {\r\n            this._renderingCanvas.addEventListener(\"webglcontextlost\", <any>callback, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attach a new callback raised when context restored event is fired\r\n     * @param callback defines the callback to call\r\n     */\r\n    public attachContextRestoredEvent(callback: ((event: WebGLContextEvent) => void)): void {\r\n        if (this._renderingCanvas) {\r\n            this._renderingCanvas.addEventListener(\"webglcontextrestored\", <any>callback, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the source code of the vertex shader associated with a specific webGL program\r\n     * @param program defines the program to use\r\n     * @returns a string containing the source code of the vertex shader associated with the program\r\n     */\r\n    public getVertexShaderSource(program: WebGLProgram): Nullable<string> {\r\n        var shaders = this._gl.getAttachedShaders(program);\r\n\r\n        if (!shaders) {\r\n            return null;\r\n        }\r\n\r\n        return this._gl.getShaderSource(shaders[0]);\r\n    }\r\n\r\n    /**\r\n     * Gets the source code of the fragment shader associated with a specific webGL program\r\n     * @param program defines the program to use\r\n     * @returns a string containing the source code of the fragment shader associated with the program\r\n     */\r\n    public getFragmentShaderSource(program: WebGLProgram): Nullable<string> {\r\n        var shaders = this._gl.getAttachedShaders(program);\r\n\r\n        if (!shaders) {\r\n            return null;\r\n        }\r\n\r\n        return this._gl.getShaderSource(shaders[1]);\r\n    }\r\n\r\n    /**\r\n     * Get the current error code of the webGL context\r\n     * @returns the error code\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/getError\r\n     */\r\n    public getError(): number {\r\n        return this._gl.getError();\r\n    }\r\n\r\n    // FPS\r\n\r\n    /**\r\n     * Gets the current framerate\r\n     * @returns a number representing the framerate\r\n     */\r\n    public getFps(): number {\r\n        return this._fps;\r\n    }\r\n\r\n    /**\r\n     * Gets the time spent between current and previous frame\r\n     * @returns a number representing the delta time in ms\r\n     */\r\n    public getDeltaTime(): number {\r\n        return this._deltaTime;\r\n    }\r\n\r\n    private _measureFps(): void {\r\n        this._performanceMonitor.sampleFrame();\r\n        this._fps = this._performanceMonitor.averageFPS;\r\n        this._deltaTime = this._performanceMonitor.instantaneousFrameTime || 0;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _readTexturePixels(texture: InternalTexture, width: number, height: number, faceIndex = -1, level = 0, buffer: Nullable<ArrayBufferView> = null): ArrayBufferView {\r\n        let gl = this._gl;\r\n        if (!this._dummyFramebuffer) {\r\n            let dummy = gl.createFramebuffer();\r\n\r\n            if (!dummy) {\r\n                throw new Error(\"Unable to create dummy framebuffer\");\r\n            }\r\n\r\n            this._dummyFramebuffer = dummy;\r\n        }\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._dummyFramebuffer);\r\n\r\n        if (faceIndex > -1) {\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, texture._webGLTexture, level);\r\n        } else {\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture._webGLTexture, level);\r\n        }\r\n\r\n        let readType = (texture.type !== undefined) ? this._getWebGLTextureType(texture.type) : gl.UNSIGNED_BYTE;\r\n\r\n        switch (readType) {\r\n            case gl.UNSIGNED_BYTE:\r\n                if (!buffer) {\r\n                    buffer = new Uint8Array(4 * width * height);\r\n                }\r\n                readType = gl.UNSIGNED_BYTE;\r\n                break;\r\n            default:\r\n                if (!buffer) {\r\n                    buffer = new Float32Array(4 * width * height);\r\n                }\r\n                readType = gl.FLOAT;\r\n                break;\r\n        }\r\n\r\n        gl.readPixels(0, 0, width, height, gl.RGBA, readType, <DataView>buffer);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._currentFramebuffer);\r\n\r\n        return buffer;\r\n    }\r\n\r\n    private _canRenderToFloatFramebuffer(): boolean {\r\n        if (this._webGLVersion > 1) {\r\n            return this._caps.colorBufferFloat;\r\n        }\r\n        return this._canRenderToFramebuffer(Engine.TEXTURETYPE_FLOAT);\r\n    }\r\n\r\n    private _canRenderToHalfFloatFramebuffer(): boolean {\r\n        if (this._webGLVersion > 1) {\r\n            return this._caps.colorBufferFloat;\r\n        }\r\n        return this._canRenderToFramebuffer(Engine.TEXTURETYPE_HALF_FLOAT);\r\n    }\r\n\r\n    // Thank you : http://stackoverflow.com/questions/28827511/webgl-ios-render-to-floating-point-texture\r\n    private _canRenderToFramebuffer(type: number): boolean {\r\n        let gl = this._gl;\r\n\r\n        //clear existing errors\r\n        while (gl.getError() !== gl.NO_ERROR) { }\r\n\r\n        let successful = true;\r\n\r\n        let texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(type), 1, 1, 0, gl.RGBA, this._getWebGLTextureType(type), null);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n        let fb = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        let status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\r\n        successful = successful && (status === gl.FRAMEBUFFER_COMPLETE);\r\n        successful = successful && (gl.getError() === gl.NO_ERROR);\r\n\r\n        //try render by clearing frame buffer's color buffer\r\n        if (successful) {\r\n            gl.clear(gl.COLOR_BUFFER_BIT);\r\n            successful = successful && (gl.getError() === gl.NO_ERROR);\r\n        }\r\n\r\n        //try reading from frame to ensure render occurs (just creating the FBO is not sufficient to determine if rendering is supported)\r\n        if (successful) {\r\n            //in practice it's sufficient to just read from the backbuffer rather than handle potentially issues reading from the texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            let readFormat = gl.RGBA;\r\n            let readType = gl.UNSIGNED_BYTE;\r\n            let buffer = new Uint8Array(4);\r\n            gl.readPixels(0, 0, 1, 1, readFormat, readType, buffer);\r\n            successful = successful && (gl.getError() === gl.NO_ERROR);\r\n        }\r\n\r\n        //clean up\r\n        gl.deleteTexture(texture);\r\n        gl.deleteFramebuffer(fb);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        //clear accumulated errors\r\n        while (!successful && (gl.getError() !== gl.NO_ERROR)) { }\r\n\r\n        return successful;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getWebGLTextureType(type: number): number {\r\n        if (this._webGLVersion === 1) {\r\n            switch (type) {\r\n                case Engine.TEXTURETYPE_FLOAT:\r\n                    return this._gl.FLOAT;\r\n                case Engine.TEXTURETYPE_HALF_FLOAT:\r\n                    return this._gl.HALF_FLOAT_OES;\r\n                case Engine.TEXTURETYPE_UNSIGNED_BYTE:\r\n                    return this._gl.UNSIGNED_BYTE;\r\n            }\r\n            return this._gl.UNSIGNED_BYTE;\r\n        }\r\n\r\n        switch (type) {\r\n            case Engine.TEXTURETYPE_BYTE:\r\n                return this._gl.BYTE;\r\n            case Engine.TEXTURETYPE_UNSIGNED_BYTE:\r\n                return this._gl.UNSIGNED_BYTE;\r\n            case Engine.TEXTURETYPE_SHORT:\r\n                return this._gl.SHORT;\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT:\r\n                return this._gl.UNSIGNED_SHORT;\r\n            case Engine.TEXTURETYPE_INT:\r\n                return this._gl.INT;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                return this._gl.UNSIGNED_INT;\r\n            case Engine.TEXTURETYPE_FLOAT:\r\n                return this._gl.FLOAT;\r\n            case Engine.TEXTURETYPE_HALF_FLOAT:\r\n                return this._gl.HALF_FLOAT;\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                return this._gl.UNSIGNED_SHORT_4_4_4_4;\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                return this._gl.UNSIGNED_SHORT_5_5_5_1;\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                return this._gl.UNSIGNED_SHORT_5_6_5;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                return this._gl.UNSIGNED_INT_2_10_10_10_REV;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_24_8:\r\n                return this._gl.UNSIGNED_INT_24_8;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                return this._gl.UNSIGNED_INT_10F_11F_11F_REV;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                return this._gl.UNSIGNED_INT_5_9_9_9_REV;\r\n            case Engine.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:\r\n                return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV;\r\n        }\r\n\r\n        return this._gl.UNSIGNED_BYTE;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getInternalFormat(format: number): number {\r\n        var internalFormat = this._gl.RGBA;\r\n\r\n        switch (format) {\r\n            case Engine.TEXTUREFORMAT_ALPHA:\r\n                internalFormat = this._gl.ALPHA;\r\n                break;\r\n            case Engine.TEXTUREFORMAT_LUMINANCE:\r\n                internalFormat = this._gl.LUMINANCE;\r\n                break;\r\n            case Engine.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                internalFormat = this._gl.LUMINANCE_ALPHA;\r\n                break;\r\n            case Engine.TEXTUREFORMAT_RED:\r\n                internalFormat = this._gl.RED;\r\n                break;\r\n            case Engine.TEXTUREFORMAT_RG:\r\n                internalFormat = this._gl.RG;\r\n                break;\r\n            case Engine.TEXTUREFORMAT_RGB:\r\n                internalFormat = this._gl.RGB;\r\n                break;\r\n            case Engine.TEXTUREFORMAT_RGBA:\r\n                internalFormat = this._gl.RGBA;\r\n                break;\r\n        }\r\n\r\n        if (this._webGLVersion > 1) {\r\n            switch (format) {\r\n                case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                    internalFormat = this._gl.RED_INTEGER;\r\n                    break;\r\n                case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                    internalFormat = this._gl.RG_INTEGER;\r\n                    break;\r\n                case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                    internalFormat = this._gl.RGB_INTEGER;\r\n                    break;\r\n                case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                    internalFormat = this._gl.RGBA_INTEGER;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return internalFormat;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getRGBABufferInternalSizedFormat(type: number, format?: number): number {\r\n        if (this._webGLVersion === 1) {\r\n            if (format !== undefined) {\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_ALPHA:\r\n                        return this._gl.ALPHA;\r\n                    case Engine.TEXTUREFORMAT_LUMINANCE:\r\n                        return this._gl.LUMINANCE;\r\n                    case Engine.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        return this._gl.LUMINANCE_ALPHA;\r\n                }\r\n            }\r\n            return this._gl.RGBA;\r\n        }\r\n\r\n        switch (type) {\r\n            case Engine.TEXTURETYPE_BYTE:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED:\r\n                        return this._gl.R8_SNORM;\r\n                    case Engine.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG8_SNORM;\r\n                    case Engine.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB8_SNORM;\r\n                    case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R8I;\r\n                    case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG8I;\r\n                    case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB8I;\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA8I;\r\n                    default:\r\n                        return this._gl.RGBA8_SNORM;\r\n                }\r\n            case Engine.TEXTURETYPE_UNSIGNED_BYTE:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED:\r\n                        return this._gl.R8;\r\n                    case Engine.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG8;\r\n                    case Engine.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB8; // By default. Other possibilities are RGB565, SRGB8.\r\n                    case Engine.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA8; // By default. Other possibilities are RGB5_A1, RGBA4, SRGB8_ALPHA8.\r\n                    case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R8UI;\r\n                    case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG8UI;\r\n                    case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB8UI;\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA8UI;\r\n                    case Engine.TEXTUREFORMAT_ALPHA:\r\n                        return this._gl.ALPHA;\r\n                    case Engine.TEXTUREFORMAT_LUMINANCE:\r\n                        return this._gl.LUMINANCE;\r\n                    case Engine.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        return this._gl.LUMINANCE_ALPHA;\r\n                    default:\r\n                        return this._gl.RGBA8;\r\n                }\r\n            case Engine.TEXTURETYPE_SHORT:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R16I;\r\n                    case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG16I;\r\n                    case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB16I;\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA16I;\r\n                    default:\r\n                        return this._gl.RGBA16I;\r\n                }\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R16UI;\r\n                    case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG16UI;\r\n                    case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB16UI;\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA16UI;\r\n                    default:\r\n                        return this._gl.RGBA16UI;\r\n                }\r\n            case Engine.TEXTURETYPE_INT:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R32I;\r\n                    case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG32I;\r\n                    case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB32I;\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA32I;\r\n                    default:\r\n                        return this._gl.RGBA32I;\r\n                }\r\n            case Engine.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R32UI;\r\n                    case Engine.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG32UI;\r\n                    case Engine.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB32UI;\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA32UI;\r\n                    default:\r\n                        return this._gl.RGBA32UI;\r\n                }\r\n            case Engine.TEXTURETYPE_FLOAT:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED:\r\n                        return this._gl.R32F; // By default. Other possibility is R16F.\r\n                    case Engine.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG32F; // By default. Other possibility is RG16F.\r\n                    case Engine.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB32F; // By default. Other possibilities are RGB16F, R11F_G11F_B10F, RGB9_E5.\r\n                    case Engine.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA32F; // By default. Other possibility is RGBA16F.\r\n                    default:\r\n                        return this._gl.RGBA32F;\r\n                }\r\n            case Engine.TEXTURETYPE_HALF_FLOAT:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RED:\r\n                        return this._gl.R16F;\r\n                    case Engine.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG16F;\r\n                    case Engine.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB16F; // By default. Other possibilities are R11F_G11F_B10F, RGB9_E5.\r\n                    case Engine.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA16F;\r\n                    default:\r\n                        return this._gl.RGBA16F;\r\n                }\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                return this._gl.RGB565;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                return this._gl.R11F_G11F_B10F;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                return this._gl.RGB9_E5;\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                return this._gl.RGBA4;\r\n            case Engine.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                return this._gl.RGB5_A1;\r\n            case Engine.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                switch (format) {\r\n                    case Engine.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGB10_A2; // By default. Other possibility is RGB5_A1.\r\n                    case Engine.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGB10_A2UI;\r\n                    default:\r\n                        return this._gl.RGB10_A2;\r\n                }\r\n        }\r\n\r\n        return this._gl.RGBA8;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getRGBAMultiSampleBufferFormat(type: number): number {\r\n        if (type === Engine.TEXTURETYPE_FLOAT) {\r\n            return this._gl.RGBA32F;\r\n        }\r\n        else if (type === Engine.TEXTURETYPE_HALF_FLOAT) {\r\n            return this._gl.RGBA16F;\r\n        }\r\n\r\n        return this._gl.RGBA8;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _loadFile(url: string, onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void, onProgress?: (data: any) => void, offlineProvider?: IOfflineProvider, useArrayBuffer?: boolean, onError?: (request?: WebRequest, exception?: any) => void): IFileRequest {\r\n        let request = Tools.LoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n        this._activeRequests.push(request);\r\n        request.onCompleteObservable.add((request) => {\r\n            this._activeRequests.splice(this._activeRequests.indexOf(request), 1);\r\n        });\r\n        return request;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _loadFileAsync(url: string, offlineProvider?: IOfflineProvider, useArrayBuffer?: boolean): Promise<string | ArrayBuffer> {\r\n        return new Promise((resolve, reject) => {\r\n            this._loadFile(url, (data) => {\r\n                resolve(data);\r\n            }, undefined, offlineProvider, useArrayBuffer, (request, exception) => {\r\n                reject(exception);\r\n            });\r\n        });\r\n    }\r\n\r\n    // Statics\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instanciated (ie. if a webGL context can be found)\r\n     * @returns true if the engine can be created\r\n     * @ignorenaming\r\n     */\r\n    public static isSupported(): boolean {\r\n        try {\r\n            var tempcanvas = document.createElement(\"canvas\");\r\n            var gl = tempcanvas.getContext(\"webgl\") || tempcanvas.getContext(\"experimental-webgl\");\r\n\r\n            return gl != null && !!window.WebGLRenderingContext;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n}"]}